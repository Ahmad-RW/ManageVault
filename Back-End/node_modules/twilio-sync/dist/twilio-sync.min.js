/* twilio-sync.js 0.9.2
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2016, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes Backoff library under the following license

    Copyright (C) 2012 Mathieu Turcotte

    Permission is hereby granted, free of charge, to any person obtaining a copy of
    this software and associated documentation files (the "Software"), to deal in
    the Software without restriction, including without limitation the rights to
    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
    of the Software, and to permit persons to whom the Software is furnished to do
    so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

This software includes Event-to-Promise library under the following license

    Copyright (c) 2014, Julien Fontanet <julien.fontanet@isonoe.net>.

    Permission to use, copy, modify, and/or distribute this software for any purpose
    with or without fee is hereby granted, provided that the above copyright notice
    and this permission notice appear in all copies.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
    FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
    OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
    TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
    THIS SOFTWARE.
*/
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;((t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Twilio||(t.Twilio={})).Sync=e()}}(function(){var define,module,exports;return function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){return i(t[s][1][e]||e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}}()({1:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=e("karibu"),a=function(){function e(t,r){(0,n.default)(this,e),this.value=t,this.revision=r||0}return(0,i.default)(e,[{key:"isValid",get:function(){return!0}}]),e}(),u=function(){function e(t){(0,n.default)(this,e),this.revision=t}return(0,i.default)(e,[{key:"isValid",get:function(){return!1}}]),e}(),c=function(){function e(){(0,n.default)(this,e),this.items=new s.TreeMap}return(0,i.default)(e,[{key:"store",value:function(e,t,r){var n=this.items.get(e);return n&&n.revision>r?n.isValid?n.value:null:(this.items.set(e,new a(t,r)),t)}},{key:"delete",value:function(e,t){var r=this.items.get(e);(!r||r.revision<t)&&this.items.set(e,new u(t))}},{key:"isKnown",value:function(e,t){var r=this.items.get(e);return r&&r.revision>=t}},{key:"get",value:function(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}},{key:"has",value:function(e){var t=this.items.get(e);return t&&t.isValid}}]),e}();r.Cache=c,r.default=c},{"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,karibu:203}],2:[function(e,t,r){"use strict";var n=f(e("babel-runtime/regenerator")),i=f(e("babel-runtime/helpers/asyncToGenerator")),o=f(e("babel-runtime/core-js/object/get-prototype-of")),s=f(e("babel-runtime/helpers/classCallCheck")),a=f(e("babel-runtime/helpers/createClass")),u=f(e("babel-runtime/helpers/possibleConstructorReturn")),c=f(e("babel-runtime/helpers/inherits")),l=f(e("babel-runtime/core-js/object/assign"));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var d=e("events"),p=e("twilsock"),h=e("twilio-notifications"),b=e("./utils"),m=e("./utils"),v=e("./logger"),y=e("./configuration"),g=e("./subscriptions"),_=e("./router"),k=e("./services/network"),x=e("./syncdocument"),w=e("./synclist"),j=e("./syncmap"),C=e("./clientInfo"),S=e("./entitiesCache"),T=e("./services/storage"),E=e("./syncerror"),M=e("./streams/syncstream"),R=e("./livequery"),I=e("./livequery"),O="data_sync",P=e("../package.json").version;function A(e){return e._subscribe(),e}function L(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};b.validateOptionalTtl(e.ttl);var t=e.mode||(e.id?"open_or_create":"create_new");return(0,l.default)({},e,{mode:t})}return{mode:"create_new"}}var F=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this));if(!e)throw new Error("Sync library needs a valid Twilio token to be passed");r.hasOwnProperty("logLevel")?v.default.setLevel(r.logLevel):v.default.setLevel("silent");var i=r.productId=r.productId||O,a=r.twilsockClient=r.twilsockClient||new p.Twilsock(e,i,r);a.on("tokenAboutToExpire",function(e){return n.emit("tokenAboutToExpire",e)}),a.on("tokenExpired",function(){return n.emit("tokenExpired")});var c=r.notificationsClient=r.notificationsClient||new h.Notifications(e,r),l=new y.Configuration(r),f=new k.NetworkService(new C.ClientInfo(P),l,a),d=new T.SessionStorage(l);n.localStorageId=null,a.connect(),n.services={config:l,twilsock:a,notifications:c,network:f,storage:d,router:null,subscriptions:null};var b=new g.Subscriptions(n.services),m=new _.Router({config:l,subscriptions:b,notifications:c});return n.services.router=m,n.services.subscriptions=b,n.entities=new S.EntitiesCache,c.on("connectionStateChanged",function(){n.emit("connectionStateChanged",n.services.notifications.connectionState)}),n}return(0,c.default)(t,e),(0,a.default)(t,[{key:"ensureReady",value:function(){var e=(0,i.default)(n.default.mark(function e(){var t;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.services.config.sessionStorageEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,this.services.twilsock.storageId();case 5:t=e.sent,this.services.storage.updateStorageId(t.id),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),v.default.warn("Failed to initialize storage",e.t0);case 12:case"end":return e.stop()}},e,this,[[2,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"storeRootInSessionCache",value:function(e,t,r){if(this.services.config.sessionStorageEnabled&&t){var n=m.deepClone(r);e!==w.SyncList.type&&e!==j.SyncMap.type||(n.last_event_id=null,delete n.items),this.services.storage.store(e,t,n)}}},{key:"readRootFromSessionCache",value:function(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}},{key:"_get",value:function(){var e=(0,i.default)(n.default.mark(function e(t,r){var i,o,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}throw new E.SyncError("Cannot get entity without id",404);case 2:return i=new b.UriBuilder(t).pathSegment(r).queryParam("Include",s?"items":void 0).build(),e.next=5,this.services.network.get(i);case 5:return o=e.sent,e.abrupt("return",o.body);case 7:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createDocument",value:function(e,t,r){var n={unique_name:e,data:t||{}};return"number"==typeof r&&(n.ttl=r),this.services.network.post(this.services.config.documentsUri,n).then(function(e){return e.body.data=n.data,e.body})}},{key:"_getDocument",value:function(){var e=(0,i.default)(n.default.mark(function e(t){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(x.SyncDocument.type,t)||this._get(this.services.config.documentsUri,t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_createList",value:function(e,t,r,n){var i={unique_name:e,purpose:t,context:r};return"number"==typeof n&&(i.ttl=n),this.services.network.post(this.services.config.listsUri,i).then(function(e){return e.body})}},{key:"_getList",value:function(){var e=(0,i.default)(n.default.mark(function e(t){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(w.SyncList.type,t)||this._get(this.services.config.listsUri,t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_createMap",value:function(e,t){var r={unique_name:e};return"number"==typeof t&&(r.ttl=t),this.services.network.post(this.services.config.mapsUri,r).then(function(e){return e.body})}},{key:"_getMap",value:function(){var e=(0,i.default)(n.default.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(j.SyncMap.type,t)||this._get(this.services.config.mapsUri,t,r));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_getStream",value:function(){var e=(0,i.default)(n.default.mark(function e(t){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readRootFromSessionCache(M.SyncStream.type,t)||this._get(this.services.config.streamsUri,t,!1));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_createStream",value:function(){var e=(0,i.default)(n.default.mark(function e(t,r){var i,o,s;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i={unique_name:t},"number"==typeof r&&(i.ttl=r),e.next=4,this.services.network.post(this.services.config.streamsUri,i);case 4:return o=e.sent,s=o.body,e.abrupt("return",s);case 7:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getLiveQuery",value:function(e){return this.readRootFromSessionCache(R.LiveQuery.type,e)}},{key:"getCached",value:function(e,t){return e&&this.entities.get(e,t)||null}},{key:"removeFromCacheAndSession",value:function(e,t,r){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,r)}},{key:"document",value:function(){var e=(0,i.default)(n.default.mark(function e(t){var r,i,o,s,a=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(r=L(t),i=void 0,"create_new"!==r.mode){e.next=10;break}return e.next=7,this._createDocument(r.id,r.value,r.ttl);case 7:i=e.sent,e.next=40;break;case 10:if(!(o=this.getCached(r.id,x.SyncDocument.type))){e.next=15;break}return e.abrupt("return",o);case 15:return e.prev=15,e.next=18,this._getDocument(r.id);case 18:i=e.sent,e.next=40;break;case 21:if(e.prev=21,e.t0=e.catch(15),404===e.t0.status&&"open_existing"!==r.mode){e.next=27;break}throw e.t0;case 27:return e.prev=27,e.next=30,this._createDocument(r.id,r.value,r.ttl);case 30:i=e.sent,e.next=40;break;case 33:if(e.prev=33,e.t1=e.catch(27),409!==e.t1.status){e.next=39;break}return e.abrupt("return",this.document(t));case 39:throw e.t1;case 40:return this.storeRootInSessionCache(x.SyncDocument.type,r.id,i),s=new x.SyncDocument(this.services,i,function(e,t,r){return a.removeFromCacheAndSession(e,t,r)}),s=this.entities.store(s),e.abrupt("return",A(s));case 44:case"end":return e.stop()}},e,this,[[15,21],[27,33]])}));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(){var e=(0,i.default)(n.default.mark(function e(t){var r,i,o,s,a=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(r=L(t),i=void 0,"create_new"!==r.mode){e.next=10;break}return e.next=7,this._createMap(r.id,r.ttl);case 7:i=e.sent,e.next=40;break;case 10:if(!(o=this.getCached(r.id,j.SyncMap.type))){e.next=15;break}return e.abrupt("return",o);case 15:return e.prev=15,e.next=18,this._getMap(r.id,r.includeItems);case 18:i=e.sent,e.next=40;break;case 21:if(e.prev=21,e.t0=e.catch(15),404===e.t0.status&&"open_existing"!==r.mode){e.next=27;break}throw e.t0;case 27:return e.prev=27,e.next=30,this._createMap(r.id,r.ttl);case 30:i=e.sent,e.next=40;break;case 33:if(e.prev=33,e.t1=e.catch(27),409!==e.t1.status){e.next=39;break}return e.abrupt("return",this.map(t));case 39:throw e.t1;case 40:return this.storeRootInSessionCache(j.SyncMap.type,r.id,i),s=new j.SyncMap(this.services,i,function(e,t,r){return a.removeFromCacheAndSession(e,t,r)}),s=this.entities.store(s),e.abrupt("return",A(s));case 44:case"end":return e.stop()}},e,this,[[15,21],[27,33]])}));return function(t){return e.apply(this,arguments)}}()},{key:"list",value:function(){var e=(0,i.default)(n.default.mark(function e(t){var r,i,o,s,a=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(r=L(t),i=void 0,"create_new"!==r.mode){e.next=10;break}return e.next=7,this._createList(r.id,r.purpose,r.context,r.ttl);case 7:i=e.sent,e.next=40;break;case 10:if(!(o=this.getCached(r.id,w.SyncList.type))){e.next=15;break}return e.abrupt("return",o);case 15:return e.prev=15,e.next=18,this._getList(r.id);case 18:i=e.sent,e.next=40;break;case 21:if(e.prev=21,e.t0=e.catch(15),404===e.t0.status&&"open_existing"!==r.mode){e.next=27;break}throw e.t0;case 27:return e.prev=27,e.next=30,this._createList(r.id,r.purpose,r.context,r.ttl);case 30:i=e.sent,e.next=40;break;case 33:if(e.prev=33,e.t1=e.catch(27),409!==e.t1.status){e.next=39;break}return e.abrupt("return",this.list(t));case 39:throw e.t1;case 40:return this.storeRootInSessionCache(w.SyncList.type,r.id,i),s=new w.SyncList(this.services,i,function(e,t,r){return a.removeFromCacheAndSession(e,t,r)}),s=this.entities.store(s),e.abrupt("return",A(s));case 44:case"end":return e.stop()}},e,this,[[15,21],[27,33]])}));return function(t){return e.apply(this,arguments)}}()},{key:"stream",value:function(){var e=(0,i.default)(n.default.mark(function e(t){var r,i,o,s,a,u=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(r=L(t),i=void 0,"create_new"!==r.mode){e.next=10;break}return e.next=7,this._createStream(r.id,r.ttl);case 7:i=e.sent,e.next=40;break;case 10:if(!(o=this.getCached(r.id,M.SyncStream.type))){e.next=15;break}return e.abrupt("return",o);case 15:return e.prev=15,e.next=18,this._getStream(r.id);case 18:i=e.sent,e.next=40;break;case 21:if(e.prev=21,e.t0=e.catch(15),404===e.t0.status&&"open_existing"!==r.mode){e.next=27;break}throw e.t0;case 27:return e.prev=27,e.next=30,this._createStream(r.id,r.ttl);case 30:i=e.sent,e.next=40;break;case 33:if(e.prev=33,e.t1=e.catch(27),409!==e.t1.status){e.next=39;break}return e.abrupt("return",this.stream(t));case 39:throw e.t1;case 40:return this.storeRootInSessionCache(M.SyncStream.type,r.id,i),s=function(e,t,r){return u.removeFromCacheAndSession(e,t,r)},a=new M.SyncStream(this.services,i,s),a=this.entities.store(a),e.abrupt("return",A(a));case 45:case"end":return e.stop()}},e,this,[[15,21],[27,33]])}));return function(t){return e.apply(this,arguments)}}()},{key:"shutdown",value:function(){var e=(0,i.default)(n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.subscriptions.shutdown();case 2:return e.next=4,this.services.twilsock.disconnect();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateToken",value:function(e){return this.services.twilsock.updateToken(e)}},{key:"liveQuery",value:function(){var e=(0,i.default)(n.default.mark(function e(t,r){var i,o,s,a,u,c,l,f=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:if(t&&"string"==typeof t){e.next=4;break}throw new Error("Index name must contain a non-empty string value");case 4:return i=new b.UriBuilder(this.services.config.insightsUri).pathSegment(t).pathSegment("Items").build(),o=I.parseQueryExpression(r),e.next=8,I.queryItems({network:this.services.network,uri:i,jsonQuery:o,queryString:r});case 8:return s=e.sent,(a=this.getCached(s.query_id,R.LiveQuery.type))||((u=this._getLiveQuery(s.query_id))||(u={indexName:t,queryExpression:r,jsonQuery:o,sid:s.query_id,queryUri:i}),c=function(e,t,r){return f.removeFromCacheAndSession(e,t,r)},a=new R.LiveQueryProxy(u,this.services,c)),this.storeRootInSessionCache(R.LiveQuery.type,s.query_id,a.liveQueryDescriptor),l=new R.LiveQuery(a,s.items),this.entities.store(a),e.abrupt("return",l);case 15:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"instantQuery",value:function(){var e=(0,i.default)(n.default.mark(function e(t){var r,i,o=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.ensureReady();case 2:return r=function(e,t){return o.liveQuery(e,t)},i=new R.InstantQuery({indexName:t,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:r}),e.abrupt("return",i);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"connectionState",get:function(){return this.services.notifications.connectionState}}],[{key:"version",get:function(){return P}}]),t}(d.EventEmitter);r.Client=F,r.SyncClient=F,r.default=F},{"../package.json":255,"./clientInfo":3,"./configuration":4,"./entitiesCache":5,"./livequery":8,"./logger":9,"./router":22,"./services/network":23,"./services/storage":24,"./streams/syncstream":25,"./subscriptions":26,"./syncdocument":28,"./syncerror":29,"./synclist":30,"./syncmap":31,"./utils":32,"babel-runtime/core-js/object/assign":38,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59,events:200,"twilio-notifications":216,twilsock:229}],3:[function(e,t,r){"use strict";var n,i=e("babel-runtime/helpers/classCallCheck"),o=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var s=e("platform"),a=function e(t){(0,o.default)(this,e),this.sdk="js",this.sdkVer=t,this.os=s.os.family,this.osVer=s.os.version,this.pl=s.name,this.plVer=s.version};r.ClientInfo=a,r.default=a},{"babel-runtime/helpers/classCallCheck":51,platform:206}],4:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s="/v4/Subscriptions",a="/v3/Maps",u="/v3/Lists",c="/v3/Documents",l="/v3/Streams",f="/v3/Insights";var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.default)(this,e);var r,i,o,d="https://cds."+(t.region||"us1")+".twilio.com",p=t.cdsUri||d;this.settings={subscriptionsUri:p+s,documentsUri:p+c,listsUri:p+u,mapsUri:p+a,streamsUri:p+l,insightsUri:p+f,sessionStorageEnabled:(r=t.Sync,i="enableSessionStorage",o=!0,r&&void 0!==r[i]?r[i]:o)}}return(0,i.default)(e,[{key:"subscriptionsUri",get:function(){return this.settings.subscriptionsUri}},{key:"documentsUri",get:function(){return this.settings.documentsUri}},{key:"listsUri",get:function(){return this.settings.listsUri}},{key:"mapsUri",get:function(){return this.settings.mapsUri}},{key:"streamsUri",get:function(){return this.settings.streamsUri}},{key:"insightsUri",get:function(){return this.settings.insightsUri}},{key:"backoffConfig",get:function(){return this.settings.backoffConfig||{}}},{key:"sessionStorageEnabled",get:function(){return this.settings.sessionStorageEnabled}}]),e}();r.Configuration=d},{"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],5:[function(e,t,r){"use strict";var n=s(e("babel-runtime/core-js/map")),i=s(e("babel-runtime/helpers/classCallCheck")),o=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(){(0,i.default)(this,e),this.names=new n.default,this.entities=new n.default}return(0,o.default)(e,[{key:"store",value:function(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}},{key:"getResolved",value:function(e,t){var r=this.names.get(t+"::"+e);return r?this.entities.get(r):null}},{key:"get",value:function(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}},{key:"remove",value:function(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}]),e}();r.EntitiesCache=a},{"babel-runtime/core-js/map":37,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],6:[function(e,t,r){"use strict";var n=u(e("babel-runtime/core-js/object/get-prototype-of")),i=u(e("babel-runtime/helpers/classCallCheck")),o=u(e("babel-runtime/helpers/createClass")),s=u(e("babel-runtime/helpers/possibleConstructorReturn")),a=u(e("babel-runtime/helpers/inherits"));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(e){function t(e,r){(0,i.default)(this,t);var o=(0,s.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return o.services=e,o.removalHandler=r,o.subscriptionState="none",o}return(0,a.default)(t,e),(0,o.default)(t,[{key:"_advanceLastEventId",value:function(e,t){}},{key:"reportFailure",value:function(e){404===e.status?this.onRemoved(!1):this.emit("failure",e)}},{key:"_subscribe",value:function(){return this.services.router.subscribe(this.sid,this),this}},{key:"_unsubscribe",value:function(){return this.services.router.unsubscribe(this.sid),this}},{key:"_setSubscriptionState",value:function(e){this.subscriptionState=e,this.emit("_subscriptionStateChanged",e)}},{key:"close",value:function(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}}]),t}(e("events").EventEmitter);r.SyncEntity=c,r.default=c},{"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,events:200}],7:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(t){(0,n.default)(this,e),this.data=t}return(0,i.default)(e,[{key:"update",value:function(e,t,r,n){return this.data.lastEventId=e,this.data.revision=t,this.data.value=r,this.data.dateUpdated=n,this}},{key:"updateDateExpires",value:function(e){this.data.dateExpires=e}},{key:"uri",get:function(){return this.data.uri}},{key:"revision",get:function(){return this.data.revision}},{key:"lastEventId",get:function(){return this.data.lastEventId}},{key:"dateUpdated",get:function(){return this.data.dateUpdated}},{key:"dateExpires",get:function(){return this.data.dateExpires}},{key:"index",get:function(){return this.data.index}},{key:"value",get:function(){return this.data.value}}]),e}();r.ListItem=s,r.default=s},{"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],8:[function(e,t,r){"use strict";var n,i=y(e("babel-runtime/core-js/json/stringify")),o=y(e("babel-runtime/core-js/promise")),s=y(e("babel-runtime/core-js/object/assign")),a=y(e("babel-runtime/core-js/object/keys")),u=y(e("babel-runtime/regenerator")),c=y(e("babel-runtime/helpers/asyncToGenerator")),l=y(e("babel-runtime/core-js/get-iterator")),f=y(e("babel-runtime/core-js/map")),d=y(e("babel-runtime/core-js/object/get-prototype-of")),p=y(e("babel-runtime/helpers/createClass")),h=y(e("babel-runtime/helpers/possibleConstructorReturn")),b=y(e("babel-runtime/helpers/inherits")),m=y(e("babel-runtime/helpers/classCallCheck")),v=(n=(0,c.default)(u.default.mark(function e(t){var r,n,i,o,s,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.network,n=t.jsonQuery,i=t.queryString,o=t.uri,s={query:n,query_string:i},e.next=4,r.post(o,s,void 0,!0);case 4:return a=e.sent,e.abrupt("return",a.body);case 6:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)});function y(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var g=e("./utils"),_=e("./lql/parser"),k=e("./lql/utils"),x=e("uuid/v4"),w=e("events"),j=e("./syncerror"),C=e("./entity"),S=e("./logger");r.InsightsItem=function e(){(0,m.default)(this,e)};var T=function(e){function t(e,r,n){(0,m.default)(this,t);var i=(0,h.default)(this,(t.__proto__||(0,d.default)(t)).call(this,r,n));return i.descriptor=e,i.attachedLiveQueries=new f.default,i}return(0,b.default)(t,e),(0,p.default)(t,[{key:"onRemoved",value:function(){}},{key:"_update",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var o,s=(0,l.default)(this.attachedLiveQueries.values());!(r=(o=s.next()).done);r=!0){o.value._update(e)}}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}}},{key:"attach",value:function(e){var t=e.listenerUuid;this.attachedLiveQueries.get(t)||(this.attachedLiveQueries.size||this._subscribe(),this.attachedLiveQueries.set(t,e))}},{key:"detach",value:function(e){this.attachedLiveQueries.delete(e),this.attachedLiveQueries.size||this.close()}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return null}},{key:"type",get:function(){return t.type}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){return this.descriptor.indexName}},{key:"jsonQuery",get:function(){return this.descriptor.jsonQuery}},{key:"queryString",get:function(){return this.descriptor.queryExpression}},{key:"queryUri",get:function(){return this.descriptor.queryUri}},{key:"liveQueryDescriptor",get:function(){return this.descriptor}},{key:"network",get:function(){return this.services.network}}],[{key:"type",get:function(){return"live_query"}}]),t}(C.SyncEntity);function E(e){try{var t=_.parseLiveQuery(e);return k.binaryTreeToQueryJson(t)}catch(e){throw new j.SyncError("Invalid query syntax: '"+e.message+"'",400,54507)}}function M(e){if(e)return e.reduce(function(e,t){return e[t.key]={key:t.key,value:t.data,revision:t.revision},e},{})}r.LiveQueryProxy=T,r.parseQueryExpression=E,r.queryItems=v;var R=function(e){function t(e,r){(0,m.default)(this,t);var n=(0,h.default)(this,(t.__proto__||(0,d.default)(t)).call(this));return n.proxy=e,n.uuid=x(),n.items=M(r),n.proxy.attach(n),n}return(0,b.default)(t,e),(0,p.default)(t,[{key:"type",get:function(){return T.type}},{key:"listenerUuid",get:function(){return this.uuid}},{key:"sid",get:function(){return this.proxy.sid}}],[{key:"type",get:function(){return T.type}}]),(0,p.default)(t,[{key:"close",value:function(){this.items={},this.proxy.detach(this.uuid)}},{key:"getItems",value:function(){var e=this,t={};return this.items&&(0,a.default)(this.items).map(function(r,n){t[r]=e.items[r].value}),t}},{key:"_update",value:function(e){var t=e.item_key,r=e.item_revision;switch(e.type){case"live_query_item_updated":var n=this.items[t];if(!n||r>n.revision){var i={key:t,revision:r,value:e.item_data};this.items[t]=i,this.emit("itemUpdated",i)}break;case"live_query_item_removed":delete this.items[t],this.emit("itemRemoved",{key:t})}}}]),t}(w.EventEmitter);r.LiveQuery=R;var I=function(e){function t(e){(0,m.default)(this,t);var r=(0,h.default)(this,(t.__proto__||(0,d.default)(t)).call(this));return r.queryExpression=null,(0,s.default)(r,e),r.updateIndexName(e.indexName),r}return(0,b.default)(t,e),(0,p.default)(t,[{key:"search",value:function(){var e=(0,c.default)(u.default.mark(function e(t){var r,n=this;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=void 0,e.prev=1,r=E(t),e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(1),e.abrupt("return",o.default.reject(e.t0));case 8:return e.abrupt("return",v({network:this.network,uri:this.queryUri,jsonQuery:r,queryString:t}).then(function(e){n.queryExpression=t,n.items=M(e.items),n.emit("searchResult",n.getItems())}).catch(function(e){throw S.default.error("Error '"+e.message+"' while executing query '"+(0,i.default)(r)+"'"),n.queryExpression=null,e}));case 9:case"end":return e.stop()}},e,this,[[1,5]])}));return function(t){return e.apply(this,arguments)}}()},{key:"subscribe",value:function(){var e=(0,c.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.liveQueryCreator(this.indexName,this.queryExpression));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getItems",value:function(){var e=this,t={};return this.items&&(0,a.default)(this.items).map(function(r,n){t[r]=e.items[r].value}),t}},{key:"updateIndexName",value:function(e){if(!e||"string"!=typeof e)throw new Error("Index name must contain a non-empty string value");this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}},{key:"generateQueryUri",value:function(e){return new g.UriBuilder(this.insightsUri).pathSegment(e).pathSegment("Items").build()}},{key:"type",get:function(){return t.type}}],[{key:"type",get:function(){return"instant_query"}}]),t}(w.EventEmitter);r.InstantQuery=I,r.default=R},{"./entity":6,"./logger":9,"./lql/parser":16,"./lql/utils":18,"./syncerror":29,"./utils":32,"babel-runtime/core-js/get-iterator":34,"babel-runtime/core-js/json/stringify":36,"babel-runtime/core-js/map":37,"babel-runtime/core-js/object/assign":38,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/object/keys":43,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59,events:200,"uuid/v4":254}],9:[function(e,t,r){"use strict";var n,i=e("babel-runtime/core-js/array/from"),o=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var s=e("loglevel");function a(e,t){return[(new Date).toISOString()+" Sync "+e+":"].concat((0,o.default)(t))}r.default={setLevel:function(e){s.setLevel(e)},trace:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.trace.apply(null,a("T",t))},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.debug.apply(null,a("D",t))},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.info.apply(null,a("I",t))},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.warn.apply(null,a("W",t))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.error.apply(null,a("E",t))}}},{"babel-runtime/core-js/array/from":33,loglevel:204}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./config/lexemes");function i(e,t,r,n){for(var i=!1,o=0,s=r.length;o<s;o+=1){if("endBlock"===t&&"startBlock"===e)throw new Error("Empty block");if("endArray"===t&&"startArray"===e)throw new Error("Empty array");if("string"===t&&"string"===e)throw new Error("lack of operator in between two strings");if("string"!==e||null!==t){if(!n&&t===r[o])throw new Error((t||"end of string")+" just after "+e);if(n){if(!t)throw new Error("Empty block just after "+e);t===r[o]&&(i=!0)}}}if(n&&!i)throw new Error((t||"end of string")+" just after "+e)}function o(e,t,r){r.negative&&i(e,t,r.negative,!1),r.mandatory&&i(e,t,r.mandatory,!0)}r.check=function(e){for(var t=0,r=null;e[t];)r=e[t+1],n[e[t].type].checker&&o(e[t].type,r?r.type:null,n[e[t].type].checker),t+=1}},{"./config/lexemes":11}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("../helpers/lexer"),i=e("../helpers/syntaxer"),o=e("../helpers/post"),s={regexp:'and(\\s|\\(|"|$)',escaped:!0,modifiers:"i",lexer:n.generateCutLexer("and",3),syntaxer:i.andSyntaxer,priority:4,checker:{negative:["endBlock",null]}};r.and=s;var a={regexp:"&&",escaped:!0,modifiers:"i",lexer:n.generateCutLexer("and",2),syntaxer:i.andSyntaxer,priority:4,checker:{negative:["endBlock",null]}};r.andAmpersand=a;var u={regexp:'or(\\s|\\(|"|$)',escaped:!0,modifiers:"i",lexer:n.generateCutLexer("or",2),syntaxer:i.orSyntaxer,priority:5,checker:{negative:["endBlock",null]}};r.or=u;var c={regexp:"\\|\\|",escaped:!0,modifiers:"i",lexer:n.generateCutLexer("or",2),syntaxer:i.orSyntaxer,priority:5,checker:{negative:["endBlock",null]}};r.orVerticalBar=c;var l={regexp:'eq(\\s|\\(|"|$)',escaped:!0,modifiers:"i",lexer:n.generateCutLexer("eq",2),syntaxer:i.eqSyntaxer,priority:3,checker:{mandatory:["string",null]}};r.eq=l;var f={regexp:"==",escaped:!0,modifiers:"i",lexer:n.generateCutLexer("eq",2),syntaxer:i.eqSyntaxer,priority:3,checker:{mandatory:["string",null]}};r.eqDoubleSign=f;var d={regexp:'not_eq(\\s|\\(|"|$)',escaped:!0,modifiers:"i",lexer:n.generateCutLexer("not_eq",6),syntaxer:i.notEqualSyntaxer,priority:3,checker:{mandatory:["string",null]}};r.not_eq=d;var p={regexp:"!=",escaped:!0,modifiers:"i",lexer:n.generateCutLexer("not_eq",2),syntaxer:i.notEqualSyntaxer,priority:3,checker:{mandatory:["string",null]}};r.notEqExclamation=p;var h={regexp:'contains(\\s|\\(|"|$)',escaped:!0,modifiers:"i",lexer:n.generateCutLexer("contains",8),syntaxer:i.containsSyntaxer,priority:3,checker:{mandatory:["string",null]}};r.contains=h;var b={regexp:'not(\\s|\\(|"|$)',escaped:!0,modifiers:"i",lexer:n.generateCutLexer("not",3),syntaxer:i.notSyntaxer,priority:1,checker:{mandatory:["startBlock","string","in",null]}};r.not=b;var m={regexp:',(\\s|"|$)',escaped:!0,lexer:n.generateCutLexer("comma",1),syntaxer:i.commaSyntaxer,priority:0,postFunction:o.commaPostTreatment,checker:{mandatory:["string",null]}};r.comma=m;var v={regexp:"in(\\s|\\[|$)",escaped:!0,modifiers:"i",lexer:n.generateCutLexer("in",2),syntaxer:i.inSyntaxer,priority:1,checker:{mandatory:["startArray",null]}};r.in=v;var y={regexp:"not_in(\\s|\\[|$)",escaped:!0,modifiers:"i",lexer:n.generateCutLexer("not_in",6),syntaxer:i.notInSyntaxer,priority:1,checker:{mandatory:["startArray",null]}};r.not_in=y;var g={regexp:"\\(",escaped:!0,lexer:n.generateCutLexer("startBlock",1),syntaxer:i.blockSyntaxer,priority:0,postFunction:o.blockPostTreatment,checker:{negative:["endBlock",null]}};r.startBlock=g;var _={regexp:"\\)",escaped:!0,lexer:n.generateCutLexer("endBlock",1),checker:{negative:["attr"]}};r.endBlock=_;var k={regexp:"\\[",escaped:!0,lexer:n.generateCutLexer("startArray",1),syntaxer:i.arraySyntaxer,priority:0,postFunction:o.blockPostTreatment,checker:{mandatory:["string",null]}};r.startArray=k;var x={regexp:"\\]",escaped:!0,lexer:n.generateCutLexer("endArray",1)};r.endArray=x;var w={regexp:'".*',lexer:n.stringLexer([_,x,m]),syntaxer:i.stringSyntaxer,checker:{negative:["string","startBlock","startArray","in","not_in","eq","not_eq","not","attr",null]},priority:0};r.string=w;var j={regexp:".*",lexer:n.attrLexer([l,f,d,p,v,y]),syntaxer:i.attrSyntaxer,checker:{negative:["string","startBlock","startArray",null]},priority:0};r.attr=j},{"../helpers/lexer":12,"../helpers/post":13,"../helpers/syntaxer":14}],12:[function(e,t,r){"use strict";function n(e){return new RegExp("^("+e.regexp+")",e.modifiers)}function i(e,t,r,i,o){return 0===e.length||(t?'"'===e.charAt(0):-1!==r.indexOf(e.charAt(0))||'"'===e.charAt(0)||!i&&o.some(function(t){return n(t).test(e)}))}function o(e,t,r,i){return 0===e.length||(-1!==t.indexOf(e.charAt(0))||!r&&i.some(function(t){return n(t).test(e)}))}Object.defineProperty(r,"__esModule",{value:!0}),r.generateRegexp=n,r.generateCutLexer=function(e,t){return function(r,n){return n.push({type:e,value:r.slice(0,t)}),r.slice(t)}},r.stringLexer=function(e){return function(t,r,n){var o=!0,s=!1,a="";for('"'===t.charAt(0)&&(s=!0,t=t.slice(1));!i(t,s,n,o,e);)"\\"!==t.charAt(0)?(a+=t.charAt(0),t=t.slice(1),o=!1):(a+=t.charAt(1),t=t.slice(2));if(s&&'"'!==t.charAt(0))throw new Error("Cannot reach end of quoted string");return s&&(t=t.slice(1)),r.push({type:"string",value:a}),t}},r.attrLexer=function(e){return function(t,r,n){for(var i=!0,s="";!o(t,n,i,e);)"\\"!==t.charAt(0)?(s+=t.charAt(0),t=t.slice(1),i=!1):(s+=t.charAt(1),t=t.slice(2));return r.push({type:"attr",value:s}),t}},r.clearSpaces=function(e,t){for(var r=0;r<e.length&&-1!==t.indexOf(e.charAt(r));)r+=1;return e.slice(r)}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.blockPostTreatment=function e(t,r){return r&&r.lexeme?(r.lexeme.type===t&&(r.lexeme={type:r.left.lexeme.type,value:r.left.lexeme.value},r.lexeme.value||delete r.lexeme.value,r.right=r.left.right,r.left=r.left.left),e(t,r.right),e(t,r.left),r):r},r.commaPostTreatment=function(e,t){return t&&t.lexeme?(function e(t,r,n){if(!n||!n.lexeme)return n;var i,o="startArray"===(i=n.lexeme.type)||"startBlock"===i?r:n;return n.lexeme.type===t&&(o=r,n.lexeme.type=o.lexeme.type),e(t,o,n.right),e(t,o,n.left),n}(e,t,t),t):t}},{}],14:[function(_dereq_,module,exports){"use strict";var _keys=_dereq_("babel-runtime/core-js/object/keys"),_keys2=_interopRequireDefault(_keys);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function getLowPriorityBlock(e,t){var r=_dereq_("../config/lexemes");return void 0===t&&(t=-1),!e.lexeme||r[e.lexeme.type].priority<t||null===e.right?e.left&&0==(0,_keys2.default)(e.left).length?e.left:e:getLowPriorityBlock(e.right,t)}function genericFieldSyntaxer(e){return function(t,r,n,i){var o=getLowPriorityBlock(i,_dereq_("../config/lexemes").string.priority),s={type:e,value:r[n].value};return o.lexeme=s,o.left=null,o.right=null,n+1}}function generateBasicSyntaxer(e){return function(t,r,n,i){var o=getLowPriorityBlock(i,_dereq_("../config/lexemes")[e].priority);if(!o.lexeme)throw new Error("Nothing before "+e+" block");var s={type:o.lexeme.type,value:o.lexeme.value};return o.lexeme={type:e},o.left={lexeme:s,left:o.left,right:o.right},o.right={},o.left.lexeme.value||delete o.left.lexeme.value,n+1}}function notSyntaxer(e,t,r,n){var i=getLowPriorityBlock(n,_dereq_("../config/lexemes").not.priority);return i.lexeme={type:"not"},i.left={},i.right=null,r+1}function genericBlockSyntaxer(typeStart,typeEnd){return function basicSyntaxer(options,lexemesArray,i,tree,createTree){var lexemes=_dereq_("../config/lexemes"),block=getLowPriorityBlock(tree,eval("lexemes."+typeStart+".priority")),tempLexeme={type:typeStart},newBlock=createTree(typeEnd,i+1);block.lexeme=tempLexeme,block.left=newBlock,block.right=null}}module.exports={andSyntaxer:generateBasicSyntaxer("and"),orSyntaxer:generateBasicSyntaxer("or"),eqSyntaxer:generateBasicSyntaxer("eq"),notEqualSyntaxer:generateBasicSyntaxer("not_eq"),commaSyntaxer:generateBasicSyntaxer("comma"),inSyntaxer:generateBasicSyntaxer("in"),notInSyntaxer:generateBasicSyntaxer("not_in"),containsSyntaxer:generateBasicSyntaxer("contains"),blockSyntaxer:genericBlockSyntaxer("startBlock","endBlock"),arraySyntaxer:genericBlockSyntaxer("startArray","endArray"),stringSyntaxer:genericFieldSyntaxer("string"),attrSyntaxer:genericFieldSyntaxer("attr"),notSyntaxer:notSyntaxer}},{"../config/lexemes":11,"babel-runtime/core-js/object/keys":43}],15:[function(e,t,r){"use strict";var n,i=e("babel-runtime/core-js/object/keys"),o=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var s=e("./config/lexemes"),a=e("./helpers/lexer");r.strToLexemes=function(e,t){var r=[];e=a.clearSpaces(e,t);for(var n=function(){var n=!1;if("\\"===e.charAt(0)&&(n=!0,0===(e=e.slice(1)).length))throw new Error("Backslash at end of string");if(!(0,o.default)(s).some(function(i){return!(n&&s[i].escaped||!a.generateRegexp(s[i]).test(e)||(e=s[i].lexer(e,r,t),0))}))throw new Error("Unknown character : "+e.charAt(0));e=a.clearSpaces(e,t)};e.length>0;)n();return r}},{"./config/lexemes":11,"./helpers/lexer":12,"babel-runtime/core-js/object/keys":43}],16:[function(e,t,r){"use strict";var n,i=e("babel-runtime/core-js/object/keys"),o=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var s=e("./config/lexemes"),a=e("./lexer"),u=e("./checker"),c=e("./syntaxer");r.parseLiveQuery=function(e,t){if(t||(t=e,e={}),null==t)throw new Error("Query string is a required parameter");var r=a.strToLexemes(t,e.spaces?e.spaces:" \t\n");u.check(r);var n=c.lexemesArrayToBinaryTree(e,r);if((0,o.default)(s).forEach(function(e){s[e].postFunction&&(n=s[e].postFunction(e,n))}),null===n||n==={})throw new Error("Unable to parse query");return n}},{"./checker":10,"./config/lexemes":11,"./lexer":15,"./syntaxer":17,"babel-runtime/core-js/object/keys":43}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./config/lexemes");r.lexemesArrayToBinaryTree=function(e,t){var r=0;return function i(o,s){var a={};for(s&&(r=s);t[r]&&t[r].type!==o;){if(!n[t[r].type].syntaxer)throw new Error("Unexpected token "+t[r].type);var u=n[t[r].type].syntaxer(e,t,r,a,i);u&&(r=u)}if(o&&!t[r])throw new Error("Bad end of block");return o&&(r+=1),a}(null)}},{"./config/lexemes":11}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.binaryTreeToQueryJson=function e(t){var r={};if(!t||!t.lexeme)return r;var n=t,i=t.lexeme.type;if(r.type=i,"string"===i||"attr"===i)return r.value=t.lexeme.value,r;for(r.values=[];n&&n.lexeme.type===i;)n.left&&r.values.push(e(n.left)),n=n.right;return n&&r.values.push(e(n)),r}},{}],19:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(t){(0,n.default)(this,e),this.descriptor=t}return(0,i.default)(e,[{key:"update",value:function(e,t,r,n){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=r,this.descriptor.date_updated=n,this}},{key:"updateDateExpires",value:function(e){this.descriptor.date_expires=e}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"key",get:function(){return this.descriptor.key}},{key:"value",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}]),e}();r.MapItem=s},{"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],20:[function(e,t,r){"use strict";var n=c(e("babel-runtime/regenerator")),i=c(e("babel-runtime/helpers/asyncToGenerator")),o=c(e("babel-runtime/core-js/map")),s=c(e("babel-runtime/core-js/promise")),a=c(e("babel-runtime/helpers/classCallCheck")),u=c(e("babel-runtime/helpers/createClass"));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=function(){function e(t){(0,a.default)(this,e),this.queuedRequests=[],this.isRequestInFlight=!1,this.inputMergingFunction=t}return(0,u.default)(e,[{key:"add",value:function(e,t){var r=this,n=new s.default(function(n,i){return r.queuedRequests.push({input:e,requestFunction:t,resolve:n,reject:i})});return this.wakeupQueue(),n}},{key:"squashAndAdd",value:function(e,t){var r=this.queuedRequests;this.queuedRequests=[];var n=void 0;r.length>0?(n=r.map(function(e){return e.input}).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;var i=this.add(n,t);return r.forEach(function(e){return i.then(e.resolve,e.reject)}),i}},{key:"isEmpty",value:function(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}},{key:"wakeupQueue",value:function(){var e=this;if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var t=this.queuedRequests.shift();this.isRequestInFlight=!0,t.requestFunction(t.input).then(t.resolve,t.reject).then(function(t){e.isRequestInFlight=!1,e.wakeupQueue()})}}}]),e}();r.MergingQueue=l;var f=function(){function e(t){(0,a.default)(this,e),this.queueByNamespaceKey=new o.default,this.inputReducer=t}return(0,u.default)(e,[{key:"add",value:function(){var e=(0,i.default)(n.default.mark(function e(t,r,i){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,function(e){return e.add(r,i)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"squashAndAdd",value:function(){var e=(0,i.default)(n.default.mark(function e(t,r,i){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.invokeQueueMethod(t,function(e){return e.squashAndAdd(r,i)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"invokeQueueMethod",value:function(){var e=(0,i.default)(n.default.mark(function e(t,r){var i,o;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.queueByNamespaceKey.has(t)||this.queueByNamespaceKey.set(t,new l(this.inputReducer)),i=this.queueByNamespaceKey.get(t),o=r(i),this.queueByNamespaceKey.get(t).isEmpty()&&this.queueByNamespaceKey.delete(t),e.abrupt("return",o);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()}]),e}();r.NamespacedMergingQueue=f},{"babel-runtime/core-js/map":37,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/regenerator":59}],21:[function(e,t,r){"use strict";var n=a(e("babel-runtime/regenerator")),i=a(e("babel-runtime/helpers/asyncToGenerator")),o=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function e(t,r,n,i){(0,o.default)(this,e),this.prevToken=n,this.nextToken=i,this.items=t,this.source=r}return(0,s.default)(e,[{key:"nextPage",value:function(){var e=(0,i.default)(n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasNextPage){e.next=2;break}throw new Error("No next page");case 2:return e.abrupt("return",this.source(this.nextToken));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"prevPage",value:function(){var e=(0,i.default)(n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasPrevPage){e.next=2;break}throw new Error("No previous page");case 2:return e.abrupt("return",this.source(this.prevToken));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"hasNextPage",get:function(){return!!this.nextToken}},{key:"hasPrevPage",get:function(){return!!this.prevToken}}]),e}();r.Paginator=u},{"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/regenerator":59}],22:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=e("./logger"),a="com.twilio.rtd.cds.document",u="com.twilio.rtd.cds.list",c="com.twilio.rtd.cds.map",l="twilio.sync.event",f=function(){function e(t){var r=this;(0,n.default)(this,e),this.config=t.config,this.subscriptions=t.subscriptions,this.notifications=t.notifications,this.notifications.subscribe(l),this.notifications.subscribe(a),this.notifications.subscribe(u),this.notifications.subscribe(c),this.notifications.on("message",function(e,t){return r.onMessage(e,t)}),this.notifications.on("transportReady",function(e){return r.onConnectionStateChanged(e)})}return(0,i.default)(e,[{key:"onMessage",value:function(e,t){switch(s.default.trace("Notification type:",e,"content:",t),e){case a:case u:case c:this.subscriptions.acceptMessage(t,!1);break;case l:this.subscriptions.acceptMessage(t,!0)}}},{key:"subscribe",value:function(e,t){this.subscriptions.add(e,t)}},{key:"unsubscribe",value:function(e){this.subscriptions.remove(e)}},{key:"onConnectionStateChanged",value:function(e){this.subscriptions.onConnectionStateChanged(e)}}]),e}();r.Router=f,r.default=f},{"./logger":9,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],23:[function(e,t,r){"use strict";var n=u(e("babel-runtime/core-js/promise")),i=u(e("babel-runtime/core-js/object/assign")),o=u(e("babel-runtime/core-js/json/stringify")),s=u(e("babel-runtime/helpers/classCallCheck")),a=u(e("babel-runtime/helpers/createClass"));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("uuid"),l=e("../logger"),f=e("../syncerror"),d=e("../syncNetworkError"),p=e("operation-retrier"),h=e("twilsock");function b(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function m(e){return e.body?e.body.code:0}function v(e){return 409===e.status?new d.SyncNetworkError(b(e),e.status,m(e),e.body):e.status?new f.SyncError(b(e),e.status,m(e)):e instanceof h.TransportUnavailableError?e:new f.SyncError(e.message,0,0)}var y=function(){function e(t,r,n){(0,s.default)(this,e),this.clientInfo=t,this.config=r,this.transport=n}return(0,a.default)(e,[{key:"createHeaders",value:function(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":(0,o.default)(this.clientInfo),"Twilio-Request-Id":"RQ"+c.v4().replace(/-/g,"")}}},{key:"backoffConfig",value:function(){return(0,i.default)({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}},{key:"executeWithRetry",value:function(e){var t=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new n.default(function(n,i){var o=[502,503,504];r&&o.push(429);var s=new p.default(t.backoffConfig());s.on("attempt",function(){e().then(function(e){return s.succeeded(e)}).catch(function(e){if(o.includes(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);s.failed(v(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?s.failed(v(e)):e.message&&-1!==e.message.indexOf("Twilsock: request timeout")?s.failed(v(e)):(s.removeAllListeners(),s.cancel(),i(v(e)))})}),s.on("succeeded",function(e){n(e)}),s.on("cancelled",function(e){return i(v(e))}),s.on("failed",function(e){return i(v(e))}),s.start()})}},{key:"get",value:function(e){var t=this,r=this.createHeaders();return l.default.debug("GET",e,"ID:",r["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.get(e,r)},!0)}},{key:"post",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.createHeaders();return null!=r&&(o["If-Match"]=r),l.default.debug("POST",e,"ID:",o["Twilio-Request-Id"]),this.executeWithRetry(function(){return n.transport.post(e,o,t)},i)}},{key:"put",value:function(e,t,r){var n=this,i=this.createHeaders();return null!=r&&(i["If-Match"]=r),l.default.debug("PUT",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry(function(){return n.transport.put(e,i,t)},!1)}},{key:"delete",value:function(e){var t=this,r=this.createHeaders();return l.default.debug("DELETE",e,"ID:",r["Twilio-Request-Id"]),this.executeWithRetry(function(){return t.transport.delete(e,r)},!1)}}]),e}();r.NetworkService=y},{"../logger":9,"../syncNetworkError":27,"../syncerror":29,"babel-runtime/core-js/json/stringify":36,"babel-runtime/core-js/object/assign":38,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"operation-retrier":205,twilsock:229,uuid:250}],24:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/assign")),i=a(e("babel-runtime/core-js/json/stringify")),o=a(e("babel-runtime/helpers/classCallCheck")),s=a(e("babel-runtime/helpers/createClass"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function e(t,r){(0,o.default)(this,e),this.config=t,this.storageId=null;try{this.storage=r||sessionStorage}catch(e){}}return(0,s.default)(e,[{key:"storageKey",value:function(e,t){return this.storageId+"::"+e+"::"+t}},{key:"updateStorageId",value:function(e){this.storageId=e}},{key:"store",value:function(e,t,r){return this.isReady?this._store(this.storageKey(e,t),r):null}},{key:"read",value:function(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}},{key:"remove",value:function(e,t,r){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),r&&this.storage.removeItem(this.storageKey(e,r))}catch(e){}}},{key:"update",value:function(e,t,r,n){if(!this.isReady)return null;this._apply(this.storageKey(e,t),n),r&&this._apply(this.storageKey(e,r),n)}},{key:"_store",value:function(e,t){try{this.storage.setItem(e,(0,i.default)(t))}catch(e){}}},{key:"_read",value:function(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}},{key:"_apply",value:function(e,t){var r=this._read(e);if(!r)return!1;this._store(e,(0,n.default)(r,t))}},{key:"isReady",get:function(){return this.config.sessionStorageEnabled&&!!this.storageId}}]),e}();r.SessionStorage=u},{"babel-runtime/core-js/json/stringify":36,"babel-runtime/core-js/object/assign":38,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],25:[function(e,t,r){"use strict";var n=l(e("babel-runtime/regenerator")),i=l(e("babel-runtime/helpers/asyncToGenerator")),o=l(e("babel-runtime/core-js/object/get-prototype-of")),s=l(e("babel-runtime/helpers/classCallCheck")),a=l(e("babel-runtime/helpers/createClass")),u=l(e("babel-runtime/helpers/possibleConstructorReturn")),c=l(e("babel-runtime/helpers/inherits"));function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var f=e("../entity"),d=e("../utils"),p=function(e){function t(e,r,n){(0,s.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e,n));return i.descriptor=r,i}return(0,c.default)(t,e),(0,a.default)(t,[{key:"publishMessage",value:function(){var e=(0,i.default)(n.default.mark(function e(t){var r,i,o,s;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={data:t},e.next=3,this.services.network.post(this.links.messages,r);case 3:return i=e.sent,o=i.body,s=this._handleMessagePublished(o.sid,t,!1),e.abrupt("return",s);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setTtl",value:function(){var e=(0,i.default)(n.default.mark(function e(t){var r,i;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.validateMandatoryTtl(t),e.prev=1,r={ttl:t},e.next=5,this.services.network.post(this.uri,r);case 5:i=e.sent,this.descriptor.date_expires=i.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"removeStream",value:function(){var e=(0,i.default)(n.default.mark(function e(){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_update",value:function(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}},{key:"_handleMessagePublished",value:function(e,t,r){var n={sid:e,value:t};return this.emit("messagePublished",{message:n,isLocal:!r}),n}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"stream"}},{key:"lastEventId",get:function(){return null}},{key:"indexName",get:function(){}},{key:"jsonQuery",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}}],[{key:"type",get:function(){return"stream"}}]),t}(f.SyncEntity);r.SyncStream=p,r.default=p},{"../entity":6,"../utils":32,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59}],26:[function(e,t,r){"use strict";var n=f(e("babel-runtime/regenerator")),i=f(e("babel-runtime/helpers/asyncToGenerator")),o=f(e("babel-runtime/core-js/get-iterator")),s=f(e("babel-runtime/helpers/slicedToArray")),a=f(e("babel-runtime/core-js/object/assign")),u=f(e("babel-runtime/core-js/map")),c=f(e("babel-runtime/helpers/classCallCheck")),l=f(e("babel-runtime/helpers/createClass"));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var d=e("backoff"),p=e("./logger"),h=e("./syncerror"),b=e("twilsock"),m=function(){function e(t){(0,c.default)(this,e),this.localObject=t,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}return(0,l.default)(e,[{key:"update",value:function(e,t){this.localObject._update(e,t)}},{key:"updatePending",value:function(e,t){this.pendingAction=e,this.pendingCorrelationId=t}},{key:"reset",value:function(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}},{key:"markAsFailed",value:function(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new h.SyncError("Failed to subscribe on service events: "+e.error.message,e.error.status,e.error.code))}},{key:"complete",value:function(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}},{key:"setSubscriptionState",value:function(e){this.localObject._setSubscriptionState(e)}},{key:"sid",get:function(){return this.localObject.sid}},{key:"type",get:function(){return this.localObject.type}},{key:"lastEventId",get:function(){return this.localObject.lastEventId}},{key:"indexName",get:function(){return this.localObject.indexName}},{key:"jsonQuery",get:function(){return this.localObject.jsonQuery}},{key:"queryString",get:function(){return this.localObject.queryString}},{key:"isEstablished",get:function(){return this.established}}]),e}(),v=function(){function e(t){var r=this;(0,c.default)(this,e),this.isConnected=!1,this.maxBatchSize=100,this.subscriptionTtlTimer=null,this.pendingPokeReason=null,this.services=t,this.subscriptions=new u.default,this.persisted=new u.default,this.latestPokeResponseArrivalTimestampByCorrelationId=new u.default;this.backoff=d.exponential((0,a.default)({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",function(){var e=r.getSubscriptionUpdateBatch(),t=e.action,n=e.subscriptions;t?r.applyNewSubscriptionUpdateBatch(t,n):(r.backoff.reset(),p.default.debug("All subscriptions resolved."))})}return(0,l.default)(e,[{key:"getSubscriptionUpdateBatch",value:function(){function e(e,t,r,n){var i=[],a=!0,u=!1,c=void 0;try{for(var l,f=(0,o.default)(e);!(a=(l=f.next()).done);a=!0){var d=l.value,p=(0,s.default)(d,2),h=p[0],b=p[1];if(!t.get(h)&&r!==b.pendingAction&&!b.rejectedWithError&&(i.push(b),n&&i.length>=n))break}}catch(e){u=!0,c=e}finally{try{!a&&f.return&&f.return()}finally{if(u)throw c}}return i}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var r=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return r.length>0?{action:"cancel",subscriptions:r}:{action:null,subscriptions:null}}},{key:"persist",value:function(){try{this.backoff.backoff()}catch(e){}}},{key:"applyNewSubscriptionUpdateBatch",value:function(){var e=(0,i.default)(n.default.mark(function e(t,r){var i,s,a,u,c,l,f,d,h,m,v,y,g,_,k,x,w,j,C,S,T=this;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=4;break}return p.default.debug("Twilsock connection (required for subscription) not ready; waiting\u2026"),this.backoff.reset(),e.abrupt("return");case 4:for(r=this.processLocalActions(t,r),i=(new Date).getTime(),s=!0,a=!1,u=void 0,e.prev=9,c=(0,o.default)(r);!(s=(l=c.next()).done);s=!0)f=l.value,this.recordActionAttemptOn(f,t,i);e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),a=!0,u=e.t0;case 17:e.prev=17,e.prev=18,!s&&c.return&&c.return();case 20:if(e.prev=20,!a){e.next=23;break}throw u;case 23:return e.finish(20);case 24:return e.finish(17);case 25:return d=this.pendingPokeReason,this.pendingPokeReason=null,e.prev=27,e.next=30,this.request(t,i,d,r);case 30:h=e.sent,m=h.body.max_batch_size,!isNaN(parseInt(m))&&isFinite(m)&&m>0&&(this.maxBatchSize=m),this.subscriptionTtlTimer||(v=h.body.ttl_in_s,y=!isNaN(parseFloat(v))&&isFinite(v),y&&v>0&&(this.subscriptionTtlTimer=setTimeout(function(){return T.onSubscriptionTtlElapsed()},1e3*v))),"establish"===t&&(g=h.body.estimated_delivery_in_ms,_=!isNaN(parseFloat(g))&&isFinite(g),_&&g>0?setTimeout(function(){return T.verifyPokeDelivery(i,g,r)},g):p.default.error("Invalid timeout: "+g),r.filter(function(e){return e.pendingCorrelationId===i}).forEach(function(e){return e.setSubscriptionState("response_in_flight")})),this.backoff.reset(),e.next=60;break;case 38:for(e.prev=38,e.t1=e.catch(27),k=!0,x=!1,w=void 0,e.prev=43,j=(0,o.default)(r);!(k=(C=j.next()).done);k=!0)S=C.value,this.recordActionFailureOn(S,t);e.next=51;break;case 47:e.prev=47,e.t2=e.catch(43),x=!0,w=e.t2;case 51:e.prev=51,e.prev=52,!k&&j.return&&j.return();case 54:if(e.prev=54,!x){e.next=57;break}throw w;case 57:return e.finish(54);case 58:return e.finish(51);case 59:e.t1 instanceof b.TransportUnavailableError?(p.default.debug("Twilsock connection (required for subscription) not ready (c:"+i+"); waiting\u2026"),this.backoff.reset()):(p.default.debug("Failed an attempt to "+t+" subscriptions (c:"+i+"); retrying",e.t1),this.persist());case 60:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24],[27,38],[43,47,51,59],[52,,54,58]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"verifyPokeDelivery",value:function(e,t,r){var n=this,i=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),o=i?(new Date).getTime()-i:t;o>=t?(r.filter(function(t){return t.pendingCorrelationId===e}).forEach(function(e){e.updatePending(null,null),e.retryCount++,n.persisted.delete(e.sid)}),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e)):setTimeout(function(){return n.verifyPokeDelivery(e,t,r)},t-o)}},{key:"processLocalActions",value:function(e,t){return"cancel"===e?t.filter(function(e){return!e.rejectedWithError}):t}},{key:"recordActionAttemptOn",value:function(e,t,r){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,r);else{var n=this.persisted.get(e.sid);n&&n.updatePending(t,r)}}},{key:"recordActionFailureOn",value:function(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}},{key:"request",value:function(e,t,r,n){var i=n.map(function(t){return{object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0,index_name:"establish"===e?t.indexName:void 0,live_query:"establish"===e?t.jsonQuery:void 0,query_string:"establish"===e?t.queryString:void 0}}),o=n.filter(function(e){return e.retryCount>0}).length;p.default.debug("Attempting '"+e+"' request (c:"+t+"):",i);var s={event_protocol_version:3,action:e,correlation_id:t,retried_requests:o,ttl_in_s:-1,requests:i};return"ttl"===r&&(s.reason=r),this.services.network.post(this.services.config.subscriptionsUri,s)}},{key:"add",value:function(e,t){p.default.debug("Establishing intent to subscribe to "+e);var r=this.subscriptions.get(e);r&&t&&r.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new m(t)),this.persist())}},{key:"remove",value:function(e){p.default.debug("Establishing intent to unsubscribe from "+e),this.subscriptions.delete(e)&&this.persist()}},{key:"acceptMessage",value:function(e,t){switch(p.default.trace("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(e.event_type.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:this.applyEventToSubscribedEntity(e.event_type.match(/^map_/)?e.event.map_sid:e.event_type.match(/^list_/)?e.event.list_sid:e.event_type.match(/^document_/)?e.event.document_sid:e.event_type.match(/^stream_/)?e.event.stream_sid:e.event_type.match(/^live_query/)?e.event.query_id:void 0,e,t);break;default:p.default.debug("Dropping unknown message type "+e.event_type)}}},{key:"applySubscriptionEstablishedMessage",value:function(e,t){var r=e.object_sid,n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?"interrupted"===e.replay_status?(p.default.debug("Event Replay for subscription to "+r+" (c:"+t+") interrupted; continuing eagerly."),n.updatePending(null,null),this.persisted.delete(n.sid),this.backoff.reset()):"completed"===e.replay_status&&(p.default.debug("Event Replay for subscription to "+r+" (c:"+t+") completed. Subscription is ready."),n.complete(e.last_event_id),this.persisted.set(e.object_sid,n),n.setSubscriptionState("established"),this.backoff.reset()):p.default.debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{key:"applySubscriptionCancelledMessage",value:function(e,t){var r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?(r.updatePending(null,null),r.setSubscriptionState("none"),this.persisted.delete(e.object_sid)):p.default.debug("Late message for "+e.object_sid+" (c:"+t+") dropped."),this.persist()}},{key:"applySubscriptionFailedMessage",value:function(e,t){var r=e.object_sid,n=this.subscriptions.get(r),i=this.persisted.get(r);n&&i?i.pendingCorrelationId===t&&(p.default.error("Failed to subscribe on "+i.sid,e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!n&&i&&(this.persisted.delete(r),i.setSubscriptionState("none")),this.persist()}},{key:"applyEventToSubscribedEntity",value:function(e,t,r){if(e){var n;r=r||(n=this.persisted.get(e))&&n.isEstablished;var i=this.subscriptions.get(e);i?(t.event.type=t.event_type,i.update(t.event,r)):p.default.debug("Message dropped for SID '"+e+"', for which there is no subscription.")}}},{key:"onConnectionStateChanged",value:function(e){this.isConnected=e,e&&this.poke("reconnect")}},{key:"onSubscriptionTtlElapsed",value:function(){this.isConnected&&this.poke("ttl")}},{key:"poke",value:function(e){p.default.debug("Triggering event replay for all subscriptions, reason="+e),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t=[],r=!0,n=!1,i=void 0;try{for(var s,a=(0,o.default)(this.persisted.values());!(r=(s=a.next()).done);r=!0){var u=s.value;u.reset(),u.rejectedWithError&&t.push(u)}}catch(e){n=!0,i=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}this.persisted.clear();var c=!0,l=!1,f=void 0;try{for(var d,h=(0,o.default)(t);!(c=(d=h.next()).done);c=!0){var b=d.value;this.persisted.set(b.sid,b)}}catch(e){l=!0,f=e}finally{try{!c&&h.return&&h.return()}finally{if(l)throw f}}this.persist()}},{key:"shutdown",value:function(){this.backoff.reset(),this.subscriptions.clear()}}]),e}();r.Subscriptions=v},{"./logger":9,"./syncerror":29,"babel-runtime/core-js/get-iterator":34,"babel-runtime/core-js/map":37,"babel-runtime/core-js/object/assign":38,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/slicedToArray":56,"babel-runtime/regenerator":59,backoff:60,twilsock:229}],27:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments[3];(0,i.default)(this,t);var u=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e,r,s));return u.body=a,u}return(0,s.default)(t,e),t}(e("./syncerror").SyncError);r.SyncNetworkError=u,r.default=u},{"./syncerror":29,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],28:[function(e,t,r){"use strict";var n=d(e("babel-runtime/core-js/promise")),i=d(e("babel-runtime/core-js/object/assign")),o=d(e("babel-runtime/regenerator")),s=d(e("babel-runtime/helpers/asyncToGenerator")),a=d(e("babel-runtime/core-js/object/get-prototype-of")),u=d(e("babel-runtime/helpers/classCallCheck")),c=d(e("babel-runtime/helpers/createClass")),l=d(e("babel-runtime/helpers/possibleConstructorReturn")),f=d(e("babel-runtime/helpers/inherits"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=e("./logger"),h=e("./entity"),b=e("./utils"),m=e("./mergingqueue"),v=e("./syncerror"),y=function(e){function t(e,r,n){(0,u.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n));i.isDeleted=!1;return i.updateMergingQueue=new m.MergingQueue(function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e}),i.descriptor=r,i.descriptor.data=i.descriptor.data||{},i.descriptor.date_updated=new Date(i.descriptor.date_updated),i}return(0,f.default)(t,e),(0,c.default)(t,[{key:"_update",value:function(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":e.id>this.lastEventId?(this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.emit("updated",{value:e.document_data,isLocal:!1}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data})):p.default.trace("Document update skipped, current:",this.lastEventId,", remote:",e.id);break;case"document_removed":this.onRemoved(!1)}}},{key:"set",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r){var n,i=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r||{},b.validateOptionalTtl(n.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(n,function(e){return i._setUnconditionally(t,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"mutate",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r){var n,i=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r||{},b.validateOptionalTtl(n.ttl),e.abrupt("return",this.updateMergingQueue.add(n,function(e){return i._setWithIfMatch(t,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(function(e){return(0,i.default)(e,t)},r));case 1:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setTtl",value:function(){var e=(0,s.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return b.validateMandatoryTtl(t),e.next=3,this._postUpdateToServer({ttl:t});case 3:r=e.sent,this.descriptor.date_expires=r.date_expires;case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_setUnconditionally",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._postUpdateToServer({data:t,revision:void 0,ttl:r});case 2:return n=e.sent,this._handleSuccessfulUpdateResult(n),e.abrupt("return",this.value);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_setWithIfMatch",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r){var n,i,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t(b.deepClone(this.value)))){e.next=22;break}return i=this.revision,e.prev=3,e.next=6,this._postUpdateToServer({data:n,revision:i,ttl:r});case 6:return s=e.sent,this._handleSuccessfulUpdateResult(s),e.abrupt("return",this.value);case 11:if(e.prev=11,e.t0=e.catch(3),412!==e.t0.status){e.next=19;break}return e.next=16,this._softSync();case 16:return e.abrupt("return",this._setWithIfMatch(t));case 19:throw e.t0;case 20:e.next=23;break;case 22:return e.abrupt("return",this.value);case 23:case"end":return e.stop()}},e,this,[[3,11]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"_handleSuccessfulUpdateResult",value:function(e){e.last_event_id>this.descriptor.last_event_id&&(this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.emit("updated",{value:this.value,isLocal:!0}))}},{key:"_postUpdateToServer",value:function(){var e=(0,s.default)(o.default.mark(function e(t){var r,i,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=17;break}return r={data:t.data},"number"==typeof t.ttl&&(r.ttl=t.ttl),i=t.revision,e.prev=4,e.next=7,this.services.network.post(this.uri,r,i);case 7:return s=e.sent,e.abrupt("return",{revision:s.body.revision,data:t.data,last_event_id:s.body.last_event_id,date_updated:s.body.date_updated,date_expires:s.body.date_expires});case 11:throw e.prev=11,e.t0=e.catch(4),404===e.t0.status&&this.onRemoved(!1),e.t0;case 15:e.next=18;break;case 17:return e.abrupt("return",n.default.reject(new v.SyncError("The Document has been removed",404,54100)));case 18:case"end":return e.stop()}},e,this,[[4,11]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_softSync",value:function(){var e=(0,s.default)(o.default.mark(function e(){var t=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.network.get(this.uri).then(function(e){var r={type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated};return t._update(r),t}).catch(function(e){404===e.status?t.onRemoved(!1):p.default.error("Can't get updates for "+t.sid+":",e)}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onRemoved",value:function(e){this.isDeleted||(this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e}))}},{key:"removeDocument",value:function(){var e=(0,s.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDeleted){e.next=6;break}return e.next=3,this.services.network.delete(this.uri);case 3:this.onRemoved(!0),e.next=7;break;case 6:return e.abrupt("return",n.default.reject(new v.SyncError("The Document has been removed",404,54100)));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"document"}},{key:"indexName",get:function(){}},{key:"jsonQuery",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"value",get:function(){return this.descriptor.data}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}}],[{key:"type",get:function(){return"document"}}]),t}(h.SyncEntity);r.SyncDocument=y,r.default=y},{"./entity":6,"./logger":9,"./mergingqueue":20,"./syncerror":29,"./utils":32,"babel-runtime/core-js/object/assign":38,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59}],29:[function(e,t,r){"use strict";var n=f(e("babel-runtime/core-js/object/create")),i=f(e("babel-runtime/core-js/object/set-prototype-of")),o=f(e("babel-runtime/core-js/array/from")),s=f(e("babel-runtime/core-js/reflect/construct")),a=f(e("babel-runtime/core-js/object/get-prototype-of")),u=f(e("babel-runtime/helpers/classCallCheck")),c=f(e("babel-runtime/helpers/possibleConstructorReturn")),l=f(e("babel-runtime/helpers/inherits"));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var d=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,u.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return i.name=i.constructor.name,i.message=e+" (status: "+r+", code: "+n+")",i.status=r,i.code=n,i}return(0,l.default)(t,e),t}(function(e){function t(){var t=(0,s.default)(e,(0,o.default)(arguments));return(0,i.default)(t,(0,a.default)(this)),t}return t.prototype=(0,n.default)(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i.default?(0,i.default)(t,e):t.__proto__=e,t}(Error));r.SyncError=d,r.default=d},{"babel-runtime/core-js/array/from":33,"babel-runtime/core-js/object/create":39,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/object/set-prototype-of":44,"babel-runtime/core-js/reflect/construct":46,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],30:[function(e,t,r){"use strict";var n=f(e("babel-runtime/core-js/object/assign")),i=f(e("babel-runtime/regenerator")),o=f(e("babel-runtime/helpers/asyncToGenerator")),s=f(e("babel-runtime/core-js/object/get-prototype-of")),a=f(e("babel-runtime/helpers/classCallCheck")),u=f(e("babel-runtime/helpers/createClass")),c=f(e("babel-runtime/helpers/possibleConstructorReturn")),l=f(e("babel-runtime/helpers/inherits"));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var d=e("./utils"),p=e("./logger"),h=e("./entity"),b=e("./listitem"),m=e("./paginator"),v=e("./cache"),y=e("./mergingqueue"),g=e("./syncerror"),_=function(e){function t(e,r,n){(0,a.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this,e,n));return i.updateMergingQueue=new y.NamespacedMergingQueue(function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e}),i.cache=new v.Cache,i.descriptor=r,i.descriptor.date_updated=new Date(i.descriptor.date_updated),i}return(0,l.default)(t,e),(0,u.default)(t,[{key:"_addOrUpdateItemOnServer",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r,n,o){var s,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={data:r},"number"==typeof o&&(s.ttl=o),e.next=4,this.services.network.post(t,s,n);case 4:return(a=e.sent).body.data=r,a.body.date_updated=new Date(a.body.date_updated),e.abrupt("return",a.body);case 8:case"end":return e.stop()}},e,this)}));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"push",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r){var n,o,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=(r||{}).ttl,d.validateOptionalTtl(n),e.next=4,this._addOrUpdateItemOnServer(this.links.items,t,void 0,n);case 4:return o=e.sent,s=Number(o.index),this._handleItemMutated(s,o.url,o.last_event_id,o.revision,t,o.date_updated,o.date_expires,!0,!1),e.abrupt("return",this.cache.get(s));case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"set",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r,n){var o,s=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n||{},d.validateOptionalTtl(o.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,o,function(e){return s._updateItemUnconditionally(t,r,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_updateItemUnconditionally",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r,n){var o,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return o=e.sent,e.next=5,this._addOrUpdateItemOnServer(o.uri,r,void 0,n);case 5:return s=e.sent,this._handleItemMutated(t,s.url,s.last_event_id,s.revision,s.data,s.date_updated,s.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 8:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_updateItemWithIfMatch",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r,n){var o,s,a,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:if(o=e.sent,!(s=r(d.deepClone(o.value)))){e.next=25;break}return a=o.revision,e.prev=6,e.next=9,this._addOrUpdateItemOnServer(o.uri,s,a,n);case 9:return u=e.sent,this._handleItemMutated(t,u.url,u.last_event_id,u.revision,u.data,u.date_updated,u.date_expires,!1,!1),e.abrupt("return",this.cache.get(t));case 14:if(e.prev=14,e.t0=e.catch(6),412!==e.t0.status){e.next=22;break}return e.next=19,this._getItemFromServer(t);case 19:return e.abrupt("return",this._updateItemWithIfMatch(t,r,n));case 22:throw e.t0;case 23:e.next=26;break;case 25:return e.abrupt("return",o);case 26:case"end":return e.stop()}},e,this,[[6,14]])}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"mutate",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r,n){var o,s=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n||{},d.validateOptionalTtl(o.ttl),e.abrupt("return",this.updateMergingQueue.add(t,o,function(e){return s._updateItemWithIfMatch(t,r,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r,o){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,function(e){return(0,n.default)(e,r)},o));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,o.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t);case 2:return r=e.sent,e.next=5,this.services.network.delete(r.uri);case 5:n=e.sent,this._handleItemRemoved(t,n.body.last_event_id,void 0,new Date(n.body.date_updated),!1);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=(0,o.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.cache.get(t))){e.next=5;break}return e.abrupt("return",r);case 5:return e.abrupt("return",this._getItemFromServer(t));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:function(){var e=(0,o.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({index:t});case 2:if(!((r=e.sent).items.length<1)){e.next=7;break}throw new g.SyncError("No item with index "+t+" found",404,54151);case 7:return e.abrupt("return",r.items[0]);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"queryItems",value:function(){var e=(0,o.default)(i.default.mark(function e(t){var r,n,o,s,a=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},r=new d.UriBuilder(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Index",t.index).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(r);case 4:return n=e.sent,o=n.body.items.map(function(e){return e.date_updated=new Date(e.date_updated),a.cache.get(e.index)?a._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):a.cache.store(Number(e.index),new b.ListItem({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,value:e.data}),e.last_event_id),a.cache.get(e.index)}),s=n.body.meta,e.abrupt("return",new m.Paginator(o,function(e){return a.queryItems({pageToken:e})},s.previous_token,s.next_token));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:function(){var e=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},d.validatePageSize(t.pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getContext",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.context){e.next=5;break}return e.next=3,this.services.network.get(this.links.context);case 3:t=e.sent,this._updateContextIfRequired(t.body.data,t.body.last_event_id);case 5:return e.abrupt("return",this.context);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"setTtl",value:function(){var e=(0,o.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.validateMandatoryTtl(t),e.prev=1,r={ttl:t},e.next=5,this.services.network.post(this.uri,r);case 5:n=e.sent,this.descriptor.date_expires=n.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"setItemTtl",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r){var n,o,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.validateMandatoryTtl(r),e.next=3,this.get(t);case 3:return n=e.sent,o={ttl:r},e.next=7,this.services.network.post(n.uri,o);case 7:s=e.sent,n.updateDateExpires(s.body.date_expires);case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeList",value:function(){var e=(0,o.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){var r=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(r,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(r,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,r,n,i,o,s,a,u){if(this.shouldIgnoreEvent(e,r))p.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",r);else{this._updateRootDateUpdated(o);var c=this.cache.get(e);if(c)c.lastEventId<r&&(c.update(r,n,i,o),void 0!==s&&c.updateDateExpires(s),this.emitItemMutationEvent(c,u,!1));else{var l=new b.ListItem({index:e,uri:t,lastEventId:r,revision:n,value:i,dateUpdated:o,dateExpires:s});this.cache.store(e,l,r),this.emitItemMutationEvent(l,u,a)}}}},{key:"emitItemMutationEvent",value:function(e,t,r){var n=r?"itemAdded":"itemUpdated";this.emit(n,{item:e,isLocal:!t})}},{key:"_handleItemRemoved",value:function(e,t,r,n,i){this._updateRootDateUpdated(n),this.cache.delete(e,t),this.emit("itemRemoved",{index:e,isLocal:!i,value:r})}},{key:"_handleContextUpdate",value:function(e,t,r){this._updateRootDateUpdated(r),this._updateContextIfRequired(e,t)&&this.emit("contextUpdated",{context:e,isLocal:!1})}},{key:"_updateContextIfRequired",value:function(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(p.default.trace("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}},{key:"uri",get:function(){return this.descriptor.url}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"links",get:function(){return this.descriptor.links}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"list"}},{key:"indexName",get:function(){}},{key:"jsonQuery",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}],[{key:"type",get:function(){return"list"}}]),t}(h.SyncEntity);r.SyncList=_,r.default=_},{"./cache":1,"./entity":6,"./listitem":7,"./logger":9,"./mergingqueue":20,"./paginator":21,"./syncerror":29,"./utils":32,"babel-runtime/core-js/object/assign":38,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59}],31:[function(e,t,r){"use strict";var n=d(e("babel-runtime/core-js/promise")),i=d(e("babel-runtime/core-js/object/assign")),o=d(e("babel-runtime/regenerator")),s=d(e("babel-runtime/helpers/asyncToGenerator")),a=d(e("babel-runtime/core-js/object/get-prototype-of")),u=d(e("babel-runtime/helpers/classCallCheck")),c=d(e("babel-runtime/helpers/createClass")),l=d(e("babel-runtime/helpers/possibleConstructorReturn")),f=d(e("babel-runtime/helpers/inherits"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=e("./utils"),h=e("./logger"),b=e("./entity"),m=e("./mapitem"),v=e("./paginator"),y=e("./cache"),g=e("./mergingqueue"),_=e("./syncerror"),k=function(e){function t(e,r,n){(0,u.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n));return i.updateMergingQueue=new g.NamespacedMergingQueue(function(e,t){return"number"==typeof t.ttl?{ttl:t.ttl}:e}),i.cache=new y.Cache,i.descriptor=r,i.descriptor.date_updated=new Date(i.descriptor.date_updated),r.items&&r.items.forEach(function(e){e.date_updated=new Date(e.date_updated),i.cache.store(e.key,new m.MapItem(e),e.last_event_id)}),i}return(0,f.default)(t,e),(0,c.default)(t,[{key:"set",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r,n){var i,s=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n||{},p.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.squashAndAdd(t,i,function(e){return s._putItemUnconditionally(t,r,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.cache.has(t)){e.next=4;break}return e.abrupt("return",this.cache.get(t));case 4:return e.abrupt("return",this._getItemFromServer(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_getItemFromServer",value:function(){var e=(0,s.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.queryItems({key:t});case 2:if(!((r=e.sent).items.length<1)){e.next=7;break}throw new _.SyncError("No item with key "+t+" found",404,54201);case 7:return e.abrupt("return",r.items[0]);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"mutate",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r,n){var i,s=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=n||{},p.validateOptionalTtl(i.ttl),e.abrupt("return",this.updateMergingQueue.add(t,i,function(e){return s._putItemWithIfMatch(t,r,e.ttl)}));case 3:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"update",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r,n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mutate(t,function(e){return(0,i.default)(e,r)},n));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_putItemUnconditionally",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r,n){var i,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._putItemToServer(t,r,void 0,n);case 2:return i=e.sent,s=i.item,this._handleItemMutated(s.key,s.url,s.last_event_id,s.revision,s.data,s.date_updated,s.date_expires,i.added,!1),e.abrupt("return",this.cache.get(s.key));case 6:case"end":return e.stop()}},e,this)}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_putItemWithIfMatch",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r,n){var i,s,a,u,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(t).catch(function(e){if(404===e.status)return new m.MapItem({key:t,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw e});case 2:if(i=e.sent,!(s=r(p.deepClone(i.value)))){e.next=26;break}return a=i.revision,e.prev=6,e.next=9,this._putItemToServer(t,s,a,n);case 9:return u=e.sent,c=u.item,this._handleItemMutated(c.key,c.url,c.last_event_id,c.revision,c.data,c.date_updated,c.date_expires,u.added,!1),e.abrupt("return",this.cache.get(c.key));case 15:if(e.prev=15,e.t0=e.catch(6),412!==e.t0.status){e.next=23;break}return e.next=20,this._getItemFromServer(t);case 20:return e.abrupt("return",this._putItemWithIfMatch(t,r,n));case 23:throw e.t0;case 24:e.next=27;break;case 26:return e.abrupt("return",i);case 27:case"end":return e.stop()}},e,this,[[6,15]])}));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_putItemToServer",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r,n,i){var s,a,u,c,l;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=new p.UriBuilder(this.links.items).pathSegment(t).build(),a={data:r},"number"==typeof i&&(a.ttl=i),e.prev=3,e.next=6,this.services.network.put(s,a,n);case 6:return u=e.sent,(c=u.body).data=r,c.date_updated=new Date(c.date_updated),l=201===u.status.code,e.abrupt("return",{added:l,item:c});case 14:throw e.prev=14,e.t0=e.catch(3),404===e.t0.status&&this.onRemoved(!1),e.t0;case 18:case"end":return e.stop()}},e,this,[[3,14]])}));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}throw new Error("Key argument is invalid");case 2:return e.next=4,this.get(t);case 4:return r=e.sent,e.next=7,this.services.network.delete(r.uri);case 7:n=e.sent,this._handleItemRemoved(t,n.body.last_event_id,void 0,new Date(n.body.date_updated),!1);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"queryItems",value:function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n,i,s,a=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},r=new p.UriBuilder(this.links.items).queryParam("From",t.from).queryParam("PageSize",t.limit).queryParam("Key",t.key).queryParam("PageToken",t.pageToken).queryParam("Order",t.order).build(),e.next=4,this.services.network.get(r);case 4:return n=e.sent,i=n.body.items.map(function(e){return e.date_updated=new Date(e.date_updated),a.cache.get(e.key)?a._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):a.cache.store(e.key,new m.MapItem(e),e.last_event_id),a.cache.get(e.key)}),s=n.body.meta,e.abrupt("return",new v.Paginator(i,function(e){return a.queryItems({pageToken:e})},s.previous_token,s.next_token));case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getItems",value:function(){var e=(0,s.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},p.validatePageSize(t.pageSize),t.limit=t.pageSize||t.limit||50,t.order=t.order||"asc",e.abrupt("return",this.queryItems(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"forEach",value:function(e){var t=this;return new n.default(function(r,n){t.queryItems().then(function t(i){i.items.forEach(function(t){return e(t)}),i.hasNextPage?i.nextPage().then(t).catch(n):r()}).catch(n)})}},{key:"shouldIgnoreEvent",value:function(e,t){return this.cache.isKnown(e,t)}},{key:"_update",value:function(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}},{key:"_advanceLastEventId",value:function(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}},{key:"_updateRootDateUpdated",value:function(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}},{key:"_handleItemMutated",value:function(e,t,r,n,i,o,s,a,u){if(this.shouldIgnoreEvent(e,r))h.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",r);else{this._updateRootDateUpdated(o);var c=this.cache.get(e);c?c.lastEventId<r&&(c.update(r,n,i,o),void 0!==s&&c.updateDateExpires(s),this.emitItemMutationEvent(c,u,!1)):(c=new m.MapItem({key:e,url:t,last_event_id:r,revision:n,data:i,date_updated:o,date_expires:s}),this.cache.store(e,c,r),this.emitItemMutationEvent(c,u,a))}}},{key:"emitItemMutationEvent",value:function(e,t,r){var n=r?"itemAdded":"itemUpdated";this.emit(n,{item:e,isLocal:!t})}},{key:"_handleItemRemoved",value:function(e,t,r,n,i){this._updateRootDateUpdated(n),this.cache.delete(e,t),this.emit("itemRemoved",{key:e,isLocal:!i,value:r})}},{key:"onRemoved",value:function(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.emit("removed",{isLocal:e})}},{key:"setTtl",value:function(){var e=(0,s.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.validateMandatoryTtl(t),e.prev=1,r={ttl:t},e.next=5,this.services.network.post(this.uri,r);case 5:n=e.sent,this.descriptor.date_expires=n.body.date_expires,e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),404===e.t0.status&&this.onRemoved(!1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"setItemTtl",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r){var n,i,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.validateMandatoryTtl(r),e.next=3,this.get(t);case 3:return n=e.sent,i={ttl:r},e.next=7,this.services.network.post(n.uri,i);case 7:s=e.sent,n.updateDateExpires(s.body.date_expires);case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeMap",value:function(){var e=(0,s.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.network.delete(this.uri);case 2:this.onRemoved(!0);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"uri",get:function(){return this.descriptor.url}},{key:"links",get:function(){return this.descriptor.links}},{key:"revision",get:function(){return this.descriptor.revision}},{key:"lastEventId",get:function(){return this.descriptor.last_event_id}},{key:"dateExpires",get:function(){return this.descriptor.date_expires}},{key:"type",get:function(){return"map"}},{key:"indexName",get:function(){}},{key:"jsonQuery",get:function(){}},{key:"queryString",get:function(){}},{key:"sid",get:function(){return this.descriptor.sid}},{key:"uniqueName",get:function(){return this.descriptor.unique_name||null}},{key:"dateUpdated",get:function(){return this.descriptor.date_updated}}],[{key:"type",get:function(){return"map"}}]),t}(b.SyncEntity);r.SyncMap=k,r.default=k},{"./cache":1,"./entity":6,"./logger":9,"./mapitem":19,"./mergingqueue":20,"./paginator":21,"./syncerror":29,"./utils":32,"babel-runtime/core-js/object/assign":38,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59}],32:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass")),o=s(e("babel-runtime/core-js/json/stringify"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./syncerror");function u(e){return!isNaN(parseInt(e))&&isFinite(e)}function c(e){return u(e)&&e>=0}r.deepClone=function(e){return JSON.parse((0,o.default)(e))},r.validateOptionalTtl=function(e){if(void 0!==e&&!c(e))throw new a.default("Invalid TTL value, expected a positive integer, was '"+e+"'",400,54011)},r.validateMandatoryTtl=function(e){if(!c(e))throw new a.default("Invalid TTL value, expected a positive integer, was '"+e+"'",400,54011)},r.validatePageSize=function(e){var t;if(!(void 0===e||u(t=e)&&t>0))throw new a.default("Invalid pageSize parameter. Expected a positive integer, was '"+e+"'.",400,54455)};var l=function(){function e(t){(0,n.default)(this,e),this.base=t,this.args=new Array,this.paths=new Array}return(0,i.default)(e,[{key:"pathSegment",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"queryParam",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();r.UriBuilder=l},{"./syncerror":29,"babel-runtime/core-js/json/stringify":36,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],33:[function(e,t,r){t.exports={default:e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":67}],34:[function(e,t,r){t.exports={default:e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":68}],35:[function(e,t,r){t.exports={default:e("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":69}],36:[function(e,t,r){t.exports={default:e("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":70}],37:[function(e,t,r){t.exports={default:e("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":71}],38:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":72}],39:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":73}],40:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":74}],41:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/get-own-property-descriptor"),__esModule:!0}},{"core-js/library/fn/object/get-own-property-descriptor":75}],42:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":76}],43:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":77}],44:[function(e,t,r){t.exports={default:e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":78}],45:[function(e,t,r){t.exports={default:e("core-js/library/fn/promise"),__esModule:!0}},{"core-js/library/fn/promise":79}],46:[function(e,t,r){t.exports={default:e("core-js/library/fn/reflect/construct"),__esModule:!0}},{"core-js/library/fn/reflect/construct":80}],47:[function(e,t,r){t.exports={default:e("core-js/library/fn/set"),__esModule:!0}},{"core-js/library/fn/set":81}],48:[function(e,t,r){t.exports={default:e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":82}],49:[function(e,t,r){t.exports={default:e("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":83}],50:[function(e,t,r){"use strict";r.__esModule=!0;var n,i=e("../core-js/promise"),o=(n=i)&&n.__esModule?n:{default:n};r.default=function(e){return function(){var t=e.apply(this,arguments);return new o.default(function(e,r){return function n(i,s){try{var a=t[i](s),u=a.value}catch(e){return void r(e)}if(!a.done)return o.default.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)});e(u)}("next")})}}},{"../core-js/promise":45}],51:[function(e,t,r){"use strict";r.__esModule=!0,r.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],52:[function(e,t,r){"use strict";r.__esModule=!0;var n,i=e("../core-js/object/define-property"),o=(n=i)&&n.__esModule?n:{default:n};r.default=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),(0,o.default)(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()},{"../core-js/object/define-property":40}],53:[function(e,t,r){"use strict";r.__esModule=!0;var n=o(e("../core-js/object/get-prototype-of")),i=o(e("../core-js/object/get-own-property-descriptor"));function o(e){return e&&e.__esModule?e:{default:e}}r.default=function e(t,r,o){null===t&&(t=Function.prototype);var s=(0,i.default)(t,r);if(void 0===s){var a=(0,n.default)(t);return null===a?void 0:e(a,r,o)}if("value"in s)return s.value;var u=s.get;return void 0!==u?u.call(o):void 0}},{"../core-js/object/get-own-property-descriptor":41,"../core-js/object/get-prototype-of":42}],54:[function(e,t,r){"use strict";r.__esModule=!0;var n=s(e("../core-js/object/set-prototype-of")),i=s(e("../core-js/object/create")),o=s(e("../helpers/typeof"));function s(e){return e&&e.__esModule?e:{default:e}}r.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,o.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}},{"../core-js/object/create":39,"../core-js/object/set-prototype-of":44,"../helpers/typeof":58}],55:[function(e,t,r){"use strict";r.__esModule=!0;var n,i=e("../helpers/typeof"),o=(n=i)&&n.__esModule?n:{default:n};r.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,o.default)(t))&&"function"!=typeof t?e:t}},{"../helpers/typeof":58}],56:[function(e,t,r){"use strict";r.__esModule=!0;var n=o(e("../core-js/is-iterable")),i=o(e("../core-js/get-iterator"));function o(e){return e&&e.__esModule?e:{default:e}}r.default=function(){return function(e,t){if(Array.isArray(e))return e;if((0,n.default)(Object(e)))return function(e,t){var r=[],n=!0,o=!1,s=void 0;try{for(var a,u=(0,i.default)(e);!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(o)throw s}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},{"../core-js/get-iterator":34,"../core-js/is-iterable":35}],57:[function(e,t,r){"use strict";r.__esModule=!0;var n,i=e("../core-js/array/from"),o=(n=i)&&n.__esModule?n:{default:n};r.default=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return(0,o.default)(e)}},{"../core-js/array/from":33}],58:[function(e,t,r){"use strict";r.__esModule=!0;var n=s(e("../core-js/symbol/iterator")),i=s(e("../core-js/symbol")),o="function"==typeof i.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function s(e){return e&&e.__esModule?e:{default:e}}r.default="function"==typeof i.default&&"symbol"===o(n.default)?function(e){return void 0===e?"undefined":o(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":o(e)}},{"../core-js/symbol":48,"../core-js/symbol/iterator":49}],59:[function(e,t,r){t.exports=e("regenerator-runtime")},{"regenerator-runtime":211}],60:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("./lib/backoff"),i=e("./lib/strategy/exponential"),o=e("./lib/strategy/fibonacci"),s=e("./lib/function_call.js");t.exports.Backoff=n,t.exports.FunctionCall=s,t.exports.FibonacciStrategy=o,t.exports.ExponentialStrategy=i,t.exports.fibonacci=function(e){return new n(new o(e))},t.exports.exponential=function(e){return new n(new i(e))},t.exports.call=function(e,t,r){var n=Array.prototype.slice.call(arguments);return e=n[0],t=n.slice(1,n.length-1),r=n[n.length-1],new s(e,t,r)}},{"./lib/backoff":61,"./lib/function_call.js":62,"./lib/strategy/exponential":63,"./lib/strategy/fibonacci":64}],61:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("events"),i=e("precond");function o(e){n.EventEmitter.call(this),this.backoffStrategy_=e,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}e("util").inherits(o,n.EventEmitter),o.prototype.failAfter=function(e){i.checkArgument(e>0,"Expected a maximum number of retry greater than 0 but got %s.",e),this.maxNumberOfRetry_=e},o.prototype.backoff=function(e){i.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",e),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,e))},o.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},o.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},t.exports=o},{events:200,precond:207,util:249}],62:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("events"),i=e("precond"),o=e("util"),s=e("./backoff"),a=e("./strategy/fibonacci");function u(e,t,r){n.EventEmitter.call(this),i.checkIsFunction(e,"Expected fn to be a function."),i.checkIsArray(t,"Expected args to be an array."),i.checkIsFunction(r,"Expected callback to be a function."),this.function_=e,this.arguments_=t,this.callback_=r,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=u.DEFAULT_RETRY_PREDICATE_,this.state_=u.State_.PENDING}o.inherits(u,n.EventEmitter),u.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},u.DEFAULT_RETRY_PREDICATE_=function(e){return!0},u.prototype.isPending=function(){return this.state_==u.State_.PENDING},u.prototype.isRunning=function(){return this.state_==u.State_.RUNNING},u.prototype.isCompleted=function(){return this.state_==u.State_.COMPLETED},u.prototype.isAborted=function(){return this.state_==u.State_.ABORTED},u.prototype.setStrategy=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=e,this},u.prototype.retryIf=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=e,this},u.prototype.getLastResult=function(){return this.lastResult_.concat()},u.prototype.getNumRetries=function(){return this.numRetries_},u.prototype.failAfter=function(e){return i.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=e,this},u.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=u.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},u.prototype.start=function(e){i.checkState(!this.isAborted(),"FunctionCall is aborted."),i.checkState(this.isPending(),"FunctionCall already started.");var t=this.strategy_||new a;this.backoff_=e?e(t):new s(t),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=u.State_.RUNNING,this.doCall_(!1)},u.prototype.doCall_=function(e){e&&this.numRetries_++;var t=["call"].concat(this.arguments_);n.EventEmitter.prototype.emit.apply(this,t);var r=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(r))},u.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},u.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var e=Array.prototype.slice.call(arguments);this.lastResult_=e,n.EventEmitter.prototype.emit.apply(this,["callback"].concat(e));var t=e[0];t&&this.retryPredicate_(t)?this.backoff_.backoff(t):(this.state_=u.State_.COMPLETED,this.doCallback_())}},u.prototype.handleBackoff_=function(e,t,r){this.emit("backoff",e,t,r)},t.exports=u},{"./backoff":61,"./strategy/fibonacci":64,events:200,precond:207,util:249}],63:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("util"),i=e("precond"),o=e("./strategy");function s(e){o.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=s.DEFAULT_FACTOR,e&&void 0!==e.factor&&(i.checkArgument(e.factor>1,"Exponential factor should be greater than 1 but got %s.",e.factor),this.factor_=e.factor)}n.inherits(s,o),s.DEFAULT_FACTOR=2,s.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},s.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},t.exports=s},{"./strategy":65,precond:207,util:249}],64:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
var n=e("util"),i=e("./strategy");function o(e){i.call(this,e),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}n.inherits(o,i),o.prototype.next_=function(){var e=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=e,e},o.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},t.exports=o},{"./strategy":65,util:249}],65:[function(e,t,r){
//      Copyright (c) 2012 Mathieu Turcotte
//      Licensed under the MIT license.
e("events"),e("util");function n(e){return null!=e}function i(e){if(n((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(n(e.maxDelay)&&e.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=e.initialDelay||100,this.maxDelay_=e.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(n(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=e.randomisationFactor||0}i.prototype.getMaxDelay=function(){return this.maxDelay_},i.prototype.getInitialDelay=function(){return this.initialDelay_},i.prototype.next=function(){var e=this.next_(),t=1+Math.random()*this.randomisationFactor_;return Math.round(e*t)},i.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},i.prototype.reset=function(){this.reset_()},i.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},t.exports=i},{events:200,util:249}],66:[function(e,t,r){},{}],67:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":99,"../../modules/es6.array.from":173,"../../modules/es6.string.iterator":187}],68:[function(e,t,r){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":171,"../modules/es6.string.iterator":187,"../modules/web.dom.iterable":199}],69:[function(e,t,r){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.is-iterable")},{"../modules/core.is-iterable":172,"../modules/es6.string.iterator":187,"../modules/web.dom.iterable":199}],70:[function(e,t,r){var n=e("../../modules/_core"),i=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(e){return i.stringify.apply(i,arguments)}},{"../../modules/_core":99}],71:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),e("../modules/es7.map.of"),e("../modules/es7.map.from"),t.exports=e("../modules/_core").Map},{"../modules/_core":99,"../modules/es6.map":175,"../modules/es6.object.to-string":183,"../modules/es6.string.iterator":187,"../modules/es7.map.from":189,"../modules/es7.map.of":190,"../modules/es7.map.to-json":191,"../modules/web.dom.iterable":199}],72:[function(e,t,r){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":99,"../../modules/es6.object.assign":176}],73:[function(e,t,r){e("../../modules/es6.object.create");var n=e("../../modules/_core").Object;t.exports=function(e,t){return n.create(e,t)}},{"../../modules/_core":99,"../../modules/es6.object.create":177}],74:[function(e,t,r){e("../../modules/es6.object.define-property");var n=e("../../modules/_core").Object;t.exports=function(e,t,r){return n.defineProperty(e,t,r)}},{"../../modules/_core":99,"../../modules/es6.object.define-property":178}],75:[function(e,t,r){e("../../modules/es6.object.get-own-property-descriptor");var n=e("../../modules/_core").Object;t.exports=function(e,t){return n.getOwnPropertyDescriptor(e,t)}},{"../../modules/_core":99,"../../modules/es6.object.get-own-property-descriptor":179}],76:[function(e,t,r){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":99,"../../modules/es6.object.get-prototype-of":180}],77:[function(e,t,r){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":99,"../../modules/es6.object.keys":181}],78:[function(e,t,r){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":99,"../../modules/es6.object.set-prototype-of":182}],79:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.promise"),e("../modules/es7.promise.finally"),e("../modules/es7.promise.try"),t.exports=e("../modules/_core").Promise},{"../modules/_core":99,"../modules/es6.object.to-string":183,"../modules/es6.promise":184,"../modules/es6.string.iterator":187,"../modules/es7.promise.finally":192,"../modules/es7.promise.try":193,"../modules/web.dom.iterable":199}],80:[function(e,t,r){e("../../modules/es6.reflect.construct"),t.exports=e("../../modules/_core").Reflect.construct},{"../../modules/_core":99,"../../modules/es6.reflect.construct":185}],81:[function(e,t,r){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.set"),e("../modules/es7.set.to-json"),e("../modules/es7.set.of"),e("../modules/es7.set.from"),t.exports=e("../modules/_core").Set},{"../modules/_core":99,"../modules/es6.object.to-string":183,"../modules/es6.set":186,"../modules/es6.string.iterator":187,"../modules/es7.set.from":194,"../modules/es7.set.of":195,"../modules/es7.set.to-json":196,"../modules/web.dom.iterable":199}],82:[function(e,t,r){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":99,"../../modules/es6.object.to-string":183,"../../modules/es6.symbol":188,"../../modules/es7.symbol.async-iterator":197,"../../modules/es7.symbol.observable":198}],83:[function(e,t,r){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":168,"../../modules/es6.string.iterator":187,"../../modules/web.dom.iterable":199}],84:[function(e,t,r){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],85:[function(e,t,r){t.exports=function(){}},{}],86:[function(e,t,r){t.exports=function(e,t,r,n){if(!(e instanceof t)||void 0!==n&&n in e)throw TypeError(r+": incorrect invocation!");return e}},{}],87:[function(e,t,r){var n=e("./_is-object");t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":119}],88:[function(e,t,r){var n=e("./_for-of");t.exports=function(e,t){var r=[];return n(e,!1,r.push,r,t),r}},{"./_for-of":109}],89:[function(e,t,r){var n=e("./_to-iobject"),i=e("./_to-length"),o=e("./_to-absolute-index");t.exports=function(e){return function(t,r,s){var a,u=n(t),c=i(u.length),l=o(s,c);if(e&&r!=r){for(;c>l;)if((a=u[l++])!=a)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===r)return e||l||0;return!e&&-1}}},{"./_to-absolute-index":158,"./_to-iobject":160,"./_to-length":161}],90:[function(e,t,r){var n=e("./_ctx"),i=e("./_iobject"),o=e("./_to-object"),s=e("./_to-length"),a=e("./_array-species-create");t.exports=function(e,t){var r=1==e,u=2==e,c=3==e,l=4==e,f=6==e,d=5==e||f,p=t||a;return function(t,a,h){for(var b,m,v=o(t),y=i(v),g=n(a,h,3),_=s(y.length),k=0,x=r?p(t,_):u?p(t,0):void 0;_>k;k++)if((d||k in y)&&(m=g(b=y[k],k,v),e))if(r)x[k]=m;else if(m)switch(e){case 3:return!0;case 5:return b;case 6:return k;case 2:x.push(b)}else if(l)return!1;return f?-1:c||l?l:x}}},{"./_array-species-create":92,"./_ctx":101,"./_iobject":116,"./_to-length":161,"./_to-object":162}],91:[function(e,t,r){var n=e("./_is-object"),i=e("./_is-array"),o=e("./_wks")("species");t.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},{"./_is-array":118,"./_is-object":119,"./_wks":169}],92:[function(e,t,r){var n=e("./_array-species-constructor");t.exports=function(e,t){return new(n(e))(t)}},{"./_array-species-constructor":91}],93:[function(e,t,r){"use strict";var n=e("./_a-function"),i=e("./_is-object"),o=e("./_invoke"),s=[].slice,a={};t.exports=Function.bind||function(e){var t=n(this),r=s.call(arguments,1),u=function(){var n=r.concat(s.call(arguments));return this instanceof u?function(e,t,r){if(!(t in a)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";a[t]=Function("F,a","return new F("+n.join(",")+")")}return a[t](e,r)}(t,n.length,n):o(t,n,e)};return i(t.prototype)&&(u.prototype=t.prototype),u}},{"./_a-function":84,"./_invoke":115,"./_is-object":119}],94:[function(e,t,r){var n=e("./_cof"),i=e("./_wks")("toStringTag"),o="Arguments"==n(function(){return arguments}());t.exports=function(e){var t,r,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?r:o?n(t):"Object"==(s=n(t))&&"function"==typeof t.callee?"Arguments":s}},{"./_cof":95,"./_wks":169}],95:[function(e,t,r){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],96:[function(e,t,r){"use strict";var n=e("./_object-dp").f,i=e("./_object-create"),o=e("./_redefine-all"),s=e("./_ctx"),a=e("./_an-instance"),u=e("./_for-of"),c=e("./_iter-define"),l=e("./_iter-step"),f=e("./_set-species"),d=e("./_descriptors"),p=e("./_meta").fastKey,h=e("./_validate-collection"),b=d?"_s":"size",m=function(e,t){var r,n=p(t);if("F"!==n)return e._i[n];for(r=e._f;r;r=r.n)if(r.k==t)return r};t.exports={getConstructor:function(e,t,r,c){var l=e(function(e,n){a(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[b]=0,null!=n&&u(n,r,e[c],e)});return o(l.prototype,{clear:function(){for(var e=h(this,t),r=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];e._f=e._l=void 0,e[b]=0},delete:function(e){var r=h(this,t),n=m(r,e);if(n){var i=n.n,o=n.p;delete r._i[n.i],n.r=!0,o&&(o.n=i),i&&(i.p=o),r._f==n&&(r._f=i),r._l==n&&(r._l=o),r[b]--}return!!n},forEach:function(e){h(this,t);for(var r,n=s(e,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(e){return!!m(h(this,t),e)}}),d&&n(l.prototype,"size",{get:function(){return h(this,t)[b]}}),l},def:function(e,t,r){var n,i,o=m(e,t);return o?o.v=r:(e._l=o={i:i=p(t,!0),k:t,v:r,p:n=e._l,n:void 0,r:!1},e._f||(e._f=o),n&&(n.n=o),e[b]++,"F"!==i&&(e._i[i]=o)),e},getEntry:m,setStrong:function(e,t,r){c(e,t,function(e,r){this._t=h(e,t),this._k=r,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))},r?"entries":"values",!r,!0),f(t)}}},{"./_an-instance":86,"./_ctx":101,"./_descriptors":103,"./_for-of":109,"./_iter-define":122,"./_iter-step":124,"./_meta":127,"./_object-create":131,"./_object-dp":132,"./_redefine-all":146,"./_set-species":151,"./_validate-collection":166}],97:[function(e,t,r){var n=e("./_classof"),i=e("./_array-from-iterable");t.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},{"./_array-from-iterable":88,"./_classof":94}],98:[function(e,t,r){"use strict";var n=e("./_global"),i=e("./_export"),o=e("./_meta"),s=e("./_fails"),a=e("./_hide"),u=e("./_redefine-all"),c=e("./_for-of"),l=e("./_an-instance"),f=e("./_is-object"),d=e("./_set-to-string-tag"),p=e("./_object-dp").f,h=e("./_array-methods")(0),b=e("./_descriptors");t.exports=function(e,t,r,m,v,y){var g=n[e],_=g,k=v?"set":"add",x=_&&_.prototype,w={};return b&&"function"==typeof _&&(y||x.forEach&&!s(function(){(new _).entries().next()}))?(_=t(function(t,r){l(t,_,e,"_c"),t._c=new g,null!=r&&c(r,v,t[k],t)}),h("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in x&&(!y||"clear"!=e)&&a(_.prototype,e,function(r,n){if(l(this,_,e),!t&&y&&!f(r))return"get"==e&&void 0;var i=this._c[e](0===r?0:r,n);return t?this:i})}),y||p(_.prototype,"size",{get:function(){return this._c.size}})):(_=m.getConstructor(t,e,v,k),u(_.prototype,r),o.NEED=!0),d(_,e),w[e]=_,i(i.G+i.W+i.F,w),y||m.setStrong(_,e,v),_}},{"./_an-instance":86,"./_array-methods":90,"./_descriptors":103,"./_export":107,"./_fails":108,"./_for-of":109,"./_global":110,"./_hide":112,"./_is-object":119,"./_meta":127,"./_object-dp":132,"./_redefine-all":146,"./_set-to-string-tag":152}],99:[function(e,t,r){var n=t.exports={version:"2.6.4"};"number"==typeof __e&&(__e=n)},{}],100:[function(e,t,r){"use strict";var n=e("./_object-dp"),i=e("./_property-desc");t.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},{"./_object-dp":132,"./_property-desc":145}],101:[function(e,t,r){var n=e("./_a-function");t.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":84}],102:[function(e,t,r){t.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},{}],103:[function(e,t,r){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":108}],104:[function(e,t,r){var n=e("./_is-object"),i=e("./_global").document,o=n(i)&&n(i.createElement);t.exports=function(e){return o?i.createElement(e):{}}},{"./_global":110,"./_is-object":119}],105:[function(e,t,r){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],106:[function(e,t,r){var n=e("./_object-keys"),i=e("./_object-gops"),o=e("./_object-pie");t.exports=function(e){var t=n(e),r=i.f;if(r)for(var s,a=r(e),u=o.f,c=0;a.length>c;)u.call(e,s=a[c++])&&t.push(s);return t}},{"./_object-gops":137,"./_object-keys":140,"./_object-pie":141}],107:[function(e,t,r){var n=e("./_global"),i=e("./_core"),o=e("./_ctx"),s=e("./_hide"),a=e("./_has"),u=function(e,t,r){var c,l,f,d=e&u.F,p=e&u.G,h=e&u.S,b=e&u.P,m=e&u.B,v=e&u.W,y=p?i:i[t]||(i[t]={}),g=y.prototype,_=p?n:h?n[t]:(n[t]||{}).prototype;for(c in p&&(r=t),r)(l=!d&&_&&void 0!==_[c])&&a(y,c)||(f=l?_[c]:r[c],y[c]=p&&"function"!=typeof _[c]?r[c]:m&&l?o(f,n):v&&_[c]==f?function(e){var t=function(t,r,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,r)}return new e(t,r,n)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(f):b&&"function"==typeof f?o(Function.call,f):f,b&&((y.virtual||(y.virtual={}))[c]=f,e&u.R&&g&&!g[c]&&s(g,c,f)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,t.exports=u},{"./_core":99,"./_ctx":101,"./_global":110,"./_has":111,"./_hide":112}],108:[function(e,t,r){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],109:[function(e,t,r){var n=e("./_ctx"),i=e("./_iter-call"),o=e("./_is-array-iter"),s=e("./_an-object"),a=e("./_to-length"),u=e("./core.get-iterator-method"),c={},l={};(r=t.exports=function(e,t,r,f,d){var p,h,b,m,v=d?function(){return e}:u(e),y=n(r,f,t?2:1),g=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(o(v)){for(p=a(e.length);p>g;g++)if((m=t?y(s(h=e[g])[0],h[1]):y(e[g]))===c||m===l)return m}else for(b=v.call(e);!(h=b.next()).done;)if((m=i(b,y,h.value,t))===c||m===l)return m}).BREAK=c,r.RETURN=l},{"./_an-object":87,"./_ctx":101,"./_is-array-iter":117,"./_iter-call":120,"./_to-length":161,"./core.get-iterator-method":170}],110:[function(e,t,r){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],111:[function(e,t,r){var n={}.hasOwnProperty;t.exports=function(e,t){return n.call(e,t)}},{}],112:[function(e,t,r){var n=e("./_object-dp"),i=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},{"./_descriptors":103,"./_object-dp":132,"./_property-desc":145}],113:[function(e,t,r){var n=e("./_global").document;t.exports=n&&n.documentElement},{"./_global":110}],114:[function(e,t,r){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":103,"./_dom-create":104,"./_fails":108}],115:[function(e,t,r){t.exports=function(e,t,r){var n=void 0===r;switch(t.length){case 0:return n?e():e.call(r);case 1:return n?e(t[0]):e.call(r,t[0]);case 2:return n?e(t[0],t[1]):e.call(r,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(r,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(r,t[0],t[1],t[2],t[3])}return e.apply(r,t)}},{}],116:[function(e,t,r){var n=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},{"./_cof":95}],117:[function(e,t,r){var n=e("./_iterators"),i=e("./_wks")("iterator"),o=Array.prototype;t.exports=function(e){return void 0!==e&&(n.Array===e||o[i]===e)}},{"./_iterators":125,"./_wks":169}],118:[function(e,t,r){var n=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==n(e)}},{"./_cof":95}],119:[function(e,t,r){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],120:[function(e,t,r){var n=e("./_an-object");t.exports=function(e,t,r,i){try{return i?t(n(r)[0],r[1]):t(r)}catch(t){var o=e.return;throw void 0!==o&&n(o.call(e)),t}}},{"./_an-object":87}],121:[function(e,t,r){"use strict";var n=e("./_object-create"),i=e("./_property-desc"),o=e("./_set-to-string-tag"),s={};e("./_hide")(s,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,r){e.prototype=n(s,{next:i(1,r)}),o(e,t+" Iterator")}},{"./_hide":112,"./_object-create":131,"./_property-desc":145,"./_set-to-string-tag":152,"./_wks":169}],122:[function(e,t,r){"use strict";var n=e("./_library"),i=e("./_export"),o=e("./_redefine"),s=e("./_hide"),a=e("./_iterators"),u=e("./_iter-create"),c=e("./_set-to-string-tag"),l=e("./_object-gpo"),f=e("./_wks")("iterator"),d=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(e,t,r,h,b,m,v){u(r,t,h);var y,g,_,k=function(e){if(!d&&e in C)return C[e];switch(e){case"keys":case"values":return function(){return new r(this,e)}}return function(){return new r(this,e)}},x=t+" Iterator",w="values"==b,j=!1,C=e.prototype,S=C[f]||C["@@iterator"]||b&&C[b],T=S||k(b),E=b?w?k("entries"):T:void 0,M="Array"==t&&C.entries||S;if(M&&(_=l(M.call(new e)))!==Object.prototype&&_.next&&(c(_,x,!0),n||"function"==typeof _[f]||s(_,f,p)),w&&S&&"values"!==S.name&&(j=!0,T=function(){return S.call(this)}),n&&!v||!d&&!j&&C[f]||s(C,f,T),a[t]=T,a[x]=p,b)if(y={values:w?T:k("values"),keys:m?T:k("keys"),entries:E},v)for(g in y)g in C||o(C,g,y[g]);else i(i.P+i.F*(d||j),t,y);return y}},{"./_export":107,"./_hide":112,"./_iter-create":121,"./_iterators":125,"./_library":126,"./_object-gpo":138,"./_redefine":147,"./_set-to-string-tag":152,"./_wks":169}],123:[function(e,t,r){var n=e("./_wks")("iterator"),i=!1;try{var o=[7][n]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var o=[7],s=o[n]();s.next=function(){return{done:r=!0}},o[n]=function(){return s},e(o)}catch(e){}return r}},{"./_wks":169}],124:[function(e,t,r){t.exports=function(e,t){return{value:t,done:!!e}}},{}],125:[function(e,t,r){t.exports={}},{}],126:[function(e,t,r){t.exports=!0},{}],127:[function(e,t,r){var n=e("./_uid")("meta"),i=e("./_is-object"),o=e("./_has"),s=e("./_object-dp").f,a=0,u=Object.isExtensible||function(){return!0},c=!e("./_fails")(function(){return u(Object.preventExtensions({}))}),l=function(e){s(e,n,{value:{i:"O"+ ++a,w:{}}})},f=t.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,n)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[n].i},getWeak:function(e,t){if(!o(e,n)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[n].w},onFreeze:function(e){return c&&f.NEED&&u(e)&&!o(e,n)&&l(e),e}}},{"./_fails":108,"./_has":111,"./_is-object":119,"./_object-dp":132,"./_uid":164}],128:[function(e,t,r){var n=e("./_global"),i=e("./_task").set,o=n.MutationObserver||n.WebKitMutationObserver,s=n.process,a=n.Promise,u="process"==e("./_cof")(s);t.exports=function(){var e,t,r,c=function(){var n,i;for(u&&(n=s.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?r():t=void 0,n}}t=void 0,n&&n.enter()};if(u)r=function(){s.nextTick(c)};else if(!o||n.navigator&&n.navigator.standalone)if(a&&a.resolve){var l=a.resolve(void 0);r=function(){l.then(c)}}else r=function(){i.call(n,c)};else{var f=!0,d=document.createTextNode("");new o(c).observe(d,{characterData:!0}),r=function(){d.data=f=!f}}return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,r()),t=i}}},{"./_cof":95,"./_global":110,"./_task":157}],129:[function(e,t,r){"use strict";
// 25.4.1.5 NewPromiseCapability(C)
var n=e("./_a-function");function i(e){var t,r;this.promise=new e(function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n}),this.resolve=n(t),this.reject=n(r)}t.exports.f=function(e){return new i(e)}},{"./_a-function":84}],130:[function(e,t,r){"use strict";var n=e("./_object-keys"),i=e("./_object-gops"),o=e("./_object-pie"),s=e("./_to-object"),a=e("./_iobject"),u=Object.assign;t.exports=!u||e("./_fails")(function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(e){t[e]=e}),7!=u({},e)[r]||Object.keys(u({},t)).join("")!=n})?function(e,t){for(var r=s(e),u=arguments.length,c=1,l=i.f,f=o.f;u>c;)for(var d,p=a(arguments[c++]),h=l?n(p).concat(l(p)):n(p),b=h.length,m=0;b>m;)f.call(p,d=h[m++])&&(r[d]=p[d]);return r}:u},{"./_fails":108,"./_iobject":116,"./_object-gops":137,"./_object-keys":140,"./_object-pie":141,"./_to-object":162}],131:[function(e,t,r){var n=e("./_an-object"),i=e("./_object-dps"),o=e("./_enum-bug-keys"),s=e("./_shared-key")("IE_PROTO"),a=function(){},u=function(){var t,r=e("./_dom-create")("iframe"),n=o.length;for(r.style.display="none",e("./_html").appendChild(r),r.src="javascript:",(t=r.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),u=t.F;n--;)delete u.prototype[o[n]];return u()};t.exports=Object.create||function(e,t){var r;return null!==e?(a.prototype=n(e),r=new a,a.prototype=null,r[s]=e):r=u(),void 0===t?r:i(r,t)}},{"./_an-object":87,"./_dom-create":104,"./_enum-bug-keys":105,"./_html":113,"./_object-dps":133,"./_shared-key":153}],132:[function(e,t,r){var n=e("./_an-object"),i=e("./_ie8-dom-define"),o=e("./_to-primitive"),s=Object.defineProperty;r.f=e("./_descriptors")?Object.defineProperty:function(e,t,r){if(n(e),t=o(t,!0),n(r),i)try{return s(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},{"./_an-object":87,"./_descriptors":103,"./_ie8-dom-define":114,"./_to-primitive":163}],133:[function(e,t,r){var n=e("./_object-dp"),i=e("./_an-object"),o=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){i(e);for(var r,s=o(t),a=s.length,u=0;a>u;)n.f(e,r=s[u++],t[r]);return e}},{"./_an-object":87,"./_descriptors":103,"./_object-dp":132,"./_object-keys":140}],134:[function(e,t,r){var n=e("./_object-pie"),i=e("./_property-desc"),o=e("./_to-iobject"),s=e("./_to-primitive"),a=e("./_has"),u=e("./_ie8-dom-define"),c=Object.getOwnPropertyDescriptor;r.f=e("./_descriptors")?c:function(e,t){if(e=o(e),t=s(t,!0),u)try{return c(e,t)}catch(e){}if(a(e,t))return i(!n.f.call(e,t),e[t])}},{"./_descriptors":103,"./_has":111,"./_ie8-dom-define":114,"./_object-pie":141,"./_property-desc":145,"./_to-iobject":160,"./_to-primitive":163}],135:[function(e,t,r){var n=e("./_to-iobject"),i=e("./_object-gopn").f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(e){return s&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return s.slice()}}(e):i(n(e))}},{"./_object-gopn":136,"./_to-iobject":160}],136:[function(e,t,r){var n=e("./_object-keys-internal"),i=e("./_enum-bug-keys").concat("length","prototype");r.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},{"./_enum-bug-keys":105,"./_object-keys-internal":139}],137:[function(e,t,r){r.f=Object.getOwnPropertySymbols},{}],138:[function(e,t,r){var n=e("./_has"),i=e("./_to-object"),o=e("./_shared-key")("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},{"./_has":111,"./_shared-key":153,"./_to-object":162}],139:[function(e,t,r){var n=e("./_has"),i=e("./_to-iobject"),o=e("./_array-includes")(!1),s=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var r,a=i(e),u=0,c=[];for(r in a)r!=s&&n(a,r)&&c.push(r);for(;t.length>u;)n(a,r=t[u++])&&(~o(c,r)||c.push(r));return c}},{"./_array-includes":89,"./_has":111,"./_shared-key":153,"./_to-iobject":160}],140:[function(e,t,r){var n=e("./_object-keys-internal"),i=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return n(e,i)}},{"./_enum-bug-keys":105,"./_object-keys-internal":139}],141:[function(e,t,r){r.f={}.propertyIsEnumerable},{}],142:[function(e,t,r){var n=e("./_export"),i=e("./_core"),o=e("./_fails");t.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],s={};s[e]=t(r),n(n.S+n.F*o(function(){r(1)}),"Object",s)}},{"./_core":99,"./_export":107,"./_fails":108}],143:[function(e,t,r){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],144:[function(e,t,r){var n=e("./_an-object"),i=e("./_is-object"),o=e("./_new-promise-capability");t.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=o.f(e);return(0,r.resolve)(t),r.promise}},{"./_an-object":87,"./_is-object":119,"./_new-promise-capability":129}],145:[function(e,t,r){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],146:[function(e,t,r){var n=e("./_hide");t.exports=function(e,t,r){for(var i in t)r&&e[i]?e[i]=t[i]:n(e,i,t[i]);return e}},{"./_hide":112}],147:[function(e,t,r){t.exports=e("./_hide")},{"./_hide":112}],148:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_a-function"),o=e("./_ctx"),s=e("./_for-of");t.exports=function(e){n(n.S,e,{from:function(e){var t,r,n,a,u=arguments[1];return i(this),(t=void 0!==u)&&i(u),null==e?new this:(r=[],t?(n=0,a=o(u,arguments[2],2),s(e,!1,function(e){r.push(a(e,n++))})):s(e,!1,r.push,r),new this(r))}})}},{"./_a-function":84,"./_ctx":101,"./_export":107,"./_for-of":109}],149:[function(e,t,r){"use strict";var n=e("./_export");t.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},{"./_export":107}],150:[function(e,t,r){var n=e("./_is-object"),i=e("./_an-object"),o=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,r,n){try{(n=e("./_ctx")(Function.call,e("./_object-gopd").f(Object.prototype,"__proto__").set,2))(t,[]),r=!(t instanceof Array)}catch(e){r=!0}return function(e,t){return o(e,t),r?e.__proto__=t:n(e,t),e}}({},!1):void 0),check:o}},{"./_an-object":87,"./_ctx":101,"./_is-object":119,"./_object-gopd":134}],151:[function(e,t,r){"use strict";var n=e("./_global"),i=e("./_core"),o=e("./_object-dp"),s=e("./_descriptors"),a=e("./_wks")("species");t.exports=function(e){var t="function"==typeof i[e]?i[e]:n[e];s&&t&&!t[a]&&o.f(t,a,{configurable:!0,get:function(){return this}})}},{"./_core":99,"./_descriptors":103,"./_global":110,"./_object-dp":132,"./_wks":169}],152:[function(e,t,r){var n=e("./_object-dp").f,i=e("./_has"),o=e("./_wks")("toStringTag");t.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},{"./_has":111,"./_object-dp":132,"./_wks":169}],153:[function(e,t,r){var n=e("./_shared")("keys"),i=e("./_uid");t.exports=function(e){return n[e]||(n[e]=i(e))}},{"./_shared":154,"./_uid":164}],154:[function(e,t,r){var n=e("./_core"),i=e("./_global"),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(t.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:n.version,mode:e("./_library")?"pure":"global",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})},{"./_core":99,"./_global":110,"./_library":126}],155:[function(e,t,r){var n=e("./_an-object"),i=e("./_a-function"),o=e("./_wks")("species");t.exports=function(e,t){var r,s=n(e).constructor;return void 0===s||null==(r=n(s)[o])?t:i(r)}},{"./_a-function":84,"./_an-object":87,"./_wks":169}],156:[function(e,t,r){var n=e("./_to-integer"),i=e("./_defined");t.exports=function(e){return function(t,r){var o,s,a=String(i(t)),u=n(r),c=a.length;return u<0||u>=c?e?"":void 0:(o=a.charCodeAt(u))<55296||o>56319||u+1===c||(s=a.charCodeAt(u+1))<56320||s>57343?e?a.charAt(u):o:e?a.slice(u,u+2):s-56320+(o-55296<<10)+65536}}},{"./_defined":102,"./_to-integer":159}],157:[function(e,t,r){var n,i,o,s=e("./_ctx"),a=e("./_invoke"),u=e("./_html"),c=e("./_dom-create"),l=e("./_global"),f=l.process,d=l.setImmediate,p=l.clearImmediate,h=l.MessageChannel,b=l.Dispatch,m=0,v={},y=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},g=function(e){y.call(e.data)};d&&p||(d=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return v[++m]=function(){a("function"==typeof e?e:Function(e),t)},n(m),m},p=function(e){delete v[e]},"process"==e("./_cof")(f)?n=function(e){f.nextTick(s(y,e,1))}:b&&b.now?n=function(e){b.now(s(y,e,1))}:h?(o=(i=new h).port2,i.port1.onmessage=g,n=s(o.postMessage,o,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function(e){l.postMessage(e+"","*")},l.addEventListener("message",g,!1)):n="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),y.call(e)}}:function(e){setTimeout(s(y,e,1),0)}),t.exports={set:d,clear:p}},{"./_cof":95,"./_ctx":101,"./_dom-create":104,"./_global":110,"./_html":113,"./_invoke":115}],158:[function(e,t,r){var n=e("./_to-integer"),i=Math.max,o=Math.min;t.exports=function(e,t){return(e=n(e))<0?i(e+t,0):o(e,t)}},{"./_to-integer":159}],159:[function(e,t,r){var n=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},{}],160:[function(e,t,r){var n=e("./_iobject"),i=e("./_defined");t.exports=function(e){return n(i(e))}},{"./_defined":102,"./_iobject":116}],161:[function(e,t,r){var n=e("./_to-integer"),i=Math.min;t.exports=function(e){return e>0?i(n(e),9007199254740991):0}},{"./_to-integer":159}],162:[function(e,t,r){var n=e("./_defined");t.exports=function(e){return Object(n(e))}},{"./_defined":102}],163:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e))return e;var r,i;if(t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;if("function"==typeof(r=e.valueOf)&&!n(i=r.call(e)))return i;if(!t&&"function"==typeof(r=e.toString)&&!n(i=r.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":119}],164:[function(e,t,r){var n=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},{}],165:[function(e,t,r){var n=e("./_global").navigator;t.exports=n&&n.userAgent||""},{"./_global":110}],166:[function(e,t,r){var n=e("./_is-object");t.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},{"./_is-object":119}],167:[function(e,t,r){var n=e("./_global"),i=e("./_core"),o=e("./_library"),s=e("./_wks-ext"),a=e("./_object-dp").f;t.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},{"./_core":99,"./_global":110,"./_library":126,"./_object-dp":132,"./_wks-ext":168}],168:[function(e,t,r){r.f=e("./_wks")},{"./_wks":169}],169:[function(e,t,r){var n=e("./_shared")("wks"),i=e("./_uid"),o=e("./_global").Symbol,s="function"==typeof o;(t.exports=function(e){return n[e]||(n[e]=s&&o[e]||(s?o:i)("Symbol."+e))}).store=n},{"./_global":110,"./_shared":154,"./_uid":164}],170:[function(e,t,r){var n=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[n(e)]}},{"./_classof":94,"./_core":99,"./_iterators":125,"./_wks":169}],171:[function(e,t,r){var n=e("./_an-object"),i=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},{"./_an-object":87,"./_core":99,"./core.get-iterator-method":170}],172:[function(e,t,r){var n=e("./_classof"),i=e("./_wks")("iterator"),o=e("./_iterators");t.exports=e("./_core").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||o.hasOwnProperty(n(t))}},{"./_classof":94,"./_core":99,"./_iterators":125,"./_wks":169}],173:[function(e,t,r){"use strict";var n=e("./_ctx"),i=e("./_export"),o=e("./_to-object"),s=e("./_iter-call"),a=e("./_is-array-iter"),u=e("./_to-length"),c=e("./_create-property"),l=e("./core.get-iterator-method");i(i.S+i.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,i,f,d=o(e),p="function"==typeof this?this:Array,h=arguments.length,b=h>1?arguments[1]:void 0,m=void 0!==b,v=0,y=l(d);if(m&&(b=n(b,h>2?arguments[2]:void 0,2)),null==y||p==Array&&a(y))for(r=new p(t=u(d.length));t>v;v++)c(r,v,m?b(d[v],v):d[v]);else for(f=y.call(d),r=new p;!(i=f.next()).done;v++)c(r,v,m?s(f,b,[i.value,v],!0):i.value);return r.length=v,r}})},{"./_create-property":100,"./_ctx":101,"./_export":107,"./_is-array-iter":117,"./_iter-call":120,"./_iter-detect":123,"./_to-length":161,"./_to-object":162,"./core.get-iterator-method":170}],174:[function(e,t,r){"use strict";var n=e("./_add-to-unscopables"),i=e("./_iter-step"),o=e("./_iterators"),s=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])},"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},{"./_add-to-unscopables":85,"./_iter-define":122,"./_iter-step":124,"./_iterators":125,"./_to-iobject":160}],175:[function(e,t,r){"use strict";var n=e("./_collection-strong"),i=e("./_validate-collection");t.exports=e("./_collection")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},{"./_collection":98,"./_collection-strong":96,"./_validate-collection":166}],176:[function(e,t,r){var n=e("./_export");n(n.S+n.F,"Object",{assign:e("./_object-assign")})},{"./_export":107,"./_object-assign":130}],177:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{create:e("./_object-create")})},{"./_export":107,"./_object-create":131}],178:[function(e,t,r){var n=e("./_export");n(n.S+n.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":103,"./_export":107,"./_object-dp":132}],179:[function(e,t,r){var n=e("./_to-iobject"),i=e("./_object-gopd").f;e("./_object-sap")("getOwnPropertyDescriptor",function(){return function(e,t){return i(n(e),t)}})},{"./_object-gopd":134,"./_object-sap":142,"./_to-iobject":160}],180:[function(e,t,r){var n=e("./_to-object"),i=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return i(n(e))}})},{"./_object-gpo":138,"./_object-sap":142,"./_to-object":162}],181:[function(e,t,r){var n=e("./_to-object"),i=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return i(n(e))}})},{"./_object-keys":140,"./_object-sap":142,"./_to-object":162}],182:[function(e,t,r){var n=e("./_export");n(n.S,"Object",{setPrototypeOf:e("./_set-proto").set})},{"./_export":107,"./_set-proto":150}],183:[function(e,t,r){},{}],184:[function(e,t,r){"use strict";var n,i,o,s,a=e("./_library"),u=e("./_global"),c=e("./_ctx"),l=e("./_classof"),f=e("./_export"),d=e("./_is-object"),p=e("./_a-function"),h=e("./_an-instance"),b=e("./_for-of"),m=e("./_species-constructor"),v=e("./_task").set,y=e("./_microtask")(),g=e("./_new-promise-capability"),_=e("./_perform"),k=e("./_user-agent"),x=e("./_promise-resolve"),w=u.TypeError,j=u.process,C=j&&j.versions,S=C&&C.v8||"",T=u.Promise,E="process"==l(j),M=function(){},R=i=g.f,I=!!function(){try{var t=T.resolve(1),r=(t.constructor={})[e("./_wks")("species")]=function(e){e(M,M)};return(E||"function"==typeof PromiseRejectionEvent)&&t.then(M)instanceof r&&0!==S.indexOf("6.6")&&-1===k.indexOf("Chrome/66")}catch(e){}}(),O=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},P=function(e,t){if(!e._n){e._n=!0;var r=e._c;y(function(){for(var n=e._v,i=1==e._s,o=0,s=function(t){var r,o,s,a=i?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{a?(i||(2==e._h&&F(e),e._h=1),!0===a?r=n:(l&&l.enter(),r=a(n),l&&(l.exit(),s=!0)),r===t.promise?c(w("Promise-chain cycle")):(o=O(r))?o.call(r,u,c):u(r)):c(n)}catch(e){l&&!s&&l.exit(),c(e)}};r.length>o;)s(r[o++]);e._c=[],e._n=!1,t&&!e._h&&A(e)})}},A=function(e){v.call(u,function(){var t,r,n,i=e._v,o=L(e);if(o&&(t=_(function(){E?j.emit("unhandledRejection",i,e):(r=u.onunhandledrejection)?r({promise:e,reason:i}):(n=u.console)&&n.error&&n.error("Unhandled promise rejection",i)}),e._h=E||L(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},L=function(e){return 1!==e._h&&0===(e._a||e._c).length},F=function(e){v.call(u,function(){var t;E?j.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})})},D=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),P(t,!0))},N=function(e){var t,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===e)throw w("Promise can't be resolved itself");(t=O(e))?y(function(){var n={_w:r,_d:!1};try{t.call(e,c(N,n,1),c(D,n,1))}catch(e){D.call(n,e)}}):(r._v=e,r._s=1,P(r,!1))}catch(e){D.call({_w:r,_d:!1},e)}}};I||(T=function(e){h(this,T,"Promise","_h"),p(e),n.call(this);try{e(c(N,this,1),c(D,this,1))}catch(e){D.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=e("./_redefine-all")(T.prototype,{then:function(e,t){var r=R(m(this,T));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=E?j.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&P(this,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new n;this.promise=e,this.resolve=c(N,e,1),this.reject=c(D,e,1)},g.f=R=function(e){return e===T||e===s?new o(e):i(e)}),f(f.G+f.W+f.F*!I,{Promise:T}),e("./_set-to-string-tag")(T,"Promise"),e("./_set-species")("Promise"),s=e("./_core").Promise,f(f.S+f.F*!I,"Promise",{reject:function(e){var t=R(this);return(0,t.reject)(e),t.promise}}),f(f.S+f.F*(a||!I),"Promise",{resolve:function(e){return x(a&&this===s?T:this,e)}}),f(f.S+f.F*!(I&&e("./_iter-detect")(function(e){T.all(e).catch(M)})),"Promise",{all:function(e){var t=this,r=R(t),n=r.resolve,i=r.reject,o=_(function(){var r=[],o=0,s=1;b(e,!1,function(e){var a=o++,u=!1;r.push(void 0),s++,t.resolve(e).then(function(e){u||(u=!0,r[a]=e,--s||n(r))},i)}),--s||n(r)});return o.e&&i(o.v),r.promise},race:function(e){var t=this,r=R(t),n=r.reject,i=_(function(){b(e,!1,function(e){t.resolve(e).then(r.resolve,n)})});return i.e&&n(i.v),r.promise}})},{"./_a-function":84,"./_an-instance":86,"./_classof":94,"./_core":99,"./_ctx":101,"./_export":107,"./_for-of":109,"./_global":110,"./_is-object":119,"./_iter-detect":123,"./_library":126,"./_microtask":128,"./_new-promise-capability":129,"./_perform":143,"./_promise-resolve":144,"./_redefine-all":146,"./_set-species":151,"./_set-to-string-tag":152,"./_species-constructor":155,"./_task":157,"./_user-agent":165,"./_wks":169}],185:[function(e,t,r){var n=e("./_export"),i=e("./_object-create"),o=e("./_a-function"),s=e("./_an-object"),a=e("./_is-object"),u=e("./_fails"),c=e("./_bind"),l=(e("./_global").Reflect||{}).construct,f=u(function(){function e(){}return!(l(function(){},[],e)instanceof e)}),d=!u(function(){l(function(){})});n(n.S+n.F*(f||d),"Reflect",{construct:function(e,t){o(e),s(t);var r=arguments.length<3?e:o(arguments[2]);if(d&&!f)return l(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(c.apply(e,n))}var u=r.prototype,p=i(a(u)?u:Object.prototype),h=Function.apply.call(e,p,t);return a(h)?h:p}})},{"./_a-function":84,"./_an-object":87,"./_bind":93,"./_export":107,"./_fails":108,"./_global":110,"./_is-object":119,"./_object-create":131}],186:[function(e,t,r){"use strict";var n=e("./_collection-strong"),i=e("./_validate-collection");t.exports=e("./_collection")("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},{"./_collection":98,"./_collection-strong":96,"./_validate-collection":166}],187:[function(e,t,r){"use strict";var n=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":122,"./_string-at":156}],188:[function(e,t,r){"use strict";var n=e("./_global"),i=e("./_has"),o=e("./_descriptors"),s=e("./_export"),a=e("./_redefine"),u=e("./_meta").KEY,c=e("./_fails"),l=e("./_shared"),f=e("./_set-to-string-tag"),d=e("./_uid"),p=e("./_wks"),h=e("./_wks-ext"),b=e("./_wks-define"),m=e("./_enum-keys"),v=e("./_is-array"),y=e("./_an-object"),g=e("./_is-object"),_=e("./_to-iobject"),k=e("./_to-primitive"),x=e("./_property-desc"),w=e("./_object-create"),j=e("./_object-gopn-ext"),C=e("./_object-gopd"),S=e("./_object-dp"),T=e("./_object-keys"),E=C.f,M=S.f,R=j.f,I=n.Symbol,O=n.JSON,P=O&&O.stringify,A=p("_hidden"),L=p("toPrimitive"),F={}.propertyIsEnumerable,D=l("symbol-registry"),N=l("symbols"),q=l("op-symbols"),U=Object.prototype,B="function"==typeof I,G=n.QObject,W=!G||!G.prototype||!G.prototype.findChild,z=o&&c(function(){return 7!=w(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(e,t,r){var n=E(U,t);n&&delete U[t],M(e,t,r),n&&e!==U&&M(U,t,n)}:M,Q=function(e){var t=N[e]=w(I.prototype);return t._k=e,t},K=B&&"symbol"==typeof I.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof I},$=function(e,t,r){return e===U&&$(q,t,r),y(e),t=k(t,!0),y(r),i(N,t)?(r.enumerable?(i(e,A)&&e[A][t]&&(e[A][t]=!1),r=w(r,{enumerable:x(0,!1)})):(i(e,A)||M(e,A,x(1,{})),e[A][t]=!0),z(e,t,r)):M(e,t,r)},V=function(e,t){y(e);for(var r,n=m(t=_(t)),i=0,o=n.length;o>i;)$(e,r=n[i++],t[r]);return e},H=function(e){var t=F.call(this,e=k(e,!0));return!(this===U&&i(N,e)&&!i(q,e))&&(!(t||!i(this,e)||!i(N,e)||i(this,A)&&this[A][e])||t)},J=function(e,t){if(e=_(e),t=k(t,!0),e!==U||!i(N,t)||i(q,t)){var r=E(e,t);return!r||!i(N,t)||i(e,A)&&e[A][t]||(r.enumerable=!0),r}},X=function(e){for(var t,r=R(_(e)),n=[],o=0;r.length>o;)i(N,t=r[o++])||t==A||t==u||n.push(t);return n},Y=function(e){for(var t,r=e===U,n=R(r?q:_(e)),o=[],s=0;n.length>s;)!i(N,t=n[s++])||r&&!i(U,t)||o.push(N[t]);return o};B||(a((I=function(){if(this instanceof I)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(r){this===U&&t.call(q,r),i(this,A)&&i(this[A],e)&&(this[A][e]=!1),z(this,e,x(1,r))};return o&&W&&z(U,e,{configurable:!0,set:t}),Q(e)}).prototype,"toString",function(){return this._k}),C.f=J,S.f=$,e("./_object-gopn").f=j.f=X,e("./_object-pie").f=H,e("./_object-gops").f=Y,o&&!e("./_library")&&a(U,"propertyIsEnumerable",H,!0),h.f=function(e){return Q(p(e))}),s(s.G+s.W+s.F*!B,{Symbol:I});for(var Z="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;Z.length>ee;)p(Z[ee++]);for(var te=T(p.store),re=0;te.length>re;)b(te[re++]);s(s.S+s.F*!B,"Symbol",{for:function(e){return i(D,e+="")?D[e]:D[e]=I(e)},keyFor:function(e){if(!K(e))throw TypeError(e+" is not a symbol!");for(var t in D)if(D[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),s(s.S+s.F*!B,"Object",{create:function(e,t){return void 0===t?w(e):V(w(e),t)},defineProperty:$,defineProperties:V,getOwnPropertyDescriptor:J,getOwnPropertyNames:X,getOwnPropertySymbols:Y}),O&&s(s.S+s.F*(!B||c(function(){var e=I();return"[null]"!=P([e])||"{}"!=P({a:e})||"{}"!=P(Object(e))})),"JSON",{stringify:function(e){for(var t,r,n=[e],i=1;arguments.length>i;)n.push(arguments[i++]);if(r=t=n[1],(g(t)||void 0!==e)&&!K(e))return v(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!K(t))return t}),n[1]=t,P.apply(O,n)}}),I.prototype[L]||e("./_hide")(I.prototype,L,I.prototype.valueOf),f(I,"Symbol"),f(Math,"Math",!0),f(n.JSON,"JSON",!0)},{"./_an-object":87,"./_descriptors":103,"./_enum-keys":106,"./_export":107,"./_fails":108,"./_global":110,"./_has":111,"./_hide":112,"./_is-array":118,"./_is-object":119,"./_library":126,"./_meta":127,"./_object-create":131,"./_object-dp":132,"./_object-gopd":134,"./_object-gopn":136,"./_object-gopn-ext":135,"./_object-gops":137,"./_object-keys":140,"./_object-pie":141,"./_property-desc":145,"./_redefine":147,"./_set-to-string-tag":152,"./_shared":154,"./_to-iobject":160,"./_to-primitive":163,"./_uid":164,"./_wks":169,"./_wks-define":167,"./_wks-ext":168}],189:[function(e,t,r){e("./_set-collection-from")("Map")},{"./_set-collection-from":148}],190:[function(e,t,r){e("./_set-collection-of")("Map")},{"./_set-collection-of":149}],191:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Map",{toJSON:e("./_collection-to-json")("Map")})},{"./_collection-to-json":97,"./_export":107}],192:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_core"),o=e("./_global"),s=e("./_species-constructor"),a=e("./_promise-resolve");n(n.P+n.R,"Promise",{finally:function(e){var t=s(this,i.Promise||o.Promise),r="function"==typeof e;return this.then(r?function(r){return a(t,e()).then(function(){return r})}:e,r?function(r){return a(t,e()).then(function(){throw r})}:e)}})},{"./_core":99,"./_export":107,"./_global":110,"./_promise-resolve":144,"./_species-constructor":155}],193:[function(e,t,r){"use strict";var n=e("./_export"),i=e("./_new-promise-capability"),o=e("./_perform");n(n.S,"Promise",{try:function(e){var t=i.f(this),r=o(e);return(r.e?t.reject:t.resolve)(r.v),t.promise}})},{"./_export":107,"./_new-promise-capability":129,"./_perform":143}],194:[function(e,t,r){e("./_set-collection-from")("Set")},{"./_set-collection-from":148}],195:[function(e,t,r){e("./_set-collection-of")("Set")},{"./_set-collection-of":149}],196:[function(e,t,r){var n=e("./_export");n(n.P+n.R,"Set",{toJSON:e("./_collection-to-json")("Set")})},{"./_collection-to-json":97,"./_export":107}],197:[function(e,t,r){e("./_wks-define")("asyncIterator")},{"./_wks-define":167}],198:[function(e,t,r){e("./_wks-define")("observable")},{"./_wks-define":167}],199:[function(e,t,r){e("./es6.array.iterator");for(var n=e("./_global"),i=e("./_hide"),o=e("./_iterators"),s=e("./_wks")("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<a.length;u++){var c=a[u],l=n[c],f=l&&l.prototype;f&&!f[s]&&i(f,s,c),o[c]=o.Array}},{"./_global":110,"./_hide":112,"./_iterators":125,"./_wks":169,"./es6.array.iterator":174}],200:[function(e,t,r){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var n=Object.create||function(e){var t=function(){};return t.prototype=e,new t},i=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},o=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function s(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=n(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._maxListeners=void 0;var a,u=10;try{var c={};Object.defineProperty&&Object.defineProperty(c,"x",{value:0}),a=0===c.x}catch(e){a=!1}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function f(e,t,r,i){var o,s,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]):(s=e._events=n(null),e._eventsCount=0),a){if("function"==typeof a?a=s[t]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),!a.warned&&(o=l(e))&&o>0&&a.length>o){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",u.name,u.message)}}else a=s[t]=r,++e._eventsCount;return e}function d(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function p(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=o.call(d,n);return i.listener=r,n.wrapFn=i,i}function h(e,t,r){var n=e._events;if(!n)return[];var i=n[t];return i?"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):m(i,i.length):[]}function b(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function m(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}a?Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');u=e}}):s.defaultMaxListeners=u,s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){var t,r,n,i,o,s,a="error"===e;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var u=new Error('Unhandled "error" event. ('+t+")");throw u.context=t,u}if(!(r=s[e]))return!1;var c="function"==typeof r;switch(n=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var n=e.length,i=m(e,n),o=0;o<n;++o)i[o].call(r)}(r,c,this);break;case 2:!function(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,o=m(e,i),s=0;s<i;++s)o[s].call(r,n)}(r,c,this,arguments[1]);break;case 3:!function(e,t,r,n,i){if(t)e.call(r,n,i);else for(var o=e.length,s=m(e,o),a=0;a<o;++a)s[a].call(r,n,i)}(r,c,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,n,i,o){if(t)e.call(r,n,i,o);else for(var s=e.length,a=m(e,s),u=0;u<s;++u)a[u].call(r,n,i,o)}(r,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];!function(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,o=m(e,i),s=0;s<i;++s)o[s].apply(r,n)}(r,c,this,i)}return!0},s.prototype.addListener=function(e,t){return f(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return f(this,e,t,!0)},s.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,p(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,p(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,o,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=n(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(o=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,o=s;break}if(o<0)return this;0===o?r.shift():function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,o),1===r.length&&(i[e]=r[0]),i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.removeAllListeners=function(e){var t,r,o;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=n(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=n(null):delete r[e]),this;if(0===arguments.length){var s,a=i(r);for(o=0;o<a.length;++o)"removeListener"!==(s=a[o])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=n(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},s.prototype.listeners=function(e){return h(this,e,!0)},s.prototype.rawListeners=function(e){return h(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):b.call(e,t)},s.prototype.listenerCount=b,s.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],201:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],202:[function(e,t,r){var n,i;n=this,i=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){"use strict";e.exports=function(e,t){var r,n,i;for(r=1;r<arguments.length;r++)for(i in n=arguments[r])n.hasOwnProperty(i)&&(e[i]=n[i]);return e}},function(e,t,r){"use strict";var n=r(0);e.exports={build:function(e,t){var r,i,o,s=t.plugins;for(r=0,i=s.length;r<i;r++)(o=s[r]).methods&&n(e,o.methods),o.properties&&Object.defineProperties(e,o.properties)},hook:function(e,t,r){var n,i,o,s,a=e.config.plugins,u=[e.context];for(r&&(u=u.concat(r)),n=0,i=a.length;n<i;n++)s=a[n],(o=a[n][t])&&o.apply(s,u)}}},function(e,t,r){"use strict";function n(e){if(0===e.length)return e;var t,r,n=e.split(/[_-]/);if(1===n.length&&n[0][0].toLowerCase()===n[0][0])return e;for(r=n[0].toLowerCase(),t=1;t<n.length;t++)r=r+n[t].charAt(0).toUpperCase()+n[t].substring(1).toLowerCase();return r}n.prepended=function(e,t){return e+(t=n(t))[0].toUpperCase()+t.substring(1)},e.exports=n},function(e,t,r){"use strict";var n=r(0),i=r(2);function o(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}n(o.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=i.prepended("onEnter",e),this.lifecycle.onLeave[e]=i.prepended("onLeave",e),this.lifecycle.on[e]=i.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=i.prepended("onBefore",e),this.lifecycle.onAfter[e]=i.prepended("onAfter",e),this.lifecycle.on[e]=i.prepended("on",e)},mapTransition:function(e){var t=e.name,r=e.from,n=e.to;return this.addState(r),"function"!=typeof n&&this.addState(n),this.addTransition(t),this.map[r][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(n({},this.defaults.init,{to:e,active:!0})):"object"==typeof e?this.mapTransition(n({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var r,n,i;for(r=0,n=(e=e||[]).length;r<n;r++)"function"==typeof(i=e[r])&&(e[r]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,r,n,i,o,s=this.defaults.wildcard;for(r=0;r<e.length;r++)for(n=e[r],i=Array.isArray(n.from)?n.from:[n.from||s],o=n.to||s,t=0;t<i.length;t++)this.mapTransition({name:n.name,from:i[t],to:o})},transitionFor:function(e,t){var r=this.defaults.wildcard;return this.map[e][t]||this.map[r][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=o},function(e,t,r){var n=r(0),i=r(6),o=r(1),s=[null,[]];function a(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}n(a.prototype,{init:function(e){if(n(this.context,this.config.data.apply(this.context,e)),o.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var r=this.config.defaults.wildcard,n=this.config.transitionFor(this.state,e),i=n&&n.to;return"function"==typeof i?i.apply(this.context,t):i===r?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,r,n){var i=this.config.lifecycle,o=this.config.options.observeUnchangedState||t!==r;return r?this.isPending()?this.context.onPendingTransition(e,t,r):(this.config.addState(r),this.beginTransit(),n.unshift({transition:e,from:t,to:r,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),o?this.observersForEvent(i.onLeave.state):s,o?this.observersForEvent(i.onLeave[t]):s,this.observersForEvent(i.on.transition),o?["doTransit",[this]]:s,o?this.observersForEvent(i.onEnter.state):s,o?this.observersForEvent(i.onEnter[r]):s,o?this.observersForEvent(i.on[r]):s,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],n)):this.context.onInvalidTransition(e,t,r)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,r=0,n=this.observers.length,i=[];r<n;r++)(t=this.observers[r])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,r,n){if(0===e.length)return this.endTransit(void 0===n||n);var i=e[0][0],s=e[0][1],a=e[0][2];if(t[0].event=i,i&&a&&i!==r&&o.hook(this,"lifecycle",t),0===s.length)return e.shift(),this.observeEvents(e,t,i,n);var u=s.shift(),c=u[i].apply(u,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,i,c)},onInvalidTransition:function(e,t,r){throw new i("transition is invalid in current state",e,t,r,this.state)},onPendingTransition:function(e,t,r){throw new i("transition is invalid while previous transition is still in progress",e,t,r,this.state)}}),e.exports=a},function(e,t,r){"use strict";var n=r(0),i=r(2),o=r(1),s=r(3),a=r(4),u={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,r){return this._fsm.onInvalidTransition(e,t,r)},onPendingTransition:function(e,t,r){return this._fsm.onPendingTransition(e,t,r)}},c={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function l(e){return f(this||{},e)}function f(e,t){return d(e,new s(t,l)),e._fsm(),e}function d(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");o.build(e,t),Object.defineProperties(e,c),n(e,u),n(e,t.methods),t.allTransitions().forEach(function(t){e[i(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}}),e._fsm=function(){this._fsm=new a(this,t),this._fsm.init(arguments)}}l.version="3.0.1",l.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var r=new s(t,l);return d(e.prototype,r),e.prototype._fsm.config=r,e},l.apply=f,l.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=l},function(e,t,r){"use strict";e.exports=function(e,t,r,n,i){this.message=e,this.transition=t,this.from=r,this.to=n,this.current=i}}])},"object"==typeof r&&"object"==typeof t?t.exports=i():"function"==typeof define&&define.amd?define("StateMachine",[],i):"object"==typeof r?r.StateMachine=i():n.StateMachine=i()},{}],203:[function(e,t,r){"use strict";var n=u(e("babel-runtime/regenerator")),i=u(e("babel-runtime/core-js/get-iterator")),o=u(e("babel-runtime/core-js/symbol/iterator")),s=u(e("babel-runtime/helpers/classCallCheck")),a=u(e("babel-runtime/helpers/createClass"));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(t,r){(0,s.default)(this,e),this.balanceFactor=0,this.key=t,this.value=r,this.parent=null,this.left=null,this.right=null}return(0,a.default)(e,[{key:"update",value:function(e){this.value=e}},{key:"replace",value:function(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isLeaf",get:function(){return null===this.left&&null===this.right}},{key:"isLeftChild",get:function(){return this.parent.left===this}}]),e}(),l=function(){function e(t,r){(0,s.default)(this,e),this.isLessThan=t||function(e,t){return e<t},this.isEqual=r||function(e,t){return e===t},this.root=null,this.count=null}return(0,a.default)(e,[{key:"clear",value:function(){this.root=null,this.count=0}},{key:"set",value:function(e,t){var r=this.getNode(e);r?r.update(t):this.insert(e,t)}},{key:"insert",value:function(e,t){var r=new c(e,t);if(this.count++,this.root){for(var n=this.root;;)if(this.isLessThan(e,n.key)){if(!n.left){n.left=r;break}n=n.left}else{if(!n.right){n.right=r;break}n=n.right}for(r.parent=n,n=r;n.parent;){var i=n.parent,o=i.balanceFactor;if(n.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(o))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}n=i}}else this.root=r}},{key:"get",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"delete",value:function(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var r=t.parent,n=t.left,i=t.right;if(!!n!=!!i){var o=n||i;r||o?r&&!o?this.root=o:(r.replace(t,null),this.rebalance(r)):this.root=null}else{for(var s=t.left;s.right;)s=s.right;if(t.left===s)t.isRoot?(this.root=s,s.parent=null):(t.isLeftChild?t.parent.left=s:t.parent.right=s,s.parent=t.parent),s.right=t.right,s.right.parent=s,s.balanceFactor=t.balanceFactor,t={parent:s,isLeftChild:!0};else{var a=s.parent,u=s.left;a.right=u,u&&(u.parent=a),t.isRoot?(this.root=s,s.parent=null):(t.isLeftChild?t.parent.left=s:t.parent.right=s,s.parent=t.parent),s.right=t.right,s.right.parent=s,s.left=t.left,s.left.parent=s,s.balanceFactor=t.balanceFactor,t={parent:a,isLeftChild:!1}}}for(this.count--;t.parent;){var c=t.parent,l=c.balanceFactor;if(t.isLeftChild?c.balanceFactor-=1:c.balanceFactor+=1,Math.abs(c.balanceFactor)>Math.abs(l)){if(!(c.balanceFactor<-1||c.balanceFactor>1))break;if(this.rebalance(c),0!==c.parent.balanceFactor)break;t=c.parent}else t=c}return null}},{key:"getNode",value:function(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}},{key:"rebalance",value:function(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}},{key:"rotateLeft",value:function(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}},{key:"rotateRight",value:function(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}},{key:o.default,value:n.default.mark(function e(){var t,r,o,s,a,u;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,r=!1,o=void 0,e.prev=3,s=(0,i.default)(this.getIterator());case 5:if(t=(a=s.next()).done){e.next=12;break}return u=a.value,e.next=9,u;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,o=e.t0;case 18:e.prev=18,e.prev=19,!t&&s.return&&s.return();case 21:if(e.prev=21,!r){e.next=24;break}throw o;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}},e,this,[[3,14,18,26],[19,,21,25]])})},{key:"getIterator",value:n.default.mark(function e(){var t,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.root;case 1:if(!t){e.next=7;break}if(!this.isEqual(i,t.key)&&(null!==i||t.left)){e.next=4;break}return e.abrupt("break",7);case 4:t=this.isLessThan(i,t.key)||null===i?t.left:t.right,e.next=1;break;case 7:if(t){e.next=9;break}return e.abrupt("return",null);case 9:r=!0;case 10:if(!r){e.next=28;break}return e.next=13,[t.key,t.value];case 13:if(r=!1,!t.right){e.next=20;break}for(t=t.right;t.left;)t=t.left;r=!0,e.next=26;break;case 20:if(!t.parent){e.next=25;break}r=t.parent.left===t,t=t.parent,e.next=26;break;case 25:return e.abrupt("break",36);case 26:e.next=34;break;case 28:if(!t.parent){e.next=33;break}r=t.parent.left===t,t=t.parent,e.next=34;break;case 33:return e.abrupt("break",36);case 34:e.next=10;break;case 36:return e.abrupt("return",null);case 37:case"end":return e.stop()}},e,this)})},{key:"getReverseIterator",value:n.default.mark(function e(){var t,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.root;case 1:if(!t){e.next=7;break}if(!this.isEqual(i,t.key)&&(null!==i||t.right)){e.next=4;break}return e.abrupt("break",7);case 4:t=this.isLessThan(i,t.key)&&null!==i?t.left:t.right,e.next=1;break;case 7:if(t){e.next=9;break}return e.abrupt("return",null);case 9:r=!0;case 10:if(!r){e.next=28;break}return e.next=13,[t.key,t.value];case 13:if(r=!1,!t.left){e.next=20;break}for(t=t.left;t.right;)t=t.right;r=!0,e.next=26;break;case 20:if(!t.parent){e.next=25;break}r=t.parent.right===t,t=t.parent,e.next=26;break;case 25:return e.abrupt("break",36);case 26:e.next=34;break;case 28:if(!t.parent){e.next=33;break}r=t.parent.right===t,t=t.parent,e.next=34;break;case 33:return e.abrupt("break",36);case 34:e.next=10;break;case 36:return e.abrupt("return",null);case 37:case"end":return e.stop()}},e,this)})},{key:"size",get:function(){return this.count}}]),e}();r.TreeMap=l},{"babel-runtime/core-js/get-iterator":34,"babel-runtime/core-js/symbol/iterator":49,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/regenerator":59}],204:[function(e,t,r){
/*
* loglevel - https://github.com/pimterry/loglevel
*
* Copyright (c) 2013 Tim Perry
* Licensed under the MIT license.
*/
!function(e,r){"use strict";"function"==typeof define&&define.amd?define(r):"object"==typeof t&&t.exports?t.exports=r():e.log=r()}(this,function(){"use strict";var e=function(){},t="undefined",r=["trace","debug","info","warn","error"];function n(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function i(t,n){for(var i=0;i<r.length;i++){var o=r[i];this[o]=i<t?e:this.methodFactory(o,t,n)}this.log=this.debug}function o(r,o,s){return function(r){return"debug"===r&&(r="log"),typeof console!==t&&(void 0!==console[r]?n(console,r):void 0!==console.log?n(console,"log"):e)}(r)||function(e,r,n){return function(){typeof console!==t&&(i.call(this,r,n),this[e].apply(this,arguments))}}.apply(this,arguments)}function s(e,n,s){var a,u=this,c="loglevel";function l(){var e;if(typeof window!==t){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,n=r.indexOf(encodeURIComponent(c)+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n))[1])}catch(e){}return void 0===u.levels[e]&&(e=void 0),e}}e&&(c+=":"+e),u.name=e,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=s||o,u.getLevel=function(){return a},u.setLevel=function(n,o){if("string"==typeof n&&void 0!==u.levels[n.toUpperCase()]&&(n=u.levels[n.toUpperCase()]),!("number"==typeof n&&n>=0&&n<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+n;if(a=n,!1!==o&&function(e){var n=(r[e]||"silent").toUpperCase();if(typeof window!==t){try{return void(window.localStorage[c]=n)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+n+";"}catch(e){}}}(n),i.call(u,n,e),typeof console===t&&n<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(e){l()||u.setLevel(e,!1)},u.enableAll=function(e){u.setLevel(u.levels.TRACE,e)},u.disableAll=function(e){u.setLevel(u.levels.SILENT,e)};var f=l();null==f&&(f=null==n?"WARN":n),u.setLevel(f,!1)}var a=new s,u={};a.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=u[e];return t||(t=u[e]=new s(e,a.getLevel(),a.methodFactory)),t};var c=typeof window!==t?window.log:void 0;return a.noConflict=function(){return typeof window!==t&&window.log===a&&(window.log=c),a},a.getLoggers=function(){return u},a})},{}],205:[function(e,t,r){"use strict";var n=c(e("babel-runtime/core-js/promise")),i=c(e("babel-runtime/core-js/object/get-prototype-of")),o=c(e("babel-runtime/helpers/classCallCheck")),s=c(e("babel-runtime/helpers/createClass")),a=c(e("babel-runtime/helpers/possibleConstructorReturn")),u=c(e("babel-runtime/helpers/inherits"));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=function(e){function t(e){(0,o.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return r.minDelay=e.min,r.maxDelay=e.max,r.initialDelay=e.initial||0,r.maxAttemptsCount=e.maxAttemptsCount||0,r.maxAttemptsTime=e.maxAttemptsTime||0,r.randomness=e.randomness||0,r.inProgress=!1,r.attemptNum=0,r.prevDelay=0,r.currDelay=0,r}return(0,u.default)(t,e),(0,s.default)(t,[{key:"attempt",value:function(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}},{key:"nextDelay",value:function(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;var t=this.currDelay+this.prevDelay;return this.prevDelay=this.currDelay,this.currDelay=t,t}},{key:"randomize",value:function(e){var t=e*this.randomness,r=Math.round(Math.random()*t*2-t);return Math.max(0,e+r)}},{key:"scheduleAttempt",value:function(e){var t=this;if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));var r=this.nextDelay(e);r=this.randomize(r),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+r&&(this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),this.reject(new Error("Maximum attempt time limit reached"))),this.timeout=setTimeout(function(){return t.attempt()},r)}},{key:"cleanup",value:function(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}},{key:"start",value:function(){var e=this;if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new n.default(function(t,r){e.resolve=t,e.reject=r,e.startTimestamp=Date.now(),e.scheduleAttempt(e.initialDelay)})}},{key:"cancel",value:function(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}},{key:"succeeded",value:function(e){this.emit("succeeded",e),this.resolve(e)}},{key:"failed",value:function(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}},{key:"run",value:function(e){var t=this;return this.on("attempt",function(){e().then(function(e){return t.succeeded(e)}).catch(function(e){return t.failed(e)})}),this.start()}}]),t}(e("events").EventEmitter);r.Retrier=l,r.default=l},{"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,events:200}],206:[function(e,t,r){(function(e){(function(){"use strict";var n={function:!0,object:!0},i=n[typeof window]&&window||this,o=n[typeof r]&&r,s=n[typeof t]&&t&&!t.nodeType&&t,a=o&&s&&"object"==typeof e&&e;!a||a.global!==a&&a.window!==a&&a.self!==a||(i=a);var u=Math.pow(2,53)-1,c=/\bOpera/,l=Object.prototype,f=l.hasOwnProperty,d=l.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function h(e){return e=g(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function b(e,t){for(var r in e)f.call(e,r)&&t(e[r],r,e)}function m(e){return null==e?p(e):d.call(e).slice(8,-1)}function v(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function y(e,t){var r=null;return function(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=u)for(;++r<n;)t(e[r],r,e);else b(e,t)}(e,function(n,i){r=t(r,n,i,e)}),r}function g(e){return String(e).replace(/^ +| +$/g,"")}var _=function e(t){var r=i,n=t&&"object"==typeof t&&"String"!=m(t);n&&(r=t,t=null);var o=r.navigator||{},s=o.userAgent||"";t||(t=s);var a,u,l,f,p,_=n?!!o.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(d.toString()),k=n?"Object":"ScriptBridgingProxyObject",x=n?"Object":"Environment",w=n&&r.java?"JavaPackage":m(r.java),j=n?"Object":"RuntimeObject",C=/\bJava/.test(w)&&r.java,S=C&&m(r.environment)==x,T=C?"a":"\u03b1",E=C?"b":"\u03b2",M=r.document||{},R=r.operamini||r.opera,I=c.test(I=n&&R?R["[[Class]]"]:m(R))?I:R=null,O=t,P=[],A=null,L=t==s,F=L&&R&&"function"==typeof R.version&&R.version(),D=y([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],function(e,r){return e||RegExp("\\b"+(r.pattern||v(r))+"\\b","i").exec(t)&&(r.label||r)}),N=function(e){return y(e,function(e,r){return e||RegExp("\\b"+(r.pattern||v(r))+"\\b","i").exec(t)&&(r.label||r)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),q=G([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),U=function(e){return y(e,function(e,r,n){return e||(r[q]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(q)]||RegExp("\\b"+v(n)+"(?:\\b|\\w*\\d)","i").exec(t))&&n})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),B=function(e){return y(e,function(e,r){var n=r.pattern||v(r);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),e=h(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,r.label||r)),e})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function G(e){return y(e,function(e,r){var n=r.pattern||v(r);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(r.label&&!RegExp(n,"i").test(r.label)?r.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),r=r.label||r,e=h(e[0].replace(RegExp(n,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),e})}if(D&&(D=[D]),U&&!q&&(q=G([U])),(a=/\bGoogle TV\b/.exec(q))&&(q=a[0]),/\bSimulator\b/i.test(t)&&(q=(q?q+" ":"")+"Simulator"),"Opera Mini"==N&&/\bOPiOS\b/.test(t)&&P.push("running in Turbo/Uncompressed mode"),"IE"==N&&/\blike iPhone OS\b/.test(t)?(U=(a=e(t.replace(/like iPhone OS/,""))).manufacturer,q=a.product):/^iP/.test(q)?(N||(N="Safari"),B="iOS"+((a=/ OS ([\d_]+)/i.exec(t))?" "+a[1].replace(/_/g,"."):"")):"Konqueror"!=N||/buntu/i.test(B)?U&&"Google"!=U&&(/Chrome/.test(N)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(q))||/\bAndroid\b/.test(B)&&/^Chrome/.test(N)&&/\bVersion\//i.test(t)?(N="Android Browser",B=/\bAndroid\b/.test(B)?B:"Android"):"Silk"==N?(/\bMobi/i.test(t)||(B="Android",P.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&P.unshift("accelerated")):"PaleMoon"==N&&(a=/\bFirefox\/([\d.]+)\b/.exec(t))?P.push("identifying as Firefox "+a[1]):"Firefox"==N&&(a=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(B||(B="Firefox OS"),q||(q=a[1])):!N||(a=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(N))?(N&&!q&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(a+"/")+8))&&(N=null),(a=q||U||B)&&(q||U||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(B))&&(N=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(B)?B:a)+" Browser")):"Electron"==N&&(a=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&P.push("Chromium "+a):B="Kubuntu",F||(F=y(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",v(N),"(?:Firefox|Minefield|NetFront)"],function(e,r){return e||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null})),(a=("iCab"==D&&parseFloat(F)>3?"WebKit":/\bOpera\b/.test(N)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(D)&&"WebKit"||!D&&/\bMSIE\b/i.test(t)&&("Mac OS"==B?"Tasman":"Trident")||"WebKit"==D&&/\bPlayStation\b(?! Vita\b)/i.test(N)&&"NetFront")&&(D=[a]),"IE"==N&&(a=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(N+=" Mobile",B="Windows Phone "+(/\+$/.test(a)?a:a+".x"),P.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(N="IE Mobile",B="Windows Phone 8.x",P.unshift("desktop mode"),F||(F=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=N&&"Trident"==D&&(a=/\brv:([\d.]+)/.exec(t))&&(N&&P.push("identifying as "+N+(F?" "+F:"")),N="IE",F=a[1]),L){if(f="global",p=null!=(l=r)?typeof l[f]:"number",/^(?:boolean|number|string|undefined)$/.test(p)||"object"==p&&!l[f])m(a=r.runtime)==k?(N="Adobe AIR",B=a.flash.system.Capabilities.os):m(a=r.phantom)==j?(N="PhantomJS",F=(a=a.version||null)&&a.major+"."+a.minor+"."+a.patch):"number"==typeof M.documentMode&&(a=/\bTrident\/(\d+)/i.exec(t))?(F=[F,M.documentMode],(a=+a[1]+4)!=F[1]&&(P.push("IE "+F[1]+" mode"),D&&(D[1]=""),F[1]=a),F="IE"==N?String(F[1].toFixed(1)):F[0]):"number"==typeof M.documentMode&&/^(?:Chrome|Firefox)\b/.test(N)&&(P.push("masking as "+N+" "+F),N="IE",F="11.0",D=["Trident"],B="Windows");else if(C&&(O=(a=C.lang.System).getProperty("os.arch"),B=B||a.getProperty("os.name")+" "+a.getProperty("os.version")),S){try{F=r.require("ringo/engine").version.join("."),N="RingoJS"}catch(e){(a=r.system)&&a.global.system==r.system&&(N="Narwhal",B||(B=a[0].os||null))}N||(N="Rhino")}else"object"==typeof r.process&&!r.process.browser&&(a=r.process)&&("object"==typeof a.versions&&("string"==typeof a.versions.electron?(P.push("Node "+a.versions.node),N="Electron",F=a.versions.electron):"string"==typeof a.versions.nw&&(P.push("Chromium "+F,"Node "+a.versions.node),N="NW.js",F=a.versions.nw)),N||(N="Node.js",O=a.arch,B=a.platform,F=(F=/[\d.]+/.exec(a.version))?F[0]:null));B=B&&h(B)}if(F&&(a=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(F)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(L&&o.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(A=/b/i.test(a)?"beta":"alpha",F=F.replace(RegExp(a+"\\+?$"),"")+("beta"==A?E:T)+(/\d+\+?/.exec(a)||"")),"Fennec"==N||"Firefox"==N&&/\b(?:Android|Firefox OS)\b/.test(B))N="Firefox Mobile";else if("Maxthon"==N&&F)F=F.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(q))"Xbox 360"==q&&(B=null),"Xbox 360"==q&&/\bIEMobile\b/.test(t)&&P.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(N)&&(!N||q||/Browser|Mobi/.test(N))||"Windows CE"!=B&&!/Mobi/i.test(t))if("IE"==N&&L)try{null===r.external&&P.unshift("platform preview")}catch(e){P.unshift("embedded")}else(/\bBlackBerry\b/.test(q)||/\bBB10\b/.test(t))&&(a=(RegExp(q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||F)?(B=((a=[a,/BB10/.test(t)])[1]?(q=null,U="BlackBerry"):"Device Software")+" "+a[0],F=null):this!=b&&"Wii"!=q&&(L&&R||/Opera/.test(N)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==N&&/\bOS X (?:\d+\.){2,}/.test(B)||"IE"==N&&(B&&!/^Win/.test(B)&&F>5.5||/\bWindows XP\b/.test(B)&&F>8||8==F&&!/\bTrident\b/.test(t)))&&!c.test(a=e.call(b,t.replace(c,"")+";"))&&a.name&&(a="ing as "+a.name+((a=a.version)?" "+a:""),c.test(N)?(/\bIE\b/.test(a)&&"Mac OS"==B&&(B=null),a="identify"+a):(a="mask"+a,N=I?h(I.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(a)&&(B=null),L||(F=null)),D=["Presto"],P.push(a));else N+=" Mobile";(a=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(a=[parseFloat(a.replace(/\.(\d)$/,".0$1")),a],"Safari"==N&&"+"==a[1].slice(-1)?(N="WebKit Nightly",A="alpha",F=a[1].slice(0,-1)):F!=a[1]&&F!=(a[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(F=null),a[1]=(/\bChrome\/([\d.]+)/i.exec(t)||0)[1],537.36==a[0]&&537.36==a[2]&&parseFloat(a[1])>=28&&"WebKit"==D&&(D=["Blink"]),L&&(_||a[1])?(D&&(D[1]="like Chrome"),a=a[1]||((a=a[0])<530?1:a<532?2:a<532.05?3:a<533?4:a<534.03?5:a<534.07?6:a<534.1?7:a<534.13?8:a<534.16?9:a<534.24?10:a<534.3?11:a<535.01?12:a<535.02?"13+":a<535.07?15:a<535.11?16:a<535.19?17:a<536.05?18:a<536.1?19:a<537.01?20:a<537.11?"21+":a<537.13?23:a<537.18?24:a<537.24?25:a<537.36?26:"Blink"!=D?"27":"28")):(D&&(D[1]="like Safari"),a=(a=a[0])<400?1:a<500?2:a<526?3:a<533?4:a<534?"4+":a<535?5:a<537?6:a<538?7:a<601?8:"8"),D&&(D[1]+=" "+(a+="number"==typeof a?".x":/[.+]/.test(a)?"":"+")),"Safari"==N&&(!F||parseInt(F)>45)&&(F=a)),"Opera"==N&&(a=/\bzbov|zvav$/.exec(B))?(N+=" ",P.unshift("desktop mode"),"zvav"==a?(N+="Mini",F=null):N+="Mobile",B=B.replace(RegExp(" *"+a+"$"),"")):"Safari"==N&&/\bChrome\b/.exec(D&&D[1])&&(P.unshift("desktop mode"),N="Chrome Mobile",F=null,/\bOS X\b/.test(B)?(U="Apple",B="iOS 4.3+"):B=null),F&&0==F.indexOf(a=/[\d.]+$/.exec(B))&&t.indexOf("/"+a+"-")>-1&&(B=g(B.replace(a,""))),D&&!/\b(?:Avant|Nook)\b/.test(N)&&(/Browser|Lunascape|Maxthon/.test(N)||"Safari"!=N&&/^iOS/.test(B)&&/\bSafari\b/.test(D[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(N)&&D[1])&&(a=D[D.length-1])&&P.push(a),P.length&&(P=["("+P.join("; ")+")"]),U&&q&&q.indexOf(U)<0&&P.push("on "+U),q&&P.push((/^on /.test(P[P.length-1])?"":"on ")+q),B&&(a=/ ([\d.+]+)$/.exec(B),u=a&&"/"==B.charAt(B.length-a[0].length-1),B={architecture:32,family:a&&!u?B.replace(a[0],""):B,version:a?a[1]:null,toString:function(){var e=this.version;return this.family+(e&&!u?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(a=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(O))&&!/\bi686\b/i.test(O)?(B&&(B.architecture=64,B.family=B.family.replace(RegExp(" *"+a),"")),N&&(/\bWOW64\b/i.test(t)||L&&/\w(?:86|32)$/.test(o.cpuClass||o.platform)&&!/\bWin64; x64\b/i.test(t))&&P.unshift("32-bit")):B&&/^OS X/.test(B.family)&&"Chrome"==N&&parseFloat(F)>=39&&(B.architecture=64),t||(t=null);var W={};return W.description=t,W.layout=D&&D[0],W.manufacturer=U,W.name=N,W.prerelease=A,W.product=q,W.ua=t,W.version=N&&F,W.os=B||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=e,W.toString=function(){return this.description||""},W.version&&P.unshift(F),W.name&&P.unshift(N),B&&N&&(B!=String(B).split(" ")[0]||B!=N.split(" ")[0]&&!q)&&P.push(q?"("+B+")":"on "+B),P.length&&(W.description=P.join(" ")),W}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(i.platform=_,define(function(){return _})):o&&s?b(_,function(e,t){o[t]=e}):i.platform=_}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],207:[function(e,t,r){
/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
t.exports=e("./lib/checks")},{"./lib/checks":208}],208:[function(e,t,r){
/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
var n=e("util"),i=t.exports=e("./errors");function o(e,t,r,i){r=r||"";var o=new e(n.format.apply(this,[r].concat(i)));throw Error.captureStackTrace(o,t),o}function s(e,t,r){o(i.IllegalArgumentError,e,t,r)}function a(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array"}return t}function u(e){return function(t,r){var n=a(t);if(n==e)return t;s(arguments.callee,r||'Expected "'+e+'" but got "'+n+'".',Array.prototype.slice.call(arguments,2))}}t.exports.checkArgument=function(e,t){e||s(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkState=function(e,t){e||function(e,t,r){o(i.IllegalStateError,e,t,r)}(arguments.callee,t,Array.prototype.slice.call(arguments,2))},t.exports.checkIsDef=function(e,t){if(void 0!==e)return e;s(arguments.callee,t||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},t.exports.checkIsDefAndNotNull=function(e,t){if(null!=e)return e;s(arguments.callee,t||'Expected value to be defined and not null but got "'+a(e)+'".',Array.prototype.slice.call(arguments,2))},t.exports.checkIsString=u("string"),t.exports.checkIsArray=u("array"),t.exports.checkIsNumber=u("number"),t.exports.checkIsBoolean=u("boolean"),t.exports.checkIsFunction=u("function"),t.exports.checkIsObject=u("object")},{"./errors":209,util:249}],209:[function(e,t,r){
/*
 * Copyright (c) 2012 Mathieu Turcotte
 * Licensed under the MIT license.
 */
var n=e("util");function i(e){Error.call(this,e),this.message=e}function o(e){Error.call(this,e),this.message=e}n.inherits(i,Error),i.prototype.name="IllegalArgumentError",n.inherits(o,Error),o.prototype.name="IllegalStateError",t.exports.IllegalStateError=o,t.exports.IllegalArgumentError=i},{util:249}],210:[function(e,t,r){var n,i,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function u(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var c,l=[],f=!1,d=-1;function p(){f&&c&&(f=!1,c.length?l=c.concat(l):d=-1,l.length&&h())}function h(){if(!f){var e=u(p);f=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,f=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function b(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new b(e,t)),1!==l.length||f||u(h)},b.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],211:[function(e,t,r){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=e("./runtime"),i)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},{"./runtime":212}],212:[function(e,t,r){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){"use strict";var r,n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag",c="object"==typeof t,l=e.regeneratorRuntime;if(l)c&&(t.exports=l);else{(l=e.regeneratorRuntime=c?t.exports:{}).wrap=_;var f="suspendedStart",d="suspendedYield",p="executing",h="completed",b={},m={};m[s]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(I([])));y&&y!==n&&i.call(y,s)&&(m=y);var g=j.prototype=x.prototype=Object.create(m);w.prototype=g.constructor=j,j.constructor=w,j[u]=w.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,j):(e.__proto__=j,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(g),e},l.awrap=function(e){return{__await:e}},C(S.prototype),S.prototype[a]=function(){return this},l.AsyncIterator=S,l.async=function(e,t,r,n){var i=new S(_(e,t,r,n));return l.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},C(g),g[u]="Generator",g[s]=function(){return this},g.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},l.values=I,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=r),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var u=i.call(s,"catchLoc"),c=i.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),M(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;M(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:I(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),b}}}function _(e,t,r,n){var i=t&&t.prototype instanceof x?t:x,o=Object.create(i.prototype),s=new R(n||[]);return o._invoke=function(e,t,r){var n=f;return function(i,o){if(n===p)throw new Error("Generator is already running");if(n===h){if("throw"===i)throw o;return O()}for(r.method=i,r.arg=o;;){var s=r.delegate;if(s){var a=T(s,r);if(a){if(a===b)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var u=k(e,t,r);if("normal"===u.type){if(n=r.done?h:d,u.arg===b)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=h,r.method="throw",r.arg=u.arg)}}}(e,r,s),o}function k(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function x(){}function w(){}function j(){}function C(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function S(e){var t;this._invoke=function(r,n){function o(){return new Promise(function(t,o){!function t(r,n,o,s){var a=k(e[r],e,n);if("throw"!==a.type){var u=a.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,o,s)},function(e){t("throw",e,o,s)}):Promise.resolve(c).then(function(e){u.value=e,o(u)},s)}s(a.arg)}(r,n,t,o)})}return t=t?t.then(o,o):o()}}function T(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,T(e,t),"throw"===t.method))return b;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return b}var i=k(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,b;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,b):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function I(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return o.next=o}}return{next:O}}function O(){return{value:r,done:!0}}}(function(){return this}()||Function("return this")())},{}],213:[function(e,t,r){"use strict";var n=l(e("babel-runtime/regenerator")),i=l(e("babel-runtime/helpers/asyncToGenerator")),o=l(e("babel-runtime/core-js/object/get-prototype-of")),s=l(e("babel-runtime/helpers/classCallCheck")),a=l(e("babel-runtime/helpers/createClass")),u=l(e("babel-runtime/helpers/possibleConstructorReturn")),c=l(e("babel-runtime/helpers/inherits"));function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var f=e("events"),d=e("twilsock"),p=e("./configuration"),h=e("./registrar"),b=e("./logger"),m=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,o.default)(t)).call(this));if(!e||0===e.length)throw new Error("Token is required for Notifications client");r.logLevel=r.logLevel||"error",b.log.setLevel(r.logLevel);r.minTokenRefreshInterval;var i=r.productId||"notifications";return r.twilsockClient=r.twilsockClient||new d.TwilsockClient(e,i,r),r.transport=r.transport||r.twilsockClient,n.services={twilsock:r.twilsockClient,transport:r.transport,config:new p.Configuration(null,r)},n.registrar=new h.Registrar(i,n.services.transport,n.services.twilsock,n.services.config),n.reliableTransportState={overall:!1,transport:!1,registration:!1,lastEmitted:null},n._onTransportStateChange(n.services.twilsock.isConnected),n.registrar.on("transportReady",function(e){n._onRegistrationStateChange(e?"registered":"")}),n.registrar.on("stateChanged",function(e){n._onRegistrationStateChange(e)}),n.registrar.on("needReliableTransport",n._onNeedReliableTransport.bind(n)),n.services.twilsock.on("message",function(e,t){return n._routeMessage(e,t)}),n.services.twilsock.on("connected",function(e){n._onTransportStateChange(!0),n.registrar.setNotificationId("twilsock",e)}),n.services.twilsock.on("disconnected",function(){n._onTransportStateChange(!1)}),n.services.config.updateToken(e),n.registrar.updateToken(e),n}return(0,c.default)(t,e),(0,a.default)(t,[{key:"_routeMessage",value:function(e,t){b.log.trace("Message arrived: ",e,t),this.emit("message",e,t)}},{key:"_onNeedReliableTransport",value:function(e){e?this.services.twilsock.connect():this.services.twilsock.disconnect()}},{key:"_onRegistrationStateChange",value:function(e){this.reliableTransportState.registration="registered"===e,this._updateTransportState()}},{key:"_onTransportStateChange",value:function(e){this.reliableTransportState.transport=e,this._updateTransportState()}},{key:"_updateTransportState",value:function(){var e=this.reliableTransportState.transport&&this.reliableTransportState.registration;this.reliableTransportState.overall!==e&&(this.reliableTransportState.overall=e,b.log.info("Transport ready:",e),this.emit("transportReady",e)),this.reliableTransportState.lastEmitted!==this.connectionState&&(this.reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}},{key:"subscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return b.log.trace("Add subscriptions for message type: ",e,t),this.registrar.subscribe(e,t)}},{key:"unsubscribe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"twilsock";return b.log.trace("Remove subscriptions for message type: ",e,t),this.registrar.unsubscribe(e,t)}},{key:"handlePushNotification",value:function(e){return{messageType:e.twi_message_type,payload:e.payload}}},{key:"setPushRegistrationId",value:function(e,t){b.log.trace("Set push registration id",e,t),this.registrar.setNotificationId(t,e)}},{key:"updateToken",value:function(){var e=(0,i.default)(n.default.mark(function e(t){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(b.log.info("authTokenUpdated"),this.services.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.services.twilsock.updateToken(t);case 5:this.services.config.updateToken(t),this.registrar.updateToken(t);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"connectionState",get:function(){return"disconnected"===this.services.twilsock.state?"disconnected":"disconnecting"===this.services.twilsock.state?"disconnecting":"connected"===this.services.twilsock.state&&this.reliableTransportState.registration?"connected":"rejected"===this.services.twilsock.state?"denied":"connecting"}}]),t}(f.EventEmitter);r.Client=m},{"./configuration":214,"./logger":217,"./registrar":219,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59,events:200,twilsock:229}],214:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,n.default)(this,e);var i=r.notifications||{},o="https://ers."+(i.region||r.region||"us1")+".twilio.com/v1/registrations";this.registrarUrl=i.ersUrl||o,this._token=t}return(0,i.default)(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"token",get:function(){return this._token}}]),e}();r.Configuration=s},{"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],215:[function(e,t,r){"use strict";var n=p(e("babel-runtime/helpers/slicedToArray")),i=p(e("babel-runtime/regenerator")),o=p(e("babel-runtime/helpers/asyncToGenerator")),s=p(e("babel-runtime/core-js/object/get-prototype-of")),a=p(e("babel-runtime/helpers/possibleConstructorReturn")),u=p(e("babel-runtime/helpers/inherits")),c=p(e("babel-runtime/helpers/toConsumableArray")),l=p(e("babel-runtime/core-js/set")),f=p(e("babel-runtime/helpers/classCallCheck")),d=p(e("babel-runtime/helpers/createClass"));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var h=e("events"),b=e("./logger"),m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new l.default;(0,f.default)(this,e),this.token=t,this.notificationId=r,this.messageTypes=n}return(0,d.default)(e,[{key:"clone",value:function(){return new e(this.token,this.notificationId,new l.default(this.messageTypes))}}]),e}();function v(e,t){var r=new l.default;return e.notificationId!==t.notificationId&&r.add("notificationId"),e.token!==t.token&&r.add("token"),function(e,t){return[].concat((0,c.default)([].concat((0,c.default)(e)).filter(function(e){return!t.has(e)})),(0,c.default)([].concat((0,c.default)(t)).filter(function(t){return!e.has(t)})))}(e.messageTypes,t.messageTypes).length>0&&r.add("messageType"),[r.size>0,r]}r.RegistrationState=m;var y=function(e){function t(e){(0,f.default)(this,t);var r=(0,a.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return r.config=e,r.desiredState=new m,r.currentState=new m,r.hasActiveAttempt=!1,r}return(0,u.default)(t,e),(0,d.default)(t,[{key:"subscribe",value:function(){var e=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.desiredState.messageTypes.has(t)){e.next=3;break}return b.log.debug("message type already registered ",t),e.abrupt("return");case 3:this.desiredState.messageTypes.add(t),this.persistRegistration();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribe",value:function(){var e=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.desiredState.messageTypes.has(t)){e.next=2;break}return e.abrupt("return");case 2:this.desiredState.messageTypes.delete(t),this.persistRegistration();case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateToken",value:function(e){this.desiredState.token=e,this.persistRegistration()}},{key:"persistRegistration",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t,r,o,s,a,u,c=this;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.config.token&&0!==this.config.token.length){e.next=3;break}return b.log.trace("Can't persist registration: token is not set"),e.abrupt("return");case 3:if(!this.hasActiveAttempt){e.next=6;break}return b.log.trace("One registration attempt is already in progress"),e.abrupt("return");case 6:if(t=v(this.desiredState,this.currentState),r=(0,n.default)(t,2),o=r[0],s=r[1],o){e.next=9;break}return e.abrupt("return");case 9:if(this.currentState.notificationId||s.delete("notificationId"),b.log.trace("Persisting registration",s,this.desiredState),e.prev=11,this.hasActiveAttempt=!0,!((a=this.desiredState.clone()).messageTypes.size>0)){e.next=24;break}return e.next=17,this.updateRegistration(a,s);case 17:u=e.sent,this.currentState.token=u.token,this.currentState.notificationId=u.notificationId,this.currentState.messageTypes=u.messageTypes,this.emit("stateChanged","registered"),e.next=30;break;case 24:return e.next=26,this.removeRegistration();case 26:this.currentState.token=a.token,this.currentState.notificationId=a.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged","unregistered");case 30:return e.prev=30,this.hasActiveAttempt=!1,setTimeout(function(){return c.persistRegistration()},0),e.finish(30);case 34:case"end":return e.stop()}},e,this,[[11,,30,34]])}));return function(){return e.apply(this,arguments)}}()},{key:"setNotificationId",value:function(e){this.desiredState.notificationId=e,this.persistRegistration()}}]),t}(h.EventEmitter);r.Connector=y},{"./logger":217,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/set":47,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/helpers/slicedToArray":56,"babel-runtime/helpers/toConsumableArray":57,"babel-runtime/regenerator":59,events:200}],216:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./client");r.Notifications=n.Client},{"./client":213}],217:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass")),o=s(e("babel-runtime/core-js/array/from"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("loglevel");function u(e,t){return[(new Date).toISOString()+" Notifications "+e+":"].concat((0,o.default)(t))}var c=function(){function e(){(0,n.default)(this,e),this.prefix=""}return(0,i.default)(e,[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,u("T"+this.prefix,t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,u("D"+this.prefix,t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info.apply(null,u("I"+this.prefix,t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.warn.apply(null,u("W"+this.prefix,t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.error.apply(null,u("E"+this.prefix,t))}}],[{key:"scope",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new e}}]),e}();r.Logger=c;var l=c.scope();r.log=l},{"babel-runtime/core-js/array/from":33,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,loglevel:204}],218:[function(e,t,r){"use strict";var n=d(e("babel-runtime/core-js/array/from")),i=d(e("babel-runtime/core-js/object/assign")),o=d(e("babel-runtime/regenerator")),s=d(e("babel-runtime/helpers/asyncToGenerator")),a=d(e("babel-runtime/core-js/object/get-prototype-of")),u=d(e("babel-runtime/helpers/classCallCheck")),c=d(e("babel-runtime/helpers/createClass")),l=d(e("babel-runtime/helpers/possibleConstructorReturn")),f=d(e("babel-runtime/helpers/inherits"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=e("operation-retrier"),h=e("./logger"),b=e("./connector");r.Connector=b.Connector;var m={min:2e3,max:12e4,randomness:.2},v=function(e){function t(e,r,n,i){(0,u.default)(this,t);var o=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this,i));return o.channelType=e,o.context=r,o.transport=n,o}return(0,f.default)(t,e),(0,c.default)(t,[{key:"updateRegistration",value:function(){var e=(0,s.default)(o.default.mark(function e(t,r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.has("notificationId")){e.next=3;break}return e.next=3,this.removeRegistration();case 3:if(t.notificationId&&t.notificationId.length){e.next=5;break}return e.abrupt("return",t);case 5:return e.next=7,this.register(t);case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeRegistration",value:function(){var e=(0,s.default)(o.default.mark(function e(){var t,r,n=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrationId){e.next=2;break}return e.abrupt("return");case 2:return t=this.config.registrarUrl+"/"+this.registrationId+"?productId="+this.context.productId,r={"Content-Type":"application/json","X-Twilio-Token":this.config.token},e.prev=4,h.log.trace("Removing registration for ",this.channelType),e.next=8,new p.Retrier((0,i.default)(m,{maxAttemptsCount:3})).run(function(){return n.transport.delete(t,r)});case 8:h.log.debug("Registration removed for",this.channelType),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(4),h.log.error("Failed to remove of registration ",this.channelType,e.t0),e.t0;case 15:case"end":return e.stop()}},e,this,[[4,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"register",value:function(){var e=(0,s.default)(o.default.mark(function e(t){var r,i,s,a,u=this;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return h.log.trace("Registering",this.channelType,t),r={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:(0,n.default)(t.messageTypes),data:{registration_id:t.notificationId},ttl:"PT24H"},i=this.config.registrarUrl+"?productId="+this.context.productId,s={"Content-Type":"application/json","X-Twilio-Token":t.token},h.log.trace("Creating registration for channel ",this.channelType),e.prev=5,e.next=8,new p.Retrier(m).run(function(){return u.transport.post(i,s,r)});case 8:a=e.sent,this.registrationId=a.body.id,h.log.debug("Registration created: ",a),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(5),h.log.error("Registration failed: ",e.t0),e.t0;case 17:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t){return e.apply(this,arguments)}}()}]),t}(b.Connector);r.RegistrarConnector=v},{"./connector":215,"./logger":217,"babel-runtime/core-js/array/from":33,"babel-runtime/core-js/object/assign":38,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59,"operation-retrier":205}],219:[function(e,t,r){"use strict";var n=c(e("babel-runtime/core-js/map")),i=c(e("babel-runtime/core-js/object/get-prototype-of")),o=c(e("babel-runtime/helpers/classCallCheck")),s=c(e("babel-runtime/helpers/createClass")),a=c(e("babel-runtime/helpers/possibleConstructorReturn")),u=c(e("babel-runtime/helpers/inherits"));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=e("events"),f=e("./registrar.connector"),d=e("./twilsock.connector"),p=function(e){function t(e,r,s,u){(0,o.default)(this,t);var c=(0,a.default)(this,(t.__proto__||(0,i.default)(t)).call(this));c.config=u,c.connectors=new n.default;var l=c.detectPlatform();return c.connectors.set("gcm",new f.RegistrarConnector("gcm",{protocolVersion:3,productId:e,platform:l},r,u)),c.connectors.set("fcm",new f.RegistrarConnector("fcm",{protocolVersion:3,productId:e,platform:l},r,u)),c.connectors.set("apn",new f.RegistrarConnector("apn",{protocolVersion:4,productId:e,platform:l},r,u)),c.connectors.set("twilsock",new d.TwilsockConnector({productId:e,platform:l},s,u)),c.connectors.get("twilsock").on("transportReady",function(e){return c.emit("transportReady",e)}),c}return(0,u.default)(t,e),(0,s.default)(t,[{key:"setNotificationId",value:function(e,t){this.connector(e).setNotificationId(t)}},{key:"subscribe",value:function(e,t){return this.connector(t).subscribe(e)}},{key:"unsubscribe",value:function(e,t){return this.connector(t).unsubscribe(e)}},{key:"updateToken",value:function(e){this.connectors.forEach(function(t){return t.updateToken(e)})}},{key:"connector",value:function(e){var t=this.connectors.get(e);if(!t)throw new Error("Unknown channel type: "+e);return t}},{key:"detectPlatform",value:function(){var e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}]),t}(l.EventEmitter);r.Registrar=p},{"./registrar.connector":218,"./twilsock.connector":220,"babel-runtime/core-js/map":37,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,events:200}],220:[function(e,t,r){"use strict";var n=f(e("babel-runtime/core-js/array/from")),i=f(e("babel-runtime/regenerator")),o=f(e("babel-runtime/helpers/asyncToGenerator")),s=f(e("babel-runtime/core-js/object/get-prototype-of")),a=f(e("babel-runtime/helpers/classCallCheck")),u=f(e("babel-runtime/helpers/createClass")),c=f(e("babel-runtime/helpers/possibleConstructorReturn")),l=f(e("babel-runtime/helpers/inherits"));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var d=e("uuid"),p=function(e){function t(e,r,n){(0,a.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this,n));return i.twilsock=r,i.context=e,e.id=d.v4(),i.twilsock.on("stateChanged",function(e){"connected"!==e&&i.emit("transportReady",!1)}),i.twilsock.on("registered",function(t){e&&t===e.id&&"connected"===r.state&&i.emit("transportReady",!0)}),i}return(0,l.default)(t,e),(0,u.default)(t,[{key:"setNotificationId",value:function(){}},{key:"updateToken",value:function(e){}},{key:"updateContextRequest",value:function(){var e=(0,o.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,message_types:t},this.emit("transportReady",!1),e.next=4,this.twilsock.setNotificationsContext(this.context.id,r);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateRegistration",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.has("messageType")){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.updateContextRequest((0,n.default)(t.messageTypes));case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeRegistration",value:function(){return this.twilsock.removeNotificationsContext(this.context.id)}}]),t}(e("./connector").Connector);r.TwilsockConnector=p},{"./connector":215,"babel-runtime/core-js/array/from":33,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59,uuid:250}],221:[function(e,t,r){"use strict";var n=c(e("babel-runtime/core-js/object/assign")),i=c(e("babel-runtime/core-js/object/get-prototype-of")),o=c(e("babel-runtime/helpers/classCallCheck")),s=c(e("babel-runtime/helpers/possibleConstructorReturn")),a=c(e("babel-runtime/helpers/createClass")),u=c(e("babel-runtime/helpers/inherits"));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var l=e("events"),f=e("operation-retrier"),d=function(e){function t(e){(0,o.default)(this,t);var r=(0,s.default)(this,(t.__proto__||(0,i.default)(t)).call(this));return r.options=e?(0,n.default)({},e):{},r}return(0,u.default)(t,e),(0,a.default)(t,[{key:"inProgress",get:function(){return!!this.retrier}}]),(0,a.default)(t,[{key:"start",value:function(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}},{key:"stop",value:function(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}},{key:"modifyBackoff",value:function(e){this.newBackoff=e}},{key:"attemptFailed",value:function(){if(!this.inProgress)throw new Error("No attempt is in progress");this.newBackoff?!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():this.retrier.failed(new Error):this.retrier.failed(new Error)}},{key:"cancel",value:function(){this.retrier&&this.retrier.cancel()}},{key:"cleanRetrier",value:function(){this.retrier&&(this.retrier.removeAllListeners(),this.retrier.cancel(),this.retrier=null)}},{key:"getRetryPolicy",value:function(){var e=(0,n.default)({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}},{key:"createRetrier",value:function(){var e=this;this.cleanRetrier();var t=this.getRetryPolicy();this.retrier=new f.default(t),this.retrier.once("attempt",function(){e.retrier.on("attempt",function(){return e.emit("attempt")}),e.retrier.failed(new Error("Skipping first attempt"))}),this.retrier.on("failed",function(t){return e.emit("failed",t)}),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start().catch(function(e){})}}]),t}(l.EventEmitter);r.BackoffRetrier=d},{"babel-runtime/core-js/object/assign":38,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,events:200,"operation-retrier":205}],222:[function(e,t,r){"use strict";var n=f(e("babel-runtime/regenerator")),i=f(e("babel-runtime/helpers/asyncToGenerator")),o=f(e("babel-runtime/core-js/json/stringify")),s=f(e("babel-runtime/core-js/object/get-prototype-of")),a=f(e("babel-runtime/helpers/classCallCheck")),u=f(e("babel-runtime/helpers/createClass")),c=f(e("babel-runtime/helpers/possibleConstructorReturn")),l=f(e("babel-runtime/helpers/inherits"));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var d=e("events"),p=e("./logger"),h=e("./configuration"),b=e("./twilsock"),m=e("./packetinterface"),v=e("./websocketchannel"),y=e("./services/registrations"),g=e("./services/upstream"),_=e("./deferred"),k=e("./index"),x=e("./offlinestorage"),w=e("./tokenStorage"),j=function(e){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,a.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,s.default)(t)).call(this));i.offlineStorageDeferred=new _.Deferred,n.continuationToken=n.continuationToken?n.continuationToken:w.TokenStorage.getStoredToken(r);var o=i.config=new h.Configuration(e,r,n);p.log.setLevel(o.logLevel);var u=new v.WebSocketChannel(o.url),l=n.transport?n.transport:new m.PacketInterface(u,o);return i.channel=n.channel?n.channel:new b.TwilsockImpl(u,l,o),i.registrations=n.registrations?n.registrations:new y.Registrations(l),i.upstream=new g.Upstream(l,i.channel,o),i.registrations.on("registered",function(e){return i.emit("registered",e)}),i.channel.on("message",function(e,t){return setTimeout(function(){return i.emit("message",e,t)},0)}),i.channel.on("tokenAboutToExpire",function(){return setTimeout(function(){return i.emit("tokenAboutToExpire")},0)}),i.channel.on("tokenExpired",function(){return setTimeout(function(){return i.emit("tokenExpired")},0)}),i.channel.on("connected",function(){return i.registrations.updateRegistrations()}),i.channel.on("connected",function(){return i.upstream.sendPendingMessages()}),i.channel.on("connected",function(){return setTimeout(function(){return i.emit("connected")},0)}),i.channel.on("disconnected",function(){return setTimeout(function(){return i.emit("disconnected")},0)}),i.channel.on("disconnected",function(){return i.upstream.rejectPendingMessages()}),i.channel.on("stateChanged",function(e){return setTimeout(function(){return i.emit("stateChanged",e)},0)}),i.channel.on("disconnected",function(){return i.offlineStorageDeferred.fail(new k.TwilsockError("Client disconnected"))}),i.channel.on("initialized",function(e){i.handleStorageId(r,e),w.TokenStorage.storeToken(e.continuationToken,r)}),i.offlineStorageDeferred.promise.catch(function(){}),i}return(0,l.default)(t,e),(0,u.default)(t,[{key:"handleStorageId",value:function(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(x.OfflineProductStorage.create(t.offlineStorage[e])),p.log.debug("Offline storage for '"+e+"' product: "+(0,o.default)(t.offlineStorage[e])+".")}catch(r){this.offlineStorageDeferred.fail(new k.TwilsockError("Failed to parse offline storage for "+e+" "+(0,o.default)(t.offlineStorage[e])+". "+r+"."))}else this.offlineStorageDeferred.fail(new k.TwilsockError("No offline storage id for '"+e+"' product: "+(0,o.default)(t.offlineStorage)));else this.offlineStorageDeferred.fail(new k.TwilsockError("No offline storage id"))}},{key:"storageId",value:function(){return this.offlineStorageDeferred.promise}},{key:"updateToken",value:function(){var e=(0,i.default)(n.default.mark(function e(t){return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.log.trace("updating token '"+t+"'"),this.config.token!==t){e.next=3;break}return e.abrupt("return");case 3:return this.config.updateToken(t),e.abrupt("return",this.channel.updateToken(t));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setNotificationsContext",value:function(e,t){this.registrations.setNotificationsContext(e,t)}},{key:"removeNotificationsContext",value:function(e){this.registrations.removeNotificationsContext(e)}},{key:"connect",value:function(){return this.channel.connect()}},{key:"disconnect",value:function(){return this.channel.disconnect()}},{key:"get",value:function(e,t){return this.upstream.send("GET",e,t)}},{key:"post",value:function(e,t,r){return this.upstream.send("POST",e,t,r)}},{key:"put",value:function(e,t,r){return this.upstream.send("PUT",e,t,r)}},{key:"delete",value:function(e,t){return this.upstream.send("DELETE",e,t)}},{key:"isConnected",get:function(){return this.channel.isConnected}},{key:"state",get:function(){return this.channel.state}}]),t}(d.EventEmitter);r.TwilsockClient=j,r.Twilsock=j},{"./configuration":223,"./deferred":224,"./index":229,"./logger":230,"./offlinestorage":232,"./packetinterface":233,"./services/registrations":243,"./services/upstream":244,"./tokenStorage":245,"./twilsock":246,"./websocketchannel":247,"babel-runtime/core-js/json/stringify":36,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59,events:200}],223:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s="0.5.6",a=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,n.default)(this,e),this.activeGrant=r,this._token=t;var o="wss://tsock."+(i.region||"us1")+".twilio.com/v3/wsconnect",a=i.twilsock||i.Twilsock||{};this.url=a.uri||o,this._continuationToken=i.continuationToken?i.continuationToken:null,this.logLevel=i.logLevel?i.logLevel:"error",this.retryPolicy=i.retryPolicy?i.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=i.clientMetadata?i.clientMetadata:{},this.clientMetadata.ver=s,this.initRegistrations=i.initRegistrations?i.initRegistrations:null}return(0,i.default)(e,[{key:"updateToken",value:function(e){this._token=e}},{key:"updateContinuationToken",value:function(e){this._continuationToken=e}},{key:"token",get:function(){return this._token}},{key:"continuationToken",get:function(){return this._continuationToken}}]),e}();r.Configuration=a},{"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],224:[function(e,t,r){"use strict";var n=s(e("babel-runtime/core-js/promise")),i=s(e("babel-runtime/helpers/classCallCheck")),o=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(){var t=this;(0,i.default)(this,e),this._promise=new n.default(function(e,r){t._resolve=e,t._reject=r})}return(0,o.default)(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();r.Deferred=a},{"babel-runtime/core-js/promise":45,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],225:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(e){return(0,i.default)(this,t),(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e))}return(0,s.default)(t,e),t}(e("./twilsockerror").TwilsockError);r.TransportUnavailableError=u},{"./twilsockerror":226,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],226:[function(e,t,r){"use strict";var n=f(e("babel-runtime/core-js/object/create")),i=f(e("babel-runtime/core-js/object/set-prototype-of")),o=f(e("babel-runtime/core-js/array/from")),s=f(e("babel-runtime/core-js/reflect/construct")),a=f(e("babel-runtime/core-js/object/get-prototype-of")),u=f(e("babel-runtime/helpers/classCallCheck")),c=f(e("babel-runtime/helpers/possibleConstructorReturn")),l=f(e("babel-runtime/helpers/inherits"));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var d=function(e){function t(e){return(0,u.default)(this,t),(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e))}return(0,l.default)(t,e),t}(function(e){function t(){var t=(0,s.default)(e,(0,o.default)(arguments));return(0,i.default)(t,(0,a.default)(this)),t}return t.prototype=(0,n.default)(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i.default?(0,i.default)(t,e):t.__proto__=e,t}(Error));r.TwilsockError=d},{"babel-runtime/core-js/array/from":33,"babel-runtime/core-js/object/create":39,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/object/set-prototype-of":44,"babel-runtime/core-js/reflect/construct":46,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],227:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(e,r){(0,i.default)(this,t);var s=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return s.reply=r,s}return(0,s.default)(t,e),t}(e("./twilsockerror").TwilsockError);r.TwilsockReplyError=u},{"./twilsockerror":226,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],228:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(e,r,s){(0,i.default)(this,t);var a=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,r));return a.status=e,a.description=r,a.body=s,a}return(0,s.default)(t,e),t}(e("./twilsockerror").TwilsockError);r.TwilsockUpstreamError=u},{"./twilsockerror":226,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],229:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./client");r.TwilsockClient=n.TwilsockClient,r.Twilsock=n.TwilsockClient;var i=e("./error/twilsockerror");r.TwilsockError=i.TwilsockError;var o=e("./error/transportunavailableerror");r.TransportUnavailableError=o.TransportUnavailableError},{"./client":222,"./error/transportunavailableerror":225,"./error/twilsockerror":226}],230:[function(e,t,r){"use strict";var n=s(e("babel-runtime/helpers/classCallCheck")),i=s(e("babel-runtime/helpers/createClass")),o=s(e("babel-runtime/core-js/array/from"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("loglevel");function u(e,t){return[(new Date).toISOString()+" Twilsock "+e+":"].concat((0,o.default)(t))}var c=function(){function e(t){(0,n.default)(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?" "+t+":":""}return(0,i.default)(e,[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,u("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,u("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info.apply(null,u("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.warn.apply(null,u("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.error.apply(null,u("E",t))}}],[{key:"setLevel",value:function(e){a.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.trace.apply(null,u("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.debug.apply(null,u("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.info.apply(null,u("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.warn.apply(null,u("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];a.error.apply(null,u("E",t))}}]),e}();r.Logger=c;var l=new c("");r.log=l},{"babel-runtime/core-js/array/from":33,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,loglevel:204}],231:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=e("platform"),a=function(){function e(){(0,n.default)(this,e)}return(0,i.default)(e,null,[{key:"getMetadata",value:function(e){"undefined"!=typeof navigator&&s.parse(navigator.userAgent);var t=e&&e.clientMetadata?e.clientMetadata:{},r={env:s.name,envv:s.version,os:s.os.family,osv:s.os.version,osa:s.os.architecture,sdk:"js-default"},n={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter(function(e){return e in t||e in r}).forEach(function(e){return n[e]=e in t?t[e]:r[e]}),n}}]),e}();r.Metadata=a},{"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,platform:206}],232:[function(e,t,r){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=e("./index"),a=function(){function e(t){(0,n.default)(this,e),this.id=t}return(0,i.default)(e,null,[{key:"create",value:function(t){if(t instanceof Object&&"storage_id"in t)return new e(t.storage_id);throw new s.TwilsockError('Field "storage_id" is missing')}}]),e}();r.OfflineProductStorage=a},{"./index":229,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],233:[function(e,t,r){"use strict";var n=f(e("babel-runtime/core-js/promise")),i=f(e("babel-runtime/regenerator")),o=f(e("babel-runtime/helpers/asyncToGenerator")),s=f(e("babel-runtime/core-js/map")),a=f(e("babel-runtime/helpers/createClass")),u=f(e("babel-runtime/helpers/classCallCheck")),c=f(e("babel-runtime/core-js/json/stringify")),l=f(e("babel-runtime/helpers/typeof"));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var d=e("./logger"),p=e("uuid"),h=e("./error/twilsockerror"),b=e("./error/twilsockreplyerror"),m=e("./parser"),v=e("./protocol/messages"),y=e("./metadata");r.PacketResponse=function e(){(0,u.default)(this,e)};var g=function(){function e(t,r){var n=this;(0,u.default)(this,e),this.config=r,this.activeRequests=new s.default,this.channel=t,this.channel.on("reply",function(e){return n.processReply(e)}),this.channel.on("disconnected",function(){n.activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new h.TwilsockError("disconnected"))}),n.activeRequests.clear()})}return(0,a.default)(e,[{key:"processReply",value:function(e){var t,r=this.activeRequests.get(e.id);r&&(clearTimeout(r.timeout),this.activeRequests.delete(e.id),(t=e.status.code)>=200&&t<300?r.resolve(e):(r.reject(new b.TwilsockReplyError("Transport failure: "+e.status.status,e)),d.log.trace("message rejected")))}},{key:"storeRequest",value:function(e,t,r){var n={resolve:t,reject:r,timeout:setTimeout(function(){d.log.trace("request",e,"is timed out"),r(new h.TwilsockError("Twilsock: request timeout: "+e))},3e4)};this.activeRequests.set(e,n)}},{key:"shutdown",value:function(){this.activeRequests.forEach(function(e){clearTimeout(e.timeout),e.reject(new h.TwilsockError("Twilsock: request cancelled by user"))}),this.activeRequests.clear()}},{key:"sendInit",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t,r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.log.trace("sendInit"),t=y.Metadata.getMetadata(this.config),r=new v.Init(this.config.token,this.config.continuationToken,t,this.config.initRegistrations),e.next=5,this.sendWithReply(r);case 5:return n=e.sent,e.abrupt("return",new v.InitReply(n.id,n.header.continuation_token,n.header.continuation_token_status,n.header.offline_storage,n.header.init_registrations));case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"sendClose",value:function(){var e=new v.Close;this.send(e)}},{key:"sendWithReply",value:function(e,t){var r=this;return new n.default(function(n,i){var o=r.send(e,t);r.storeRequest(o,n,i)})}},{key:"send",value:function(e,t){e.id=e.id||"TM"+p.v4();var r=m.Parser.createPacket(e,function(e){switch(void 0===e?"undefined":(0,l.default)(e)){case"undefined":return"";case"object":return(0,c.default)(e);default:return e}}(t));try{return this.channel.send(r),e.id}catch(t){throw d.log.debug("failed to send ",e,t),d.log.trace(t.stack),t}}},{key:"isConnected",get:function(){return this.channel.isConnected}}]),e}();r.PacketInterface=g},{"./error/twilsockerror":226,"./error/twilsockreplyerror":227,"./logger":230,"./metadata":231,"./parser":234,"./protocol/messages":237,"babel-runtime/core-js/json/stringify":36,"babel-runtime/core-js/map":37,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/typeof":58,"babel-runtime/regenerator":59,uuid:250}],234:[function(e,t,r){"use strict";var n=s(e("babel-runtime/core-js/json/stringify")),i=s(e("babel-runtime/helpers/classCallCheck")),o=s(e("babel-runtime/helpers/createClass"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./logger");function u(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}).length}function c(e){var t=Array.prototype.map.call(e,function(e){return String.fromCharCode(e)}).join("").replace(/(.)/g,function(e,t){var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r});return decodeURIComponent(t)}function l(e){return JSON.parse(c(e))}var f=function(){function e(){(0,i.default)(this,e)}return(0,o.default)(e,null,[{key:"parse",value:function(e){var t=new Uint8Array(e),r=function(e){for(var t="",r=0;r<e.length;++r){var n=String.fromCharCode(e[r]);if(t+=n,"\r"===n){r+=2;break}}var i=t.split(" ");return{size:r,protocol:i[0],version:i[1],headerSize:Number(i[2])}}(t);if("TWILSOCK"===r.protocol&&"V3.0"===r.version){var n=null;try{n=l(t.subarray(r.size,r.size+r.headerSize))}catch(t){return void a.log.error("failed to parse message header",t,e)}a.log.debug("message received: ",n.method),a.log.trace("message received: ",n);var i=null;if(n.payload_size>0){var o=2+r.size+r.headerSize,s=n.payload_size;if(n.hasOwnProperty("payload_type")&&0!==n.payload_type.indexOf("application/json"))0===n.payload_type.indexOf("text/plain")&&(i=c(t.subarray(o,o+s)));else try{i=l(t.subarray(o,o+s))}catch(t){return void a.log.error("failed to parse message body",t,e)}}return{method:n.method,header:n,payload:i}}a.log.error("unsupported protocol: "+r.protocol+" ver "+r.version)}},{key:"createPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=u(t);var r,i,o=(0,n.default)(e)+"\r\n",s="TWILSOCK V3.0 "+(u(o)-2)+"\r\n";return a.log.debug("send request:",s+o+t),(r=encodeURIComponent(s+o+t).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}),i=new Uint8Array(r.length),Array.prototype.forEach.call(r,function(e,t){i[t]=e.charCodeAt(0)}),i).buffer}}]),e}();r.Parser=f},{"./logger":230,"babel-runtime/core-js/json/stringify":36,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],235:[function(e,t,r){"use strict";var n,i=e("babel-runtime/helpers/classCallCheck"),o=(n=i)&&n.__esModule?n:{default:n};Object.defineProperty(r,"__esModule",{value:!0});var s=e("uuid");r.AbstractMessage=function e(t){(0,o.default)(this,e),this.id=t||"TM"+s.v4()}},{"babel-runtime/helpers/classCallCheck":51,uuid:250}],236:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(){(0,i.default)(this,t);var e=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return e.method="close",e}return(0,s.default)(t,e),t}(e("./abstractmessage").AbstractMessage);r.Close=u},{"./abstractmessage":235,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],237:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./init");r.Init=n.Init;var i=e("./initReply");r.InitReply=i.InitReply;var o=e("./update");r.Update=o.Update;var s=e("./message");r.Message=s.Message;var a=e("./reply");r.Reply=a.Reply;var u=e("./close");r.Close=u.Close},{"./close":236,"./init":238,"./initReply":239,"./message":240,"./reply":241,"./update":242}],238:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(e,r,s){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,i.default)(this,t);var u=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return u.method="init",u.token=e,u.continuation_token=r,u.metadata=s,u.registrations=a,u.capabilities=["client_update","offline_storage"],u}return(0,s.default)(t,e),t}(e("./abstractmessage").AbstractMessage);r.Init=u},{"./abstractmessage":235,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],239:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),i=a(e("babel-runtime/helpers/possibleConstructorReturn")),o=a(e("babel-runtime/helpers/inherits")),s=a(e("babel-runtime/helpers/classCallCheck"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=e("./abstractmessage");r.ContinuationTokenStatus=function e(){(0,s.default)(this,e)};var c=function(e){function t(e,r,o,a,u){(0,s.default)(this,t);var c=(0,i.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return c.continuationToken=r,c.continuationTokenStatus=o,c.offlineStorage=a,c.initRegistrations=u,c}return(0,o.default)(t,e),t}(u.AbstractMessage);r.InitReply=c},{"./abstractmessage":235,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],240:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(e,r,s){(0,i.default)(this,t);var a=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return a.method="message",a.active_grant=e,a.payload_type=r,a.http_request=s,a}return(0,s.default)(t,e),t}(e("./abstractmessage").AbstractMessage);r.Message=u},{"./abstractmessage":235,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],241:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(e){(0,i.default)(this,t);var r=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this,e));return r.method="reply",r.payload_type="application/json",r.status={code:200,status:"OK"},r}return(0,s.default)(t,e),t}(e("./abstractmessage").AbstractMessage);r.Reply=u},{"./abstractmessage":235,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],242:[function(e,t,r){"use strict";var n=a(e("babel-runtime/core-js/object/get-prototype-of")),i=a(e("babel-runtime/helpers/classCallCheck")),o=a(e("babel-runtime/helpers/possibleConstructorReturn")),s=a(e("babel-runtime/helpers/inherits"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(e){function t(e){(0,i.default)(this,t);var r=(0,o.default)(this,(t.__proto__||(0,n.default)(t)).call(this));return r.method="update",r.token=e,r}return(0,s.default)(t,e),t}(e("./abstractmessage").AbstractMessage);r.Update=u},{"./abstractmessage":235,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55}],243:[function(e,t,r){"use strict";var n=d(e("babel-runtime/core-js/set")),i=d(e("babel-runtime/regenerator")),o=d(e("babel-runtime/helpers/asyncToGenerator")),s=d(e("babel-runtime/core-js/map")),a=d(e("babel-runtime/core-js/object/get-prototype-of")),u=d(e("babel-runtime/helpers/classCallCheck")),c=d(e("babel-runtime/helpers/createClass")),l=d(e("babel-runtime/helpers/possibleConstructorReturn")),f=d(e("babel-runtime/helpers/inherits"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var p=e("../logger"),h=e("events"),b=e("uuid"),m=e("../error/twilsockerror"),v=function(e){function t(e){(0,u.default)(this,t);var r=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return r.transport=e,r.registrations=new s.default,r.registrationsInProgress=new s.default,r}return(0,f.default)(t,e),(0,c.default)(t,[{key:"putNotificationContext",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r){var n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"put_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(n,r);case 3:e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteNotificationContext",value:function(){var e=(0,o.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"delete_notification_ctx",notification_ctx_id:t},e.next=3,this.transport.sendWithReply(r);case 3:e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateRegistration",value:function(){var e=(0,o.default)(i.default.mark(function e(t,r){var o,s;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.log.debug("update registration for context",t),(o=this.registrationsInProgress.get(t))||(o=new n.default,this.registrationsInProgress.set(t,o)),s=b.v4(),o.add(s),e.prev=5,e.next=8,this.putNotificationContext(t,r);case 8:p.log.debug("registration attempt succeeded for context",r),o.delete(s),0===o.size&&(this.registrationsInProgress.delete(t),this.emit("registered",t)),e.next=19;break;case 13:e.prev=13,e.t0=e.catch(5),p.log.warn("registration attempt failed for context",r),p.log.debug(e.t0),o.delete(s),0===o.size&&(this.registrationsInProgress.delete(t),this.emit("registrationFailed",t,e.t0));case 19:case"end":return e.stop()}},e,this,[[5,13]])}));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateRegistrations",value:function(){var e=this;p.log.trace("refreshing "+this.registrations.size+" registrations"),this.registrations.forEach(function(t,r){e.updateRegistration(r,t)})}},{key:"setNotificationsContext",value:function(e,t){if(!e||!t)throw new m.TwilsockError("Invalid arguments provided");this.registrations.set(e,t),this.transport.isConnected&&this.updateRegistration(e,t)}},{key:"removeNotificationsContext",value:function(){var e=(0,o.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.registrations.has(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.deleteNotificationContext(t);case 4:this.transport.isConnected&&this.registrations.delete(t);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),t}(h.EventEmitter);r.Registrations=v},{"../error/twilsockerror":226,"../logger":230,"babel-runtime/core-js/map":37,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/set":47,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/regenerator":59,events:200,uuid:250}],244:[function(e,t,r){"use strict";var n=u(e("babel-runtime/regenerator")),i=u(e("babel-runtime/helpers/asyncToGenerator")),o=u(e("babel-runtime/core-js/promise")),s=u(e("babel-runtime/helpers/createClass")),a=u(e("babel-runtime/helpers/classCallCheck"));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("../logger"),l=e("../error/twilsockerror"),f=e("../error/twilsockupstreamerror"),d=e("../protocol/messages"),p=e("../index");function h(e,t){var r=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var r={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:null};if(r.search.length>0){var n=r.search.substring(1);r.params=n.split("&").map(function(e){return e.split("=")}).reduce(function(e,t){return e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e},{})}return r}throw new l.TwilsockError("Incorrect URI: "+e)}(t),n={method:e,host:r.host,path:r.pathname};return r.params&&(n.params=r.params),n}var b=function(){function e(t,r,n){(0,a.default)(this,e),this.config=n,this.transport=t,this.pendingMessages=[],this.twilsock=r}return(0,s.default)(e,[{key:"saveMessage",value:function(e){var t=this;return new o.default(function(r,n){var i={message:e,resolve:r,reject:n,timeout:setTimeout(function(){c.log.debug("request is timed out"),n(new l.TwilsockError("Twilsock: request timeout"))},2e4)};t.pendingMessages.push(i)})}},{key:"sendPendingMessages",value:function(){for(var e=this,t=function(){var t=e.pendingMessages[0];try{var r=t.message;e.actualSend(r).then(function(e){return t.resolve(e)}).catch(function(e){return t.reject(e)}),clearTimeout(t.timeout)}catch(e){return c.log.debug("Failed to send pending message",e),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length;){if("break"===t())break}}},{key:"rejectPendingMessages",value:function(){this.pendingMessages.forEach(function(e){e.reject(new p.TransportUnavailableError("Can't connect to twilsock")),clearTimeout(e.timeout)}),this.pendingMessages.splice(0,this.pendingMessages.length)}},{key:"actualSend",value:function(){var e=(0,i.default)(n.default.mark(function e(t){var r,i,o,s,a,u;return n.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.to,i=t.headers,o=t.body,s={host:r.host,path:r.path,method:r.method,params:r.params,headers:i},a=new d.Message(this.config.activeGrant,i["Content-Type"]||"application/json",s),e.next=7,this.transport.sendWithReply(a,o);case 7:if(u=e.sent,!((c=u)&&c.header&&c.header.http_status)||(n=u.header.http_status.code)>=200&&n<300){e.next=10;break}throw new f.TwilsockUpstreamError(u.header.http_status.code,u.header.http_status.status,u.body);case 10:return e.abrupt("return",{status:u.header.http_status,headers:u.header.http_headers,body:u.body});case 11:case"end":return e.stop()}var n,c},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"send",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3];if(this.twilsock.isTerminalState)return o.default.reject(new p.TransportUnavailableError("Can't connect to twilsock"));var i=function(e,t,r,n){return{to:h(e,t),headers:r,body:n}}(e,t,r,n);return this.twilsock.isConnected?this.actualSend(i):this.saveMessage(i)}}]),e}();r.Upstream=b},{"../error/twilsockerror":226,"../error/twilsockupstreamerror":228,"../index":229,"../logger":230,"../protocol/messages":237,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/regenerator":59}],245:[function(e,t,r){(function(t){"use strict";var n=o(e("babel-runtime/helpers/classCallCheck")),i=o(e("babel-runtime/helpers/createClass"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(){(0,n.default)(this,e)}return(0,i.default)(e,null,[{key:"storeToken",value:function(t,r){e.canStore&&e.sessionStorage.setItem(e.getKeyName(r),t)}},{key:"getStoredToken",value:function(t){return e.canStore?e.sessionStorage.getItem(e.getKeyName(t)):null}},{key:"initialize",value:function(){e.canStore&&(e.sessionStorage.getItem(e.initializedFlag)&&this.clear(),e.sessionStorage.setItem(e.initializedFlag,"true"),e.window.addEventListener("unload",function(){e.sessionStorage.removeItem(e.initializedFlag)}))}},{key:"clear",value:function(){if(e.canStore){for(var t=[],r=0;r<e.sessionStorage.length;r++){var n=e.sessionStorage.key(r);n.startsWith(e.tokenStoragePrefix)&&t.push(n)}t.forEach(function(t){return e.sessionStorage.removeItem(t)}),e.sessionStorage.removeItem(e.initializedFlag)}}},{key:"getKeyName",value:function(t){return""+e.tokenStoragePrefix+t}},{key:"canStore",get:function(){return e.sessionStorage&&e.window}}]),e}();s.initializedFlag="twilio_twilsock_token_storage",s.tokenStoragePrefix="twilio_continuation_token_",s.sessionStorage=t.sessionStorage,s.window=t.window,r.TokenStorage=s,s.initialize()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52}],246:[function(e,t,r){"use strict";var n=p(e("babel-runtime/core-js/promise")),i=p(e("babel-runtime/regenerator")),o=p(e("babel-runtime/helpers/asyncToGenerator")),s=p(e("babel-runtime/core-js/object/get-prototype-of")),a=p(e("babel-runtime/helpers/createClass")),u=p(e("babel-runtime/helpers/possibleConstructorReturn")),c=p(e("babel-runtime/helpers/get")),l=p(e("babel-runtime/helpers/inherits")),f=p(e("babel-runtime/helpers/classCallCheck")),d=p(e("babel-runtime/core-js/json/stringify"));p(e("babel-runtime/helpers/typeof"));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var h=e("events"),b=e("javascript-state-machine"),m=e("./logger"),v=e("./protocol/messages"),y=e("./parser"),g=e("./error/twilsockreplyerror"),_=e("./backoffretrier");r.Response=function e(){(0,f.default)(this,e)};var k=function(e){function t(e,r,n){(0,f.default)(this,t);var i=(0,u.default)(this,(t.__proto__||(0,s.default)(t)).call(this));return i.terminalStates=["disconnected","rejected"],i.lastEmittedState=void 0,i.tokenExpiredSasCode=20104,i.websocket=e,i.websocket.on("connected",function(){return i.fsm.socketConnected()}),i.websocket.on("disconnected",function(e){return i.fsm.socketClosed()}),i.websocket.on("message",function(e){return i.onIncomingMessage(e)}),i.transport=r,i.config=n,i.retrier=new _.BackoffRetrier(n.retryPolicy),i.retrier.on("attempt",function(){return i.retry()}),i.retrier.on("failed",function(e){m.log.warn("Retrying failed: "+e.message),i.disconnect()}),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",function(){m.log.debug("Browser reported connectivity state: online"),i.fsm.systemOnline()}),window.addEventListener("offline",function(){m.log.debug("Browser reported connectivity state: online"),i.websocket.close(),i.fsm.socketClosed()})),i.fsm=new b({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:function(){i.setupSocket(),i.emit("connecting")},onEnterInitialising:function(){i.sendInit()},onLeaveInitialising:function(){i.cancelInit()},onEnterUpdating:function(){i.sendUpdate()},onLeaveUpdating:function(){i.cancelUpdate()},onEnterRetrying:function(){i.initRetry(),i.emit("connecting")},onEnterConnected:function(){i.resetBackoff(),i.onConnected()},onUserUpdateToken:function(){i.resetBackoff()},onTokenRejected:function(){i.resetBackoff(),i.closeSocket(!0),i.finalizeSocket()},onUserDisconnect:function(){i.closeSocket(!0)},onEnterDisconnecting:function(){i.startDisconnectTimer()},onLeaveDisconnecting:function(){i.cancelDisconnectTimer()},onEnterWaitSocketClosed:function(){i.startDisconnectTimer()},onLeaveWaitSocketClosed:function(){i.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:function(){i.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:function(){i.cancelDisconnectTimer()},onDisconnected:function(){i.resetBackoff(),i.finalizeSocket()},onReceiveClose:function(e,t){i.onCloseReceived(t)},onReceiveOffload:function(e,t){m.log.debug("onreceiveoffload: ",t),i.modifyBackoff(t.body),i.onCloseReceived(t.status)},onUnsupported:function(){i.closeSocket(!0),i.finalizeSocket()},onError:function(e,t){i.closeSocket(t),i.finalizeSocket()},onEnterState:function(e){"none"!==e.from&&i.changeState(e)},onInvalidTransition:function(e,t,r){m.log.warn("FSM: unexpected transition",t,r)}}}),i}return(0,l.default)(t,e),(0,a.default)(t,[{key:"changeState",value:function(e){m.log.debug("FSM: "+e.transition+": "+e.from+" --\x3e "+e.to),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}},{key:"resetBackoff",value:function(){m.log.trace("resetBackoff"),this.retrier.stop()}},{key:"modifyBackoff",value:function(e){m.log.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}},{key:"emit",value:function(e){for(var r,n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return m.log.debug("Emitting '"+e.toString()+"'"+(i.length>0?" with "+i.length+" argument/s":"")),(r=(0,c.default)(t.prototype.__proto__||(0,s.default)(t.prototype),"emit",this)).call.apply(r,[this,e].concat(i))}},{key:"startDisconnectTimer",value:function(){var e=this;m.log.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout(function(){m.log.debug("disconnecting is timed out"),e.closeSocket(!0)},3e3)}},{key:"cancelDisconnectTimer",value:function(){m.log.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}},{key:"initRetry",value:function(){m.log.debug("initRetry"),this.retrier.inProgress?this.retrier.cancel():this.retrier.start()}},{key:"retry",value:function(){"connecting"!=this.fsm.state?(m.log.trace("retry"),this.websocket.close(),this.fsm.userRetry()):m.log.trace("can\t retry as already connecting")}},{key:"onConnected",value:function(){this.emit("connected")}},{key:"finalizeSocket",value:function(){m.log.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}},{key:"setupSocket",value:function(){m.log.trace("setupSocket:",this.config.token),this.websocket.connect()}},{key:"onIncomingMessage",value:function(e){var t=y.Parser.parse(e),r=t.method,n=t.header,i=t.payload;"reply"!==r&&this.confirmReceiving(n),"notification"===r?this.emit("message",n.message_type,i):"reply"===n.method?this.transport.processReply({id:n.id,status:n.status,header:n,body:i}):"client_update"===n.method?"token_about_to_expire"===n.client_update_type&&this.emit("tokenAboutToExpire"):"close"===n.method&&(308===n.status.code?(m.log.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:n.status.status,body:i})):406===n.status.code?(m.log.error("Server closed connection because can't parse protocol: "+(0,d.default)(n.status)),this.fsm.receiveFatalClose()):417===n.status.code?(m.log.error("Server closed connection because can't parse client reply: "+(0,d.default)(n.status)),this.fsm.receiveFatalClose(n.status.status)):410===n.status.code?(m.log.warn("Server closed connection: "+(0,d.default)(n.status)),this.fsm.receiveClose(n.status.status),this.emit("tokenExpired")):401===n.status.code?(m.log.error("Server closed connection: "+(0,d.default)(n.status)),this.fsm.receiveClose(n.status.status)):(m.log.warn("unexpected message: ",n.status),this.fsm.receiveOffload({status:n.status.status,body:null})))}},{key:"sendInit",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m.log.trace("sendInit"),e.prev=1,e.next=4,this.transport.sendInit();case 4:t=e.sent,this.config.updateContinuationToken(t.continuationToken),this.fsm.initSuccess(t),this.emit("initialized",t),this.emit("tokenUpdated"),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),e.t0 instanceof g.TwilsockReplyError?(m.log.warn("Init rejected by server: "+(0,d.default)(e.t0.reply.status)),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.initError(!0)):500===e.t0.reply.status.code?this.fsm.initError(!1):this.fsm.initError(!0)):this.fsm.initError(!0),this.emit("tokenUpdated",e.t0);case 15:case"end":return e.stop()}},e,this,[[1,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"sendUpdate",value:function(){var e=(0,o.default)(i.default.mark(function e(){var t,r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return m.log.trace("sendUpdate"),t=new v.Update(this.config.token),e.prev=2,e.next=5,this.transport.sendWithReply(t);case 5:r=e.sent,this.fsm.updateSuccess(r.body),this.emit("tokenUpdated"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),e.t0 instanceof g.TwilsockReplyError?(m.log.warn("Token update rejected by server: "+(0,d.default)(e.t0.reply.status)),401===e.t0.reply.status.code||403===e.t0.reply.status.code?(this.fsm.tokenRejected(e.t0.reply.status),e.t0.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.t0.reply.status.code?(this.modifyBackoff(e.t0.reply.body),this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0.reply.status)):this.fsm.updateError(e.t0),this.emit("tokenUpdated",e.t0);case 14:case"end":return e.stop()}},e,this,[[2,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"cancelInit",value:function(){m.log.trace("cancelInit")}},{key:"cancelUpdate",value:function(){m.log.trace("cancelUpdate")}},{key:"confirmReceiving",value:function(e){m.log.trace("confirmReceiving");try{this.transport.send(new v.Reply(e.id))}catch(e){m.log.debug("failed to confirm packet receiving",e)}}},{key:"closeSocket",value:function(e){var t=this;m.log.trace("closeSocket (graceful: "+e+")"),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout(function(){return t.fsm.socketClosed()},0)}},{key:"connect",value:function(){m.log.trace("connect"),this.fsm.userConnect()}},{key:"disconnect",value:function(){var e=this;return m.log.trace("disconnect"),this.fsm.is("disconnected")?n.default.resolve():new n.default(function(t){e.disconnectedPromiseResolve=t,e.fsm.userDisconnect()})}},{key:"updateToken",value:function(e){var t=this;return m.log.trace("updateToken:",e),new n.default(function(e,r){t.once("tokenUpdated",function(t){t?r(t):e()}),t.fsm.userUpdateToken()})}},{key:"onCloseReceived",value:function(e){this.websocket.close()}},{key:"isConnected",get:function(){return"connected"===this.state&&this.websocket.isConnected}},{key:"state",get:function(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"rejected";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}},{key:"isTerminalState",get:function(){return-1!==this.terminalStates.indexOf(this.fsm.state)}}]),t}(h.EventEmitter);r.TwilsockChannel=k,r.TwilsockImpl=k},{"./backoffretrier":221,"./error/twilsockreplyerror":227,"./logger":230,"./parser":234,"./protocol/messages":237,"babel-runtime/core-js/json/stringify":36,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/core-js/promise":45,"babel-runtime/helpers/asyncToGenerator":50,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/get":53,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,"babel-runtime/helpers/typeof":58,"babel-runtime/regenerator":59,events:200,"javascript-state-machine":202}],247:[function(e,t,r){(function(t){"use strict";var n=u(e("babel-runtime/core-js/object/get-prototype-of")),i=u(e("babel-runtime/helpers/classCallCheck")),o=u(e("babel-runtime/helpers/createClass")),s=u(e("babel-runtime/helpers/possibleConstructorReturn")),a=u(e("babel-runtime/helpers/inherits"));function u(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("events"),l=e("./logger"),f=function(r){function u(r){(0,i.default)(this,u);var o=(0,s.default)(this,(u.__proto__||(0,n.default)(u)).call(this));return o.url=r,o.WebSocket=t.WebSocket||t.MozWebSocket||e("ws"),o}return(0,a.default)(u,r),(0,o.default)(u,[{key:"connect",value:function(){var e=this;l.log.trace("connecting to socket");var t=new this.WebSocket(this.url);t.binaryType="arraybuffer",t.onopen=function(){l.log.debug("socket opened "+e.url),e.emit("connected")},t.onclose=function(t){l.log.debug("socket closed",t),e.emit("disconnected",t)},t.onerror=function(e){l.log.debug("error:",e)},t.onmessage=function(t){e.emit("message",t.data)},this.socket=t}},{key:"send",value:function(e){this.socket.send(e)}},{key:"close",value:function(){if(l.log.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}},{key:"isConnected",get:function(){return this.socket&&1===this.socket.readyState}}]),u}(c.EventEmitter);r.WebSocketChannel=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./logger":230,"babel-runtime/core-js/object/get-prototype-of":42,"babel-runtime/helpers/classCallCheck":51,"babel-runtime/helpers/createClass":52,"babel-runtime/helpers/inherits":54,"babel-runtime/helpers/possibleConstructorReturn":55,events:200,ws:66}],248:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],249:[function(e,t,r){(function(t,n){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
var i=/%[sdj%]/g;r.format=function(e){if(!v(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(a(arguments[r]));return t.join(" ")}r=1;for(var n=arguments,o=n.length,s=String(e).replace(i,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),u=n[r];r<o;u=n[++r])b(u)||!_(u)?s+=" "+u:s+=" "+a(u);return s},r.deprecate=function(e,i){if(y(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),o=!0}return e.apply(this,arguments)}};var o,s={};function a(e,t){var n={seen:[],stylize:c};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),h(t)?n.showHidden=t:t&&r._extend(n,t),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),l(n,e,n.depth)}function u(e,t){var r=a.styles[t];return r?"\x1b["+a.colors[r][0]+"m"+e+"\x1b["+a.colors[r][1]+"m":e}function c(e,t){return e}function l(e,t,n){if(e.customInspect&&t&&w(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return v(i)||(i=l(e,i,n)),i}var o=function(e,t){if(y(t))return e.stylize("undefined","undefined");if(v(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(m(t))return e.stylize(""+t,"number");if(h(t))return e.stylize(""+t,"boolean");if(b(t))return e.stylize("null","null")}(e,t);if(o)return o;var s=Object.keys(t),a=function(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),x(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return f(t);if(0===s.length){if(w(t)){var u=t.name?": "+t.name:"";return e.stylize("[Function"+u+"]","special")}if(g(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(k(t))return e.stylize(Date.prototype.toString.call(t),"date");if(x(t))return f(t)}var c,_="",j=!1,C=["{","}"];(p(t)&&(j=!0,C=["[","]"]),w(t))&&(_=" [Function"+(t.name?": "+t.name:"")+"]");return g(t)&&(_=" "+RegExp.prototype.toString.call(t)),k(t)&&(_=" "+Date.prototype.toUTCString.call(t)),x(t)&&(_=" "+f(t)),0!==s.length||j&&0!=t.length?n<0?g(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),c=j?function(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)T(t,String(s))?o.push(d(e,t,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(d(e,t,r,n,i,!0))}),o}(e,t,n,a,s):s.map(function(r){return d(e,t,n,a,r,j)}),e.seen.pop(),function(e,t,r){if(e.reduce(function(e,t){return 0,t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(c,_,C)):C[0]+_+C[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,r,n,i,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(a=e.stylize("[Setter]","special")),T(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(u.value)<0?(a=b(r)?l(e,u.value,null):l(e,u.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),y(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e){return Array.isArray(e)}function h(e){return"boolean"==typeof e}function b(e){return null===e}function m(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function g(e){return _(e)&&"[object RegExp]"===j(e)}function _(e){return"object"==typeof e&&null!==e}function k(e){return _(e)&&"[object Date]"===j(e)}function x(e){return _(e)&&("[object Error]"===j(e)||e instanceof Error)}function w(e){return"function"==typeof e}function j(e){return Object.prototype.toString.call(e)}function C(e){return e<10?"0"+e.toString(10):e.toString(10)}r.debuglog=function(e){if(y(o)&&(o=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!s[e])if(new RegExp("\\b"+e+"\\b","i").test(o)){var n=t.pid;s[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else s[e]=function(){};return s[e]},r.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=p,r.isBoolean=h,r.isNull=b,r.isNullOrUndefined=function(e){return null==e},r.isNumber=m,r.isString=v,r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=y,r.isRegExp=g,r.isObject=_,r.isDate=k,r.isError=x,r.isFunction=w,r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e("./support/isBuffer");var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[C(e.getHours()),C(e.getMinutes()),C(e.getSeconds())].join(":"),[e.getDate(),S[e.getMonth()],t].join(" ")),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!_(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":248,_process:210,inherits:201}],250:[function(e,t,r){var n=e("./v1"),i=e("./v4"),o=i;o.v1=n,o.v4=i,t.exports=o},{"./v1":253,"./v4":254}],251:[function(e,t,r){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);t.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},{}],252:[function(e,t,r){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);t.exports=function(){return n(i),i}}else{var o=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],253:[function(e,t,r){var n,i,o=e("./lib/rng"),s=e("./lib/bytesToUuid"),a=0,u=0;t.exports=function(e,t,r){var c=t&&r||0,l=t||[],f=(e=e||{}).node||n,d=void 0!==e.clockseq?e.clockseq:i;if(null==f||null==d){var p=o();null==f&&(f=n=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==d&&(d=i=16383&(p[6]<<8|p[7]))}var h=void 0!==e.msecs?e.msecs:(new Date).getTime(),b=void 0!==e.nsecs?e.nsecs:u+1,m=h-a+(b-u)/1e4;if(m<0&&void 0===e.clockseq&&(d=d+1&16383),(m<0||h>a)&&void 0===e.nsecs&&(b=0),b>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=h,u=b,i=d;var v=(1e4*(268435455&(h+=122192928e5))+b)%4294967296;l[c++]=v>>>24&255,l[c++]=v>>>16&255,l[c++]=v>>>8&255,l[c++]=255&v;var y=h/4294967296*1e4&268435455;l[c++]=y>>>8&255,l[c++]=255&y,l[c++]=y>>>24&15|16,l[c++]=y>>>16&255,l[c++]=d>>>8|128,l[c++]=255&d;for(var g=0;g<6;++g)l[c+g]=f[g];return t||s(l)}},{"./lib/bytesToUuid":251,"./lib/rng":252}],254:[function(e,t,r){var n=e("./lib/rng"),i=e("./lib/bytesToUuid");t.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[o+a]=s[a];return t||i(s)}},{"./lib/bytesToUuid":251,"./lib/rng":252}],255:[function(e,t,r){t.exports={name:"twilio-sync",version:"0.9.2",description:"Twilio Sync client library",main:"lib/index.js",types:"./lib/index.d.ts",scripts:{test:"gulp unit-test",prepare:"gulp build"},author:"Twilio",license:"MIT",dependencies:{"twilio-notifications":"^0.5.3",twilsock:"^0.5.6",karibu:"^2.0.0",loglevel:"^1.6.1","operation-retrier":"^2.0.0",backoff:"^2.5.0",platform:"^1.3.5",rfc6902:"^2.2.2",update:"^0.7.4",uuid:"^3.2.1"},devDependencies:{"@types/chai":"^4.1.2","@types/chai-as-promised":"7.1.0","@types/mocha":"^2.2.48","@types/node":"^8.9.1","@types/sinon":"^4.1.3","@types/sinon-chai":"^2.7.29","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-eslint":"^8.2.3","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0",babelify:"^8.0.0",browserify:"^16.0.0",chai:"^4.1.2","chai-as-promised":"^7.1.1","chai-string":"^1.5.0",cheerio:"^1.0.0-rc.2",del:"^3.0.0",gulp:"^4.0.0","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-exit":"0.0.2","gulp-insert":"^0.5.0","gulp-istanbul":"^1.1.3","gulp-mocha":"^5.0.0","gulp-rename":"^1.2.2","gulp-replace":"^0.6.1","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.2","gulp-typescript":"^4.0.1","gulp-uglify-es":"^1.0.0","ink-docstrap":"^1.3.2",isparta:"^4.1.0",jsdoc:"^3.5.5",jsonwebtoken:"^8.1.1",karma:"^2.0.5","karma-browserify":"^5.3.0","karma-browserstack-launcher":"^1.3.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5",mocha:"^5.0.0","run-sequence":"^2.2.1",sinon:"^4.2.2","sinon-chai":"^2.14.0","ts-node":"^4.1.0",tslint:"^5.9.1",twilio:"^3.15.0",typescript:"^2.8.1","uglify-es":"^3.3.10","uglify-save-license":"^0.4.1",underscore:"^1.8.3","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0",watchify:"^3.10.0"},browserify:{transform:["babelify"]},engines:{node:">=8"}}},{}]},{},[2])(2)});